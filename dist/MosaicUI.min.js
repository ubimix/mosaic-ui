/* 
 * MosaicUI v0.2.50 | License: MIT 
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("_"),require("jQuery"),function(){try{return require("vertx")}catch(a){}}()):"function"==typeof define&&define.amd?define(["_","jQuery","vertx"],b):"object"==typeof exports?exports.MosaicUI=b(require("_"),require("jQuery"),function(){try{return require("vertx")}catch(a){}}()):a.MosaicUI=b(a._,a.jQuery,a.vertx)}(this,function(a,b,c){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){a.exports=c(1)},function(a,b,c){!function(){var b=a.exports=c(4),d=c(2),e=c(3),f=c(5);c(6),b.Utils={trim:function(a){return a.replace(/^\s+|\s+$/gim,"")},getOptions:function(a,b){return a=d.isFunction(a)?b?a.call(b):a():a||{}},getOption:function(a,b){a=this.getOptions(a);var c=a[b];return d.isFunction(c)&&(c=c.call(a)),c}},b.elementToObject=function(a){var c=[];return a.each(function(){try{var a=e(this).text();a=b.Utils.trim(a),a="( "+a+")";var f=eval,g=f(a);d.isFunction(g)&&(g=g()),c.push(g)}catch(h){console.log("ERROR!",h.stack)}}),c},b.Mixins={getType:function(){var a=this.type=this.type||d.uniqueId("type-");return a},getId:function(){var a=this.options=this.options||{},b=a.id=a.id||d.uniqueId("id-");return b},Events:{on:function(a,b,c){var d=this.__listeners=this.__listeners||{};c=c||this;var e=d[a]=d[a]||[];e.push({handler:b,context:c})},off:function(a,b,c){var e=this.__listeners;if(e){var f=e[a];f&&(f=d.filter(f,function(a){var d=a.handler===b;return d&=!c||a.context===c,!d}),e[a]=f.length?f:void 0)}},fire:function(a){var b=this.__listeners;if(b){var c=b[a];if(c){var e=d.toArray(arguments);e.splice(0,1),d.each(c,function(a){a.handler.apply(a.context,e)})}}}},listenTo:function(a,b,c,d){var e=this._listeners=this._listeners||[];d=d||this,a.on(b,c,d),e.push({obj:a,event:b,handler:c,context:d})},stopListening:function(a,b){a?this._listeners=d.filter(this._listeners,function(c){var d=!0,e=c.context||this;return c.obj==a&&(b&&b!=c.event||(c.obj.off(c.event,c.handler,e),d=!1)),d},this):(d.each(this._listeners,function(a){var b=a.context||this;a.obj.off(a.event,a.handler,b)},this),delete this._listeners)},triggerMethod:function(){function a(a,b,c){return c.toUpperCase()}var b=/(^|:)(\w)/gi,c=function(c){var e="on"+c.replace(b,a),f=this[e];return d.isFunction(this.fire)&&this.fire.apply(this,arguments),d.isFunction(f)?f.apply(this,d.tail(arguments)):void 0};return c}()},d.extend(b.Class.prototype,b.Mixins.Events),d.extend(b.Class.prototype,{triggerMethod:b.Mixins.triggerMethod,setOptions:function(a){this.options=d.extend(this.options||{},a)},getOptions:function(){return this.options||{}}}),b.TreeNode=b.Class.extend({listenTo:b.Mixins.listenTo,stopListening:b.Mixins.stopListening,initialize:function(a){this.setOptions(a),this._children={}},getParent:function(){return this.parent},getKey:function(){return this.options.key},add:function(a,b){var c=this;c.remove(a),b.parent=this,c._children[a]=b,b._notify("add",{})},get:function(a,b){var c=this,d=c._children[a];return!d&&b&&(d=c._newChild(a),c.add(a,d)),d},getAll:function(){var a=this,b=d.toArray(arguments),c=[];return a._forEach(b,function(a){c.push(a)}),c},getAllKeys:function(){var a=this;return d.keys(a._children)},isParentOf:function(a,b){for(var c=b!==!1?a:a.getParent(),d=!1;c&&!(d=c===this);)c=c.getParent();return d},find:function(a){var b,c=this,d=c.getKey();return a==d?b=c:c._forEach([],function(c){return b=c.find(a),!b}),b},remove:function(a){var b=this,c=b._children[a];return c&&(c._notify("remove",{}),delete b._children[a]),c},visit:function(a){var b=this,c=!0;d.isFunction(a.before)&&(c=a.before(b)!==!1),c&&d.each(b._children,function(b){b.visit(a)}),d.isFunction(a.after)&&a.after(b)},_forEach:function(a,b){function c(a){var c=!1;if(a){var d=b.call(f,a,e);c=d===!1}return e++,c}var e=0,f=this;d.isFunction(a)&&(b=a,a=[]),a&&a.length?d.find(a,function(a){var b=f._children[a];return c(b)}):d.find(f._children,c)},_notify:function(a,b){var c=this;for(b.node=c;c&&(c.triggerMethod(a,b),!b.stopPropagation);)c=c.getParent()},_newChild:function(a){var b=this.getClass();return new b({key:a})}}),b.TreeNodeStatusMixin={_status:"inactive",getStatus:function(){return this._status||""},setStatus:function(a,b){var c=this._status,e=c!=a;(e||b&&b.force)&&(this._status=a,this._notify("status",d.extend({},b,{prevStatus:c})))},isActive:function(){return"active"==this._status},activate:function(a){this.setStatus("active",a)},deactivate:function(a){this.setStatus("inactive",a)},getStats:function(){var a=this,b={all:[]};return a._forEach([],function(a){var c=a.getKey();b.all.push(c);var d=a.getStatus(),e=b[d]=b[d]||[];e.push(c)}),b},onStatus:function(){function a(){return{internal:!0}}function b(b,c){"before"==c?b.activate(a()):"after"==c&&b.deactivate(a())}function c(b,c){"before"==c?b.deactivate(a()):"after"==c&&b.activate(a())}function d(b,c){("before"==c||"after"==c)&&b.deactivate(a())}function e(a,e){var f;if("activateBefore"==a.options.mode?f=b:"activateAfter"==a.options.mode?f=c:("exclusive"==a.options.mode||a.options.exclusive!==!1)&&(f=d),f){var g="before",h=function(a){"before"==g&&a.isParentOf(e.node,!0)&&(g="in"),f(a,g),"in"==g&&(g="after")};a._forEach([],h)}}return function(b){var c=this;b.node!=c?b.node.isActive()&&!b.internal&&(e(c,b),c.activate()):!c.isActive()&&c.options.deactivateAll&&c.visit({after:function(b){b.deactivate(a())}})}}()},b.Group=b.Class.extend({listenTo:b.Mixins.listenTo,stopListening:b.Mixins.stopListening,initialize:function(a){this.setOptions(a),this.slots={},this.top=null},getStats:function(){var a=this,b={active:[],inactive:[],all:[]};return a._forEach([],function(a){b.all.push(a.key),a.active?b.active.push(a.key):void 0!==a.active&&b.inactive.push(a.key)}),b},_changeState:function(a,b,c){var e=this,f=[];if(e._forEach(c,function(a){a&&a.active!==b&&f.push(a)}),f.length){var g=e.getStats();d.each(f,function(c){c.active=b,e.triggerMethod(a,c)});var h=e.getStats();e.triggerMethod("update",h,g)}},activate:function(){this.options.exclusive&&this.deactivate(),this._changeState("activate",!0,d.toArray(arguments))},deactivate:function(){this._changeState("deactivate",!1,d.toArray(arguments))},toggle:function(){var a=this,b=d.toArray(arguments);a._forEach(b,function(b){b.active?a.deactivate(b.key):a.activate(b.key)})},get:function(a){var b=this,c=b.slots[a];return b._getSlotItem(c)},getAll:function(){var a=this,b=a.getAllSlots.apply(a,arguments);return d.map(b,a._getSlotItem,a)},getAllSlots:function(){var a=this,b=d.toArray(arguments),c=[];return a._forEach(b,function(a){c.push(a)}),c},getAllKeys:function(){var a=this,b=[];return a._forEach([],function(a){b.push(a.key)}),b},addAll:function(a,b){var c=this;d.each(a,function(a,d){c.add(d,a,b)})},add:function(a,b,c){var d,e,f=this,g=f.remove(a),h=f.slots[a]={group:f,key:a,item:b,active:c?!!c:void 0,toString:function(){return JSON.stringify({key:this.key,item:this.item,active:this.active})}};g?(d=g.prev,e=g.next):f.top&&(d=f.top.prev,e=f.top),d&&e?(d.next=h,e.prev=h,h.prev=d,h.next=e):(f.top=h,h.next=h.prev=h),f.triggerMethod("add",h)},remove:function(a){var b=this,c=b.slots[a];if(c){var d=c.next,e=c.prev;e.next=d,d.prev=e,b.top===c&&(b.top=d),b.top===c&&(b.top=null),delete b.slots[a],b.triggerMethod("remove",c)}return c},_getSlotItem:function(a){return a?a.item:null},_forEach:function(a,b){var c=this;if(a&&a.length)d.find(a,function(a){var d=c.slots[a];return b.call(c,d)!==!1});else for(var e=c.top;e&&b.call(c,e)!==!1&&(e=e.next,e!=c.top););}}),b.IO={loadJson:function(a){var c=b.Promise.defer();return e.ajax({dataType:"json",url:a,data:void 0,success:function(a){c.resolve(a)},fail:function(a){c.reject(a)}}),c.promise},loadJsonp:function(a,c){var e,f,g,h=document,i=window,j=b.Promise.defer();try{c=c||"cb",e=d.uniqueId(c),f=h.createElement("script"),g=h.getElementsByTagName("head")[0];var k={};k[c]=e,a=b.IO.prepareUrl(a,k),f.setAttribute("type","text/javascript"),f.setAttribute("src",a),i[e]=function(a){j.resolve(a)},g.appendChild(f)}catch(l){j.reject(l)}return b.Promise.fin(j.promise,function(){e&&delete i[e],g&&f&&g.removeChild(f)})},prepareUrl:function(a,b){return a.replace(/\{\s*([\w_]+)\s*\}/gim,function(a,c){var e=b[c];return d.isFunction(e)?e=e(b):void 0===e&&(e=a),e})}},b.Promise=function(a){var b=e.Deferred();return b.resolve(a),b.promise()},b.Promise.defer=function(){var a=e.Deferred();return a.promise=a.promise(),a},b.Promise.fin=function(a,b){return a.then(function(a){return b(),a},function(a){throw b(),a})},b.Promise.all=function(a,c){function e(a){return h[a]=null,i[a]=null,k++}function f(a,b,d){k--,d?(i[a]=d,j=!0):h[a]=b,(0===k||d&&c)&&(j?g.reject(i):g.resolve(h))}var g=b.Promise.defer(),h=[],i=[],j=!1,k=0;return d.each(a,function(a){var b=e(k);a.then(function(a){f(b,a)},function(a){f(b,null,a)})}),g.promise},b.AdapterManager=b.Class.extend({initialize:function(){this._adapters={}},_getType:function(a){var b;if(d.isString(a))b=a;else{var c=a;d.isFunction(a)&&(c=a.prototype),b=c.type=c.type||d.uniqueId("type-")}return b},_getKey:function(a,b){var c=this._getType(a),d=this._getType(b);return c+"-"+d},registerAdapter:function(a,b,c){var d=this._getKey(a,b);this._adapters[d]=c},getAdapter:function(a,b){var c=this._getKey(a,b);return this._adapters[c]},newAdapterInstance:function(a,b,c){var e=this.getAdapter(a,b),f=null;return d.isFunction(e)?(c=c||{},this._checkValidity(e,c)&&(d.isFunction(e.initialize)&&e.initialize(c),f=new e(c),this._checkValidity(f,c)||(f=null))):f=e,f},removeAdapter:function(a,b){var c=this._getKey(a,b),d=this._adapters[c];return delete this._adapters[c],d},_checkValidity:function(a,b){if(!d.isFunction(a.isValid))return!0;var c=a.isValid(b);return c}}),b.AdapterManager.getInstance=function(){return this._instance||(this._instance=new b.AdapterManager),this._instance},b._registerTypeAdapters=function(a){var c=b.AdapterManager.getInstance();d.each(a,function(a,b){c.registerAdapter(b,this,a)},this)},b.DataSet=b.Class.extend({listenTo:b.Mixins.listenTo,getId:b.Mixins.getId,getType:b.Mixins.getType,initialize:function(a){this.setOptions(a);var c=b.DataSet.getResourceStates();d.each(c,function(a){function b(b){return b.priority||(b.priority=a.priority||0),b}this[a.on]=function(c){c=b(c);var d=a.field+"_priority",e=this[d]||0,f=c.priority;if(!(e>f)){var g=this.getResourceFromEvent(c),h=this[a.field],i=a.force||c.force||!this._isSame(h,g);i&&(h&&this[a.off].call(this,this.newEvent({resource:h})),this[d]=f,this[a.field]=g,this.triggerMethod(a.on,c))}},this[a.off]=function(b){var c=this[a.field],d=this.getResourceFromEvent(b);if(!d||this._isSame(c,d)){delete this[a.field];var e=a.field+"_priority";delete this[e],this.triggerMethod(a.off,b)}}},this)},getResourceAdapter:function(a,c,d){var e=b.AdapterManager.getInstance(),f=null;d=d||{},d.resource=a;for(var g=this.getResourceType(a);g&&!(f=e.newAdapterInstance(g,c,d));){var h=this.getParentResourceType(g);g=h}return f||(f=e.newAdapterInstance("Default",c,d)),f},getResourceId:function(a){var b=a.id=a.id||d.uniqueId("id-");return b},getResourceFromEvent:function(a){return a.resource},getResourceType:function(a){if(!a)return null;var b=a.properties||{},c=b.type;return!c&&a.type&&(c=a.type),c||"Resource"},getParentResourceType:function(a){if((d.isFunction(a)||d.isObject(a))&&(a=a.type),!d.isString(a)||""===a)return null;var b=a.lastIndexOf("/");return a=b>0?a.substring(0,b):null},_isSame:function(a,b){return a&&b?a==b?!0:this.getResourceId(a)==this.getResourceId(b)?!0:!1:!1},newEvent:function(a){return d.extend({priority:0,dataSet:this},a)},_doSearch:function(){return b.Promise(!0)},getSearchParams:function(){return this._searchParams||{}},search:function(a){var c=this;return c._searchParams=a,a=this.getSearchParams(),c.fire("search:updateCriteria",c.newEvent({params:a})),b.Promise().then(function(){return c._doSearch(a)})},runSearch:function(){var a=this;a.stopSearch();var c=a._searchDeferred=b.Promise.defer();return a.fire("search:begin",a.newEvent({params:a._searchParams})),c.promise.then(function(b){delete a._searchDeferred,a._setSearchResults(null,b),a.fire("search:end",a.newEvent({params:a._searchParams,result:b}))},function(b){delete a._searchDeferred,a._setSearchResults(b),a.fire("search:end",a.newEvent({params:a._searchParams,error:b}))}),c},stopSearch:function(){var a=this;if(a._searchDeferred){var b=new Error("Search cancelled.");a._searchDeferred.reject(b),delete a._searchDeferred}},_setSearchResults:function(){}}),d.extend(b.DataSet,{registerResourceStates:function(a){a=d.toArray(a),this._resourceStates=this._resourceStates||[],this._resourceStates=this._resourceStates.concat(a)},getResourceStates:function(){return this._resourceStates||[]}}),b.DataSet.registerResourceStates([{field:"_activated",priority:2,on:"activateResource",off:"deactivateResource"},{field:"_focused",priority:1,on:"focusResource",off:"blurResource"},{field:"_expanded",priority:3,on:"expandResource",off:"reduceResource"}]),b.ResourceCursor=b.Class.extend({initialize:function(a){this.setOptions(a)},getFullLength:function(){return this.options.length||0},getLength:function(){var a=d.toArray(this.getList());return a?a.length:0},getBegin:function(){return this.options.begin||0},getEnd:function(){return this.options.end||this.getLength()-1},getList:function(a){var b=d.toArray(this.options.list);return a&&(b=b.slice(0,a)),b}}),b.ResourceCollectionDataSet=b.DataSet.extend({type:"ResourceCollectionDataSet",_getList:function(){throw new Error("Not implemented")},loadResources:function(a){a=a||{};var b=this;return b._getList().then(function(a){return b._loadNewCursor(a)})},_loadNewCursor:function(a){var c=new b.ResourceCursor({list:a});return b.Promise(c)}}),b.GeoJsonDataSet=b.ResourceCollectionDataSet.extend({type:"GeoJsonDataSet",_loadData:function(){var a=this;return a._loadPromise||(a._loadPromise=a.options.url?b.IO.loadJson(a.options.url).then(function(a){var b=a&&d.isArray(a.features)?a.features:a;return d.toArray(b)}):b.Promise([])),a._loadPromise},_getList:function(){var a=this;return a._list?b.Promise(a._list):a._loadData().then(function(b){return a._list=b,a._list})},deleteResource:function(a){var b=this,c=b.getResourceId(a);return b._getList().then(function(a){return b._list=d.filter(a,function(a){var d=b.getResourceId(a),e=d==c;return!e}),b.fire("update",b.newEvent({})),b._loadNewCursor(b._list)})}}),b.TilesDataSet=b.ResourceCollectionDataSet.extend({type:"TilesDataSet",initialize:function(){var a=this,c=b.ResourceCollectionDataSet.prototype;c.initialize.apply(a,arguments),a.listenTo(a,"search:updateCriteria",function(){delete a._tilesUrl,delete a._datagridUrl}),a._resourceIndex={}},_formatUrl:function(a){function b(a){return a=String(a),encodeURIComponent(a)}function c(a){return d.isArray(a)?d.map(a,c).join(","):(a=String(a),a=encodeURIComponent(a))}if(!a)return a;var e="",f=this.getSearchParams();if(d.each(f,function(a,d){e.length>0&&(e+="&"),e+=b(d)+"="+c(a)},this),e.length>0){var g=a.indexOf("?");a+=0>g?"?":"&",a+=e}return a},getTilesUrl:function(){return this._tilesUrl||(this._tilesUrl=this._formatUrl(this.options.tilesUrl)),this._tilesUrl},getDataGridUrl:function(){return this._datagridUrl||(this._datagridUrl=this._formatUrl(this.options.datagridUrl)),this._datagridUrl},getAttribution:function(){return this.options.attribution},getLoadedResources:function(){return d.values(this._resourceIndex)},_getList:function(){return b.Promise(this.getLoadedResources())},_setSearchResults:function(a,b){var c=this;b=b||[];d.filter(b,function(a,b){return!d.has(c._resourceIndex,b)}),d.filter(c._resourceIndex,function(a,c){return!d.has(b,c)});c._resourceIndex=b}}),b.App=b.Class.extend({listenTo:b.Mixins.listenTo,stopListening:b.Mixins.stopListening,initialize:function(a){this.setOptions(a),this._dataSets={}},start:function(){this._started||(this._started=!0,this.triggerMethod("start",{app:this}),d.each(this._dataSets,function(a){this._triggerDataSetEvent("dataSet:add",a)},this))},stop:function(){this._started&&(d.each(this._dataSets,function(a){this._triggerDataSetEvent("dataSet:remove",a)},this),this._started=!1,this.triggerMethod("stop",{app:this}))},getDataSet:function(a){return this._dataSets[a]},getDataSets:function(){return d.values(this._dataSets)},addDataSet:function(a){var b=a.getId(),c=this;c._dataSets[b]=a,c.listenTo(a,"update",function(){c._triggerDataSetEvent("dataSet:update",a)}),c._started&&c._triggerDataSetEvent("dataSet:add",a)},removeDataSet:function(a){if(a){var b=a.getId();d.has(this._dataSets,b)&&(this._triggerDataSetEvent("dataSet:remove",a),this.stopListening(a,"update"),delete this._dataSets[b])}},_triggerDataSetEvent:function(a,b){var c={dataSet:b,app:this};this.triggerMethod(a,c),b.triggerMethod(a,c)}}),b.TemplateView=b.Class.extend({type:"TemplateView",getId:b.Mixins.getId,getType:b.Mixins.getType,listenTo:b.Mixins.listenTo,stopListening:b.Mixins.stopListening,initialize:function(a){this.setOptions(a),this.triggerMethod("initialize")},getElement:function(){if(!this.$el){var a=this.options.el||"<div></div>";this.$el=e(a)}return this.$el},renderDefault:function(a,b){var c=new Error("["+b+"]: Renderer method not found.");console.log(c.stack,a)},renderedDefault:function(a,b){var c=new Error("["+b+"]: Method called after the rendering process is not defined.");console.log(c.stack,a)},handleDefault:function(a,b){var c=new Error("["+b+"]: A handler method with such a name was not found.");console.log(c.stack,a)},renderElement:function(a,b){var c=[];this._renderElement(a,b,c),d.each(c,function(a){this._callReferencedMethod(a,"data-rendered","renderedDefault")},this)},bindListeners:function(a,b,c){var f=a[0];if(f){void 0===c&&(c="data-action-"+b);var g=this,h="["+c+"]";a.on(b,h,function(a){var b=e(a.currentTarget),f=b.attr(c),h=g[f];d.isFunction(h)?h.call(g,a,b):g.handleDefault(b,f)})}},render:function(){var a=this;return a.triggerMethod("render:begin"),a._render(),a._bindEventListeners(),a.triggerMethod("render:end"),this},remove:function(){this.triggerMethod("remove"),this.stopListening();var a=this.getElement();return a.remove(),this},_callReferencedMethod:function(a,b,c){var d=null,e=a.attr(b);if(e){var f=this[e]||this[c];a.removeAttr(b),f&&(d=f.call(this,a,e))}return d},_renderElement:function(a,b,c){var f=!0;if(b!==!1){a.attr("data-rendered")&&c.push(a);var g=this._callReferencedMethod(a,"data-render","renderDefault");f=g!==!1}if(f){var h=d.toArray(a.children());d.each(h,function(a){this._renderElement(e(a),!0,c)},this)}this.triggerMethod("render")},_bindEventListeners:function(){var a=["click","mouseover","mouseout","focus","blur","keypress","keydown","keyup"],b=this.getElement();d.each(a,function(a){this.bindListeners(b,a)},this)},_render:function(){var a=this,b=a.getElement();return a._renderTemplate(),a.className&&b.attr("class",a.className),a.renderElement(b),a},_renderTemplate:function(){var a=this,b=a.template;if(b){var c=d.extend({},a.options,{view:a});d.isString(b)&&(b=d.template(b));var e=b(c),f=a.getElement();f.html(e)}}}),b.TemplateView.extendViewType=function(a,c){a=e(a).clone(),c=c||this.extend({});var f=a.find('script[data-type="static"]');d.each(b.elementToObject(f),function(a){d.extend(c,a)},this),f.remove(),f=a.find("script"),d.each(b.elementToObject(f),function(a){d.extend(c.prototype,a)},this),f.remove();var g=a.html();return g=b.Utils.trim(g),g&&""!==g&&(c.prototype.template=g),c},b.DataSetView=b.TemplateView.extend({type:"DataSetView",getApp:function(){return this.options.app},initialize:function(a){this.setOptions(a),this.triggerMethod("initialize");var b=this.getApp();this.listenTo(b,"dataSet:add",this.onDataSetAdd),this.listenTo(b,"dataSet:remove",this.onDataSetRemove),this.listenTo(b,"dataSet:update",this.onDataSetUpdate),this.listenTo(b,"start",function(a){this.onStart(a)}),this.listenTo(b,"stop",function(a){this.stopListening(),this.onStop(a)}),this._entities={}},getEntity:function(a){return this._entities[a]},setEntity:function(a,b){this._entities[a]=b},removeEntity:function(a){var b=this._entities[a];return delete this._entities[a],b},onStart:function(){},onStop:function(){},onDataSetAdd:function(a){var c=a.dataSet,d=b.AdapterManager.getInstance(),e=d.newAdapterInstance(this,c,{view:this,dataSet:c});this.setEntity(c.getId(),e),e&&e.renderView&&e.renderView()},onDataSetRemove:function(a){var b=a.dataSet,c=this.removeEntity(b.getId());c&&c.resetView&&c.resetView()},onDataSetUpdate:function(){}}),b.ResourceView=b.TemplateView.extend({type:"ResourceView",_fireResourceEvent:function(a,b){var c=this.getDataSet(),d=this.getResource();a=c.newEvent({priority:a.priority,resource:d}),c[b](a)},initialize:function(){var a=b.TemplateView.prototype.initialize;a.apply(this,arguments);var c=this,e=b.DataSet.getResourceStates();d.each(e,function(a){c[a.on]=function(b){this._fireResourceEvent(b,a.on)},c[a.off]=function(b){this._fireResourceEvent(b,a.off)}})},getResource:function(){return this.options.resource},getDataSet:function(){return this.options.dataSet}}),b.MapPopupControl=b.Class.extend({initialize:function(a){this.setOptions(a)},open:function(a){var c=this;return a=a||{},d.isFunction(a.action)&&c._checkPriority(a)?c.close(a).then(function(){return c._priority=a.priority||0,a.action()}).then(function(a){c._deferred=a||new b.Promise.defer;var d=c._deferred.promise;return d.then(function(){c._priority=0,delete c._deferred}),d}):b.Promise()},close:function(a){var c=this,d=!1;a=a||{};var e=b.Promise();return c._checkPriority(a)&&(d=!0,c._deferred&&(e=c._deferred.promise,c._deferred.resolve())),e.then(function(){return d})},_checkPriority:function(a){var b=a.priority||0,c=this._priority||0;return b>=c}}),b.MapView=b.DataSetView.extend({type:"MapView",getMap:function(){return this._map},getPopupControl:function(){return this._popupControl||(this._popupControl=new b.MapPopupControl({map:this._map})),this._popupControl},getMaxZoom:function(){return this.options.maxZoom||18},getMinZoom:function(){return this.options.minZoom||1},getInitialZoom:function(){return this.options.initialZoom||8},getInitialCenter:function(){return d.toArray(this.options.initialCenter||[0,0])},resetView:function(){var a=this.getInitialZoom(),b=this.getInitialCenter(),c=f.latLng(b[1],b[0]);this._map.setView(c,a);var d=this;setTimeout(function(){d._map.invalidateSize()},100)},onStart:function(){this._newMap(),this.resetView()},onStop:function(){this._map.remove(),delete this._map},_newMap:function(){function a(){for(var a=h.getZoom(),c=b.getMaxZoom(),d=0;c>d;d++){var e="zoom-"+d;a>d?g.addClass(e):g.removeClass(e)}}var b=this,c=d.extend({},this.options.mapOptions),e=[];d.each(c,function(a,b){b.match(/Control$/)&&d.isObject(a)&&(e.push(a),c[b]=!1)});var g=this.getElement(),h=this._map=f.map(g[0],c);d.each(e,function(a){a&&d.isObject(a)&&h.addControl(a)}),h.on("zoomend",function(){a()})}}),b.MapView.newOptions=function(a,b){var c=a.getOptions(),e=b.data("center")||[0,0],g=b.data("zoom"),h=b.data("min-zoom")||2,i=b.data("max-zoom")||18,j=b.data("zoom-control"),k={};if(void 0!==j)if(j!==!1){var l=d.isString(j)?j:"topleft";k.zoomControl=f.control.zoom({position:l})}else k.zoomControl=null;return d.extend({app:a,el:b,minZoom:h,maxZoom:i,initialZoom:g,initialCenter:e,mapOptions:k},c.mapOptions)},b.ListView=b.DataSetView.extend({type:"ListView"}),b.ListView.newOptions=function(a,b){var c=a.getOptions();return d.extend({app:a,el:b},c.listOptions)},b.ViewAdapter=b.Class.extend({stopListening:b.Mixins.stopListening,listenTo:b.Mixins.listenTo,initialize:function(a){this.setOptions(a),this._view=this.options.view,this._dataSet=this.options.dataSet,this._resetViewIndex()},newResourceView:function(a,b){var c=this._dataSet.getResourceAdapter(b,a,{resource:b,dataSet:this._dataSet,parentView:this._view});return c},_bindDataEventListeners:function(){function a(a,b){var c=e._dataSet.getResourceFromEvent(b),d=e._getResourceView(c);d&&d.triggerMethod(a,b)}function c(b){var c=function(c){a(b,c)};e._dataSet.on(b,c),e._delegateEventListeners.push(function(){e._dataSet.off(b,c)})}var e=this;e._delegateEventListeners=[];var f=b.DataSet.getResourceStates();d.each(f,function(a){c(a.on),c(a.off)})},_unbindDataEventListeners:function(){var a=this;d.each(a._delegateEventListeners,function(a){a()}),delete a._delegateEventListeners},_addResourceViewToIndex:function(a){if(a&&a.getResource){var b=a.getResource(),c=this._dataSet.getResourceId(b);this._viewIndex[c]=a}},_removeResourceViewFromIndex:function(a){if(a&&a.getResource){var b=a.getResource(),c=this._dataSet.getResourceId(b);delete this._viewIndex[c]}},_getResourceViews:function(){return d.values(this._viewIndex)},_resetViewIndex:function(){this._viewIndex={}},_getResourceView:function(a){var b=this._dataSet.getResourceId(a);return this._viewIndex[b]}}),b.MapFigureOptions=b.Class.extend({type:"MapFigureOptions"}),b.MapFigureOptions.registerOptions=b._registerTypeAdapters,b.MapMarkerView=b.ResourceView.extend({type:"MapMarkerView"}),b.MapMarkerView.hasHtmlMarker=function(a){return a.template?!0:!1},b.MapPopupView=b.TemplateView.extend({}),b.MapPopupView.registerViews=b._registerTypeAdapters,b.MapActivePopupView=b.MapPopupView.extend({type:"MapActivePopupView"}),b.DataSetViewAdapter=b.ViewAdapter.extend({_bindDataEventListeners:function(){var a=b.ViewAdapter.prototype;a._bindDataEventListeners.apply(this,arguments),this.listenTo(this._dataSet,"update",this._onUpdate),this.listenTo(this._dataSet,"hide",this._onHide),this.listenTo(this._dataSet,"show",this._onShow),this.listenTo(this._dataSet,"search:begin",this._onBeginSearch),this.listenTo(this._dataSet,"search:end",this._onEndSearch),this.listenTo(this._dataSet,"activateResource",this._onActivateResource),this.listenTo(this._dataSet,"deactivateResource",this._onDeactivateResource),this.listenTo(this._dataSet,"focusResource",this._onFocusResource),this.listenTo(this._dataSet,"blurResource",this._onBlurResource)},_unbindDataEventListeners:function(){var a=b.ViewAdapter.prototype;a._unbindDataEventListeners.apply(this,arguments),this.stopListening(this._dataSet,"update"),this.stopListening(this._dataSet,"refresh"),this.stopListening(this._dataSet,"hide"),this.stopListening(this._dataSet,"show"),this.stopListening(this._dataSet,"search:begin"),this.stopListening(this._dataSet,"search:end"),this.stopListening(this._dataSet,"activateResource"),this.stopListening(this._dataSet,"deactivateResource"),this.stopListening(this._dataSet,"focusResource"),this.stopListening(this._dataSet,"blurResource")},_getDatasetOptions:function(a,c){var d=b.Utils.getOption(this._dataSet,a);return void 0===d&&(d=b.Utils.getOption(this._dataSet.options,a)),void 0===d&&(d=c),d},renderView:function(){var a=this;a._unbindDataEventListeners(),a._doRender(),a._bindDataEventListeners()},resetView:function(){var a=this;a._unbindDataEventListeners(),a._doReset(),a.stopListening()},_doRender:function(){throw new Error("Not implemented")},_doReset:function(){},_onUpdate:function(){this._doRender()},_onShow:function(){},_onHide:function(){},_onBeginSearch:function(){},_onEndSearch:function(){},_onActivateResource:function(){},_onDeactivateResource:function(){},_onFocusResource:function(){},_onBlurResource:function(){}}),b.MapFocusedPopupView=b.MapPopupView.extend({type:"MapFocusedPopupView"}),b.DataSetMapAdapter=b.DataSetViewAdapter.extend({_showPopup:function(a,c,d){var e=this,g=e._dataSet.getResourceFromEvent(a),h=e._dataSet.getResourceId(g);if(!g||!h)return b.Promise(!1);var i=e._getResourceLayer(g),j=e.newResourceView(c,g);if(!j)return b.Promise(!1);j.render();var k,l=g.geometry||{},m="Point"==l.type;m&&(k=l.coordinates),k||(k=a.coords);var n=b.Utils.getOptions(j.popupOptions),o=function(){var a=e._view.getMap(),c=f.popup(n),d=j.getElement();c.setContent(d[0]);var g=!1;if(k){var h=k[1],l=k[0],o=f.latLng(h,l);c.setLatLng(o),g=!0}var p=b.Promise.defer();return c.on("close",function(){p.resolve()}),p.then(function(){c&&a.closePopup()}),setTimeout(function(){m&&i&&i.bindPopup?(i.bindPopup(c),i.openPopup()):g?c.openOn(a):p.resolve()},1),p};e._addResourceViewToIndex(j);var p=e._view.getPopupControl();return p.open({priority:d,coordinates:k,layer:i,action:o}).then(function(){return e._removeResourceViewFromIndex(j),j.remove(),!0})},_closePopup:function(a,b,c){var d=this._view.getPopupControl();return d.close({priority:c})},_bindLayerEventListeners:function(a,b){function c(a,c){var e=b(c);if(e){var f=(d._dataSet.getResourceId(e),[c.latlng.lng,c.latlng.lat]),g=d._dataSet.newEvent({resource:e,coords:f,force:!0});d._dataSet[a](g)}}var d=this;a.on("mouseover",function(a){c("focusResource",a)}),a.on("mouseout",function(a){c("blurResource",a)}),a.on("click",function(a){c("activateResource",a)})},_unbindLayerEventListeners:function(a){a.off("mouseover"),a.off("mouseout"),a.off("click")},renderView:function(){var a=this;a.resetView(),a._groupLayer=new f.FeatureGroup,a._doRender();var b=a._view.getMap();b.addLayer(a._groupLayer),a._bindDataEventListeners()},resetView:function(){var a=this,b=a._view.getMap();b.closePopup(),a._groupLayer&&(b.removeLayer(a._groupLayer),delete a._groupLayer),a._unbindDataEventListeners(),a.stopListening()},_getResourceLayer:function(){return void 0},_onActivateResource:function(a){var c=this,d=c._dataSet.getResourceFromEvent(a),e=a.priority,f=function(){c._reportErrors(c._showPopup(a,b.MapActivePopupView,e).then(function(){}))},g=c._getResourceLayer(d),h=c._groupLayer.clusterLayer;g&&h&&h.hasLayer(g)?h.zoomToShowLayer(g,f):f()},_onFocusResource:function(a){var c=this,d=a.priority;c._reportErrors(c._showPopup(a,b.MapFocusedPopupView,d).then(function(){}))},_onBlurResource:function(a){var c=a.priority;this._closePopup(a,b.MapFocusedPopupView,c)},_reportErrors:function(a){a.then(null,function(a){console.log(a,a.stack)})}}),b.GeoJsonMapViewAdapter=b.DataSetMapAdapter.extend({initialize:function(){var a=b.DataSetMapAdapter.prototype;a.initialize.apply(this,arguments),this._index={}},_isEmptyGeometry:function(a){return a&&a.coordinates&&a.coordinates.length&&("Point"!=a.type||a.coordinates[0]&&a.coordinates[1])?!1:!0},_clearView:function(){var a=this,b=a._groupLayer;d.each(this._index,function(a){b.removeLayer(a)}),b.clusterLayer&&(b.removeLayer(b.clusterLayer),delete b.clusterLayer),delete a._index},_doRender:function(){var a=this;this._clearView(),this._index={};var b=null,c=a._getDatasetOptions("clusterPoints",!1);if(c){var e=a._getDatasetOptions("clusterOptions",{});e=d.extend({spiderfyOnMaxZoom:!0,removeOutsideVisibleBounds:!0},e),b=new f.MarkerClusterGroup(e)}b&&(a._groupLayer.addLayer(b),a._groupLayer.clusterLayer=b),this._dataSet.loadResources({}).then(function(b){var c=b.getList();a._resourceCounter=a._resourceCounter||0,d.each(c,function(b){a._renderResourceFigure(b,a._groupLayer)},a)})},_getFigureOptions:function(a){var c=d.extend({},a.geometry.options),e=this.newResourceView(b.MapMarkerView,a);if(e){e.render(),c=d.extend(c,b.Utils.getOptions(e.options,e));var g=b.Utils.getOptions(e.icon);b.MapMarkerView.hasHtmlMarker(e)?(g.html=e.getElement().html(),g=d.extend({className:"",iconSize:[void 0,void 0]},g),c.icon=f.divIcon(g)):g.iconUrl&&(c.icon=f.icon(g))}return c.view=e,c},_renderResourceFigure:function(a,b){var c=a.geometry;if(this._isEmptyGeometry(c))return!1;var d=this._getFigureOptions(a),e=f.GeoJSON.geometryToLayer(a,function(a,b){var c=new f.Marker(b,d);return c._ismarker=!0,c},f.GeoJSON.coordsToLatLng,d);this._bindLayerEventListeners(e,function(){return a});var g=this._dataSet.getResourceId(a);this._index[g]=e,b.clusterLayer&&e._ismarker?b.clusterLayer.addLayer(e):b.addLayer(e)},_getResourceLayer:function(a){var b=this,c=b._dataSet.getResourceId(a),d=b._index[c];return d}}),b.ListItemView=b.TemplateView.extend({type:"ListItemView"}),b.ListItemView.registerViews=b._registerTypeAdapters,b.GeoJsonListViewAdapter=b.DataSetViewAdapter.extend({_doRender:function(){var a=this;a._container||(a._container=a._view.getElement()),a._doReset(),a._beginLoading(),a._dataSet.loadResources({}).then(function(c){var e=a._getMaxResultsNumber();
a._endLoading(e);var f=c.getList(e);d.each(f,function(c){var d=a.newResourceView(b.ListItemView,c);d&&(a._addResourceViewToIndex(d),a._container.append(d.getElement()),d.render())},a)})},_doReset:function(){var a=this,b=a._getResourceViews();d.each(b,function(b){a._removeResourceViewFromIndex(b)}),a._container&&a._container.html(""),a._resetViewIndex()},_onActivateResource:function(a){var b=this,c=b._dataSet.getResourceFromEvent(a),d=b._getResourceView(c);if(d){var e=d.$el.position().top+b._container.scrollTop()-b._container.position().top;b._view.$el.animate({scrollTop:e},300)}},_onEndSearch:function(){this._doRender()},_beginLoading:function(){var a=this;d.isFunction(a._view.onBeginLoading)&&a._view.onBeginLoading()},_endLoading:function(a){var b=this;d.isFunction(b._view.onEndLoading)&&b._view.onEndLoading(a)},_getMaxResultsNumber:function(){var a=this,b=200;return d.isFunction(a._view.getMaxResults)&&(b=a._view.getMaxResults()),b}}),b.ExpandedView=b.DataSetView.extend({type:"ExpandedView",setResourceView:function(a){console.log(a)}}),b.GeoJsonExpandedViewAdapter=b.ViewAdapter.extend({renderView:function(){var a=this;a._resetViewIndex(),a.listenTo(a._dataSet,"expandResource",function(c){var d=a._dataSet.getResourceFromEvent(c),e=(a._dataSet.getResourceId(d),a.newResourceView(b.ExpandedView,d));a._view.setResourceView(e)})},resetView:function(){this.stopListening()}}),b.MapTilesLoader=b.Class.extend({initialize:function(a){this.setOptions(a),void 0===this.options.useJsonP&&(this.options.useJsonP=!0),this._cache={}},getTile:function(a,b){var c=this._getKey(a,b);return this._cache[c]},loadTiles:function(a,c){var e=this,f=[];return b.Promise.all(d.map(c,function(b){var c=f.length;return f.push(null),e.loadTile(a,b).then(function(a){return f[c]=a,a})}))},loadTile:function(a,c){var d=this,e=d._getKey(a,c),f=d._cache[e];return f?b.Promise(f):d._loadTile(a,c).then(function(a){return d._cache[e]=a,a})},_loadTile:function(a,c){var d=this.options.useJsonP,e={x:c.x,y:c.y,z:a};d||(e.cb="");var f=b.IO.prepareUrl(this.options.url,e);return d?b.IO.loadJsonp(f):b.IO.loadJson(f)},_getKey:function(a,b){return a+"-"+b.x+"-"+b.y},setUrl:function(a,b){void 0!==b&&(this.options.useJsonP=!!b),this.options.url=a,this._cache={}}}),b.MapTiles=b.Class.extend({initialize:function(a){this.setOptions(a),d.defaults(this.options,{minZoom:0,maxZoom:25,tileSize:256})},setUrl:function(){this._update()},onAdd:function(a){this._map=a,this._container=this._map._container,this._update()},onRemove:function(){},_update:function(){{var a=this._map.getZoom();this.options.tileSize}if(!(a>this.options.maxZoom||a<this.options.minZoom)){var b=this._map.getPixelBounds(),c=this._getTilePosition(b.min),d=this._getTilePosition(b.max),e=this._getTilesReferencesFromCenterOut(c,d),f={queue:e},g=this;return g.fire("startLoading",f),g._loadTiles(a,e).then(function(a){f.tiles=a,g.fire("endLoading",f)},function(a){f.errors=a,g.fire("endLoading",f)}).done()}},_loadTiles:function(){return b.Promise().then(function(){throw new Error("Not implemented")})},_getTilesReferencesFromCenterOut:function(a,b){for(var c=[],d=a.y;d<=b.y;d++)for(var e=a.x;e<=b.x;e++)c.push(this._newPoint(e,d));if(c.length){var f=this,g=this._newPoint((a.x+b.x)/2,(a.y+b.y)/2);c.sort(function(a,b){var c=f._distance(a,g)-f._distance(b,g);return c})}return c},_newPoint:function(a,b){return a.length&&(b=a[1],a=a[0]),{x:a,y:b,toString:function(){return JSON.stringify(this,null,2)}}},_distance:function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},_getTilePosition:function(a){var b=this.options.tileSize;return this._newPoint(Math.floor(a.x/b),Math.floor(a.y/b))}}),b.MapTiles.UtfGrid=b.MapTiles.extend({initialize:function(a){var c=b.MapTiles.prototype;c.initialize.call(this,a),d.defaults(this.options,{resolution:4,pointerCursor:!0}),this._loader=this.options.loader||new b.MapTilesLoader(this.options)},onAdd:function(a){this._map=a,this._container=this._map._container,this._update(),a.on("click",this._click,this),a.on("mousemove",this._move,this),a.on("moveend",this._update,this)},onRemove:function(){var a=this._map;a.off("click",this._click,this),a.off("mousemove",this._move,this),a.off("moveend",this._update,this),this._removeMouseCursorStyle()},setUrl:function(a,b){this._loader.setUrl(a,b),this._update()},_loadTiles:function(a,b){return this._loader.loadTiles(a,b)},_click:function(a){this.fire("click",this._objectForEvent(a))},_move:function(a){var b=this._objectForEvent(a);b.data!==this._mouseOn?(this._mouseOn&&(this.fire("mouseout",{latlng:a.latlng,data:this._mouseOn}),this._removeMouseCursorStyle()),b.data&&(this.fire("mouseover",b),this._setMouseCursorStyle()),this._mouseOn=b.data):b.data&&this.fire("mousemove",b)},_objectForEvent:function(a){var b,c=this._map,d=c.getZoom(),e=c.project(a.latlng),f=this._getTilePosition(e),g=this._loader.getTile(d,f);return g&&(b=this._getTileObject(g,e)),{latlng:a.latlng,data:b}},_setMouseCursorStyle:function(){this.options.pointerCursor&&(this._container._utfgridCursor?this._container._utfgridCursor++:(this._container._utfgridCursor=1,this._container.style.cursor="pointer"))},_removeMouseCursorStyle:function(){this.options.pointerCursor&&this._container._utfgridCursor&&(this._container._utfgridCursor--,0===this._container._utfgridCursor&&(this._container.style.cursor="",delete this._container._utfgridCursor))},_getTileObject:function(a,b){var c=this._getTileShift(b.x),d=this._getTileShift(b.y),e=this._utfDecode(a.grid[d].charCodeAt(c)),f=a.keys[e],g=this._processData(a.data[f]);return g},getTileObjects:function(a){return a&&a.data?d.map(d.values(a.data),this._processData,this):[]},_processData:function(a){return a?(this._processDataF||(this._processDataF=this.options.processData||function(a){return a}),this._processDataF(a)):a},_getTileShift:function(a){var b=this.options.tileSize,c=this.options.resolution;return Math.floor((a-Math.floor(a/b)*b)/c)},_utfDecode:function(a){return a>=93&&a--,a>=35&&a--,a-32}}),b.TileSetMapViewAdapter=b.DataSetMapAdapter.extend({initialize:function(){var a=this,c=b.DataSetMapAdapter.prototype;c.initialize.apply(a,arguments),a._setTilesLayerVisibility(!0),a._setGridLayerVisibility(!0)},_bindDataEventListeners:function(){var a=this,c=b.DataSetMapAdapter.prototype;c._bindDataEventListeners.apply(a,arguments),a.listenTo(a._dataSet,"search:updateCriteria",function(){a._updateGridLayer(),a._updateTilesLayer()})},isTilesLayerVisible:function(){return!!this._tilesLayerVisible},isGridLayerVisible:function(){return!!this._gridLayerVisible},_setTilesLayerVisibility:function(a){this._tilesLayerVisible=!!a,this._tilesLayer&&this._groupLayer&&(this._tilesLayerVisible?this._groupLayer.addLayer(this._tilesLayer):this._groupLayer.removeLayer(this._tilesLayer))},_setGridLayerVisibility:function(a){this._gridLayerVisible=!!a,this._gridLayer&&this._groupLayer&&(this._gridLayerVisible?this._groupLayer.addLayer(this._gridLayer):this._groupLayer.removeLayer(this._gridLayer))},_getZIndex:function(){var a=this._dataSet.getOptions(),b=a.zIndex||1;return b},_removeTilesLayer:function(){this._tilesLayer&&(this._groupLayer.removeLayer(this._tilesLayer),delete this._tilesLayer)},_addTilesLayer:function(){function a(){var a=f.tileLayer(b,{attribution:c,maxZoom:e,zIndex:d});return a}var b=this._dataSet.getTilesUrl();if(b){var c=this._dataSet.getAttribution(),d=this._getZIndex(),e=this._view.getMaxZoom(),g=a();this._tilesLayer=g,this._setTilesLayerVisibility(this.isTilesLayerVisible())}},_removeGridLayer:function(){this._gridLayer&&(this._unbindLayerEventListeners(this._gridLayer),this._groupLayer.removeLayer(this._gridLayer),delete this._gridLayer)},_addGridLayer:function(){function a(a){if(d.isString(a))try{a=JSON.parse(a)}catch(b){}return a}var c=this._dataSet.getDataGridUrl();if(c){var e=new b.MapTiles.UtfGrid({url:c});this._bindLayerEventListeners(e,function(b){var c=b.data;return c?(c.geometry=a(c.geometry),c.properties=a(c.properties),c.properties&&!c.properties.type&&(c.properties.type=c.type),d.isString(c.geometry)&&(c.geometry=JSON.parse(c.geometry)),c):null}),this._gridLayer=e,this._setGridLayerVisibility(this.isGridLayerVisible())}},_refreshView:function(){this._setGridLayerVisibility(this.isGridLayerVisible()),this._setTilesLayerVisibility(this.isTilesLayerVisible())},_doRender:function(){this._removeTilesLayer(),this._removeGridLayer(),this._addTilesLayer(),this._addGridLayer(),this._refreshView(),this._rendered=!0},_updateGridLayer:function(){if(this._gridLayer){var a=this._dataSet.getDataGridUrl();a&&this._gridLayer.setUrl(a)}},_updateTilesLayer:function(){if(this._tilesLayer){var a=this._dataSet.getTilesUrl();a&&this._tilesLayer.setUrl(a)}},_onShow:function(a){a.showTiles&&this._setTilesLayerVisibility(!0),a.showGrid&&this._setGridLayerVisibility(!0)},_onHide:function(a){a.hideTiles&&this._setTilesLayerVisibility(!1),a.hideGrid&&this._setGridLayerVisibility(!1)},_onUpdate:function(){this._refreshView()},_onEndSearch:function(){}}),b.registerMapOptions=function(a){function c(e,f,g){var h=f.attr("id")||d.uniqueId("template-");if(f.attr("id",h),g=g||{},h in g)return e;g[h]=!0;var i=f.attr("data-extends");if(i){var j=a.find(i);e=c(e,j,g)}var k=b.elementToObject(f);return d.each(k,function(a){d.extend(e,a)}),e}a=e(a);var f=b.AdapterManager.getInstance();a.find("[data-map-options]").each(function(){var a=e(this),b=a.attr("data-map-options"),d="MapFigureOptions",g=c({},a);f.registerAdapter(b,d,g)})},b.registerViewAdapters=function(a){function c(b,e,f){var g=e.attr("id")||d.uniqueId("template-");if(e.attr("id",g),f=f||{},g in f)return b;f[g]=!0;var h=e.attr("data-extends");if(h){var i=a.find(h);b=c(b,i,f)}return b.extendViewType(e,b)}a=e(a);var f=b.AdapterManager.getInstance();a.find("[data-view]").each(function(){var a=e(this),d=a.attr("data-resource-type"),g=a.attr("data-view"),h=c(b.ResourceView.extend({}),a);f.registerAdapter(d,g,h)})},b.AppConfigurator=b.Class.extend({initialize:function(a){this.setOptions(a),this.app=new b.App,this._initTemplates(),this._initDataSets(),this._initDebug(),this._initViews()},getOptions:function(){return this.options||{}},start:function(){this.app.start()},stop:function(){this.app.stop()},addGeoJsonDataSet:function(a,c){var e=d.isArray(a.features)?a.features:d.toArray(a);c=d.extend({},c,{data:e});var f=new b.GeoJsonDataSet(c);this.app.addDataSet(f)},_initTemplates:function(){var a=this.getOptions(),c=e(a.templatesSelector).remove(),d="<div>"+c.html()+"</div>";b.registerViewAdapters(d)},_initDataSets:function(){var a=this.getOptions(),c=this;e(a.datalayersSelector).each(function(){var a=e(this);a.remove();var d,f=c._extractDataSetOptions(a);c._extractGeoJsonDataSetParams(a,f)?d=new b.GeoJsonDataSet(f):c._extractDatasetParams(a,f)&&(d=new b.TilesDataSet(f)),d&&c.app.addDataSet(d)})},_initDebug:function(){b.DebugDataSet=b.DataSet.extend({});var a=b.AdapterManager.getInstance();a.registerAdapter(b.MapView,b.DebugDataSet,b.ViewAdapter.extend({renderView:function(){var a=this._view.getMap();a.on("click",function(b){console.log(a.getZoom(),"["+b.latlng.lng+","+b.latlng.lat+"]")})}})),this.app.addDataSet(new b.DebugDataSet)},_initViews:function(){function a(a,e){var f=c._getOrCreateId(a);if(!d.has(c._views,f)){var g=d.isFunction(e)?e(a):e,h=b[g];h||(h=b[g]=b.DataSetView.extend({type:g}));var i;d.isFunction(h.newOptions)&&(i=h.newOptions(c.app,a)),i=i||{},i=d.extend(i,{app:c.app,el:a});var j=new h(i);c._views[f]=j}}var c=this;c._views=[];var f=c.getOptions();d.each([{selector:f.mapSelector,type:function(){return"MapView"}},{selector:f.listSelector,type:function(){return"ListView"}},{selector:f.viewsSelector||"[data-panel]",type:function(a){return a.attr("data-panel")}}],function(b){e(b.selector).each(function(){a(e(this),b.type)})})},_getOrCreateId:function(a){var b=a.attr("id");return b||(b=d.uniqueId("el-id-"),a.attr("id",b)),b},_extractDataSetOptions:function(a){var b=this,c=a.data("map-layer");c||(c=b._getOrCreateId(a));var d=a.data("visible"),e=!!a.data("force-reload");b.zIndex||(b.zIndex=1);var f=a.find(".attribution"),g={id:c,forceReload:e,attribution:f.html(),minZoom:a.data("min-zoom"),maxZoom:a.data("max-zoom"),zIndex:b.zIndex++,visible:!!d};return g},_extractGeoJsonDataSetParams:function(a,c){var e,f=!1,g=a.data("source-ref");if(g&&(e=a.find(g)),e||(e=a.find("script")),e&&e[0]){var h=[],i=b.elementToObject(e);d.each(i,function(a){var b=d.toArray(a);h=h.concat(b)}),c.data=h,f=!0}if(!f){var j=a.data("source-url");j&&(c.forceReload&&(j=this._appendRandomParam(j)),c.url=j,f=!0)}return f&&(c.clusterPoints=!!a.data("cluster-points")),f},_extractDatasetParams:function(a,b){var c=this,e=a.data("tiles-url"),f=a.data("utfgrid-url");return e||f?(b.forceReload&&(e=c._appendRandomParam(e),f=c._appendRandomParam(f)),d.extend(b,{tilesUrl:e,datagridUrl:f}),!0):!1},_appendRandomParam:function(a){if(!a)return a;var b=a.indexOf("?")<0?"?":"&";return a+=b,a+="x="+1e3*Math.random(),a+="-"+(new Date).getTime()}}),b.AppConfigurator.registerDataSetAdapter=function(a){var c=b.ViewAdapter.extend({_handleEvent:function(b){var c=this;if(c._resourceView&&(c._resourceView.remove(),c._removeResourceViewFromIndex(b.resource,c._resourceView),delete c._resourceView),c._resourceView=c.newResourceView(a.viewType,b.resource),c._resourceView){c._addResourceViewToIndex(b.resource,c._resourceView);var d=c._view;d.getElement().html(c._resourceView.getElement()),c._resourceView.render()}},renderView:function(){this.listenTo(this._dataSet,a.event,this._handleEvent)}}),d=b.AdapterManager.getInstance();return d.registerAdapter(a.viewType,a.dataSetType,c),c},b.AppConfigurator.addResourceView=function(a){function c(a){return a?d.isString(a)?[a]:d.toArray(a):[]}var e=b.AppConfigurator.registerDataSetAdapter(a);e.isValid=function(b){var e=c(a.dataSets),f=0===e.length||d.contains(e,b.dataSet.getId());return f}};var g=b.AdapterManager.getInstance();g.registerAdapter(b.MapView,b.TilesDataSet,b.TileSetMapViewAdapter),g.registerAdapter(b.MapView,b.GeoJsonDataSet,b.GeoJsonMapViewAdapter),g.registerAdapter(b.ListView,b.GeoJsonDataSet,b.GeoJsonListViewAdapter),g.registerAdapter(b.ListView,b.TilesDataSet,b.GeoJsonListViewAdapter),g.registerAdapter(b.ExpandedView,b.GeoJsonDataSet,b.GeoJsonExpandedViewAdapter)}(this)},function(b){b.exports=a},function(a){a.exports=b},function(a,b,c){a.exports=c(7),c(8),c(9),c(10),c(11)},function(a,b,c){var d,e;!function(f,g,h){var i=f.L,j={};j.version="0.7.3","object"==typeof a&&"object"==typeof a.exports?a.exports=j:(d=j,!("function"==typeof d?(e=d.call(b,c,b,a),e!==h&&(a.exports=e)):a.exports=d)),j.noConflict=function(){return f.L=i,this},f.L=j,j.Util={extend:function(a){var b,c,d,e,f=Array.prototype.slice.call(arguments,1);for(c=0,d=f.length;d>c;c++){e=f[c]||{};for(b in e)e.hasOwnProperty(b)&&(a[b]=e[b])}return a},bind:function(a,b){var c=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return a.apply(b,c||arguments)}},stamp:function(){var a=0,b="_leaflet_id";return function(c){return c[b]=c[b]||++a,c[b]}}(),invokeEach:function(a,b,c){var d,e;if("object"==typeof a){e=Array.prototype.slice.call(arguments,3);for(d in a)b.apply(c,[d,a[d]].concat(e));return!0}return!1},limitExecByInterval:function(a,b,c){var d,e;return function f(){var g=arguments;return d?void(e=!0):(d=!0,setTimeout(function(){d=!1,e&&(f.apply(c,g),e=!1)},b),void a.apply(c,g))}},falseFn:function(){return!1},formatNum:function(a,b){var c=Math.pow(10,b||5);return Math.round(a*c)/c},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},splitWords:function(a){return j.Util.trim(a).split(/\s+/)},setOptions:function(a,b){return a.options=j.extend({},a.options,b),a.options},getParamString:function(a,b,c){var d=[];for(var e in a)d.push(encodeURIComponent(c?e.toUpperCase():e)+"="+encodeURIComponent(a[e]));return(b&&-1!==b.indexOf("?")?"&":"?")+d.join("&")},template:function(a,b){return a.replace(/\{ *([\w_]+) *\}/g,function(a,c){var d=b[c];if(d===h)throw new Error("No value provided for variable "+a);return"function"==typeof d&&(d=d(b)),d})},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function a(a){var b,c,d=["webkit","moz","o","ms"];for(b=0;b<d.length&&!c;b++)c=f[d[b]+a];return c}function b(a){var b=+new Date,d=Math.max(0,16-(b-c));return c=b+d,f.setTimeout(a,d)}var c=0,d=f.requestAnimationFrame||a("RequestAnimationFrame")||b,e=f.cancelAnimationFrame||a("CancelAnimationFrame")||a("CancelRequestAnimationFrame")||function(a){f.clearTimeout(a)};j.Util.requestAnimFrame=function(a,c,e,g){return a=j.bind(a,c),e&&d===b?void a():d.call(f,a,g)},j.Util.cancelAnimFrame=function(a){a&&e.call(f,a)}}(),j.extend=j.Util.extend,j.bind=j.Util.bind,j.stamp=j.Util.stamp,j.setOptions=j.Util.setOptions,j.Class=function(){},j.Class.extend=function(a){var b=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},c=function(){};c.prototype=this.prototype;var d=new c;d.constructor=b,b.prototype=d;for(var e in this)this.hasOwnProperty(e)&&"prototype"!==e&&(b[e]=this[e]);a.statics&&(j.extend(b,a.statics),delete a.statics),a.includes&&(j.Util.extend.apply(null,[d].concat(a.includes)),delete a.includes),a.options&&d.options&&(a.options=j.extend({},d.options,a.options)),j.extend(d,a),d._initHooks=[];var f=this;return b.__super__=f.prototype,d.callInitHooks=function(){if(!this._initHooksCalled){f.prototype.callInitHooks&&f.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var a=0,b=d._initHooks.length;b>a;a++)d._initHooks[a].call(this)}},b},j.Class.include=function(a){j.extend(this.prototype,a)},j.Class.mergeOptions=function(a){j.extend(this.prototype.options,a)},j.Class.addInitHook=function(a){var b=Array.prototype.slice.call(arguments,1),c="function"==typeof a?a:function(){this[a].apply(this,b)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(c)};var k="_leaflet_events";j.Mixin={},j.Mixin.Events={addEventListener:function(a,b,c){if(j.Util.invokeEach(a,this.addEventListener,this,b,c))return this;var d,e,f,g,h,i,l,m=this[k]=this[k]||{},n=c&&c!==this&&j.stamp(c);for(a=j.Util.splitWords(a),d=0,e=a.length;e>d;d++)f={action:b,context:c||this},g=a[d],n?(h=g+"_idx",i=h+"_len",l=m[h]=m[h]||{},l[n]||(l[n]=[],m[i]=(m[i]||0)+1),l[n].push(f)):(m[g]=m[g]||[],m[g].push(f));return this},hasEventListeners:function(a){var b=this[k];return!!b&&(a in b&&b[a].length>0||a+"_idx"in b&&b[a+"_idx_len"]>0)},removeEventListener:function(a,b,c){if(!this[k])return this;if(!a)return this.clearAllEventListeners();if(j.Util.invokeEach(a,this.removeEventListener,this,b,c))return this;var d,e,f,g,h,i,l,m,n,o=this[k],p=c&&c!==this&&j.stamp(c);for(a=j.Util.splitWords(a),d=0,e=a.length;e>d;d++)if(f=a[d],i=f+"_idx",l=i+"_len",m=o[i],b){if(g=p&&m?m[p]:o[f]){for(h=g.length-1;h>=0;h--)g[h].action!==b||c&&g[h].context!==c||(n=g.splice(h,1),n[0].action=j.Util.falseFn);c&&m&&0===g.length&&(delete m[p],o[l]--)}}else delete o[f],delete o[i],delete o[l];return this},clearAllEventListeners:function(){return delete this[k],this},fireEvent:function(a,b){if(!this.hasEventListeners(a))return this;var c,d,e,f,g,h=j.Util.extend({},b,{type:a,target:this}),i=this[k];if(i[a])for(c=i[a].slice(),d=0,e=c.length;e>d;d++)c[d].action.call(c[d].context,h);f=i[a+"_idx"];for(g in f)if(c=f[g].slice())for(d=0,e=c.length;e>d;d++)c[d].action.call(c[d].context,h);return this},addOneTimeEventListener:function(a,b,c){if(j.Util.invokeEach(a,this.addOneTimeEventListener,this,b,c))return this;var d=j.bind(function(){this.removeEventListener(a,b,c).removeEventListener(a,d,c)},this);return this.addEventListener(a,b,c).addEventListener(a,d,c)}},j.Mixin.Events.on=j.Mixin.Events.addEventListener,j.Mixin.Events.off=j.Mixin.Events.removeEventListener,j.Mixin.Events.once=j.Mixin.Events.addOneTimeEventListener,j.Mixin.Events.fire=j.Mixin.Events.fireEvent,function(){var a="ActiveXObject"in f,b=a&&!g.addEventListener,c=navigator.userAgent.toLowerCase(),d=-1!==c.indexOf("webkit"),e=-1!==c.indexOf("chrome"),i=-1!==c.indexOf("phantom"),k=-1!==c.indexOf("android"),l=-1!==c.search("android [23]"),m=-1!==c.indexOf("gecko"),n=typeof orientation!=h+"",o=f.navigator&&f.navigator.msPointerEnabled&&f.navigator.msMaxTouchPoints&&!f.PointerEvent,p=f.PointerEvent&&f.navigator.pointerEnabled&&f.navigator.maxTouchPoints||o,q="devicePixelRatio"in f&&f.devicePixelRatio>1||"matchMedia"in f&&f.matchMedia("(min-resolution:144dpi)")&&f.matchMedia("(min-resolution:144dpi)").matches,r=g.documentElement,s=a&&"transition"in r.style,t="WebKitCSSMatrix"in f&&"m11"in new f.WebKitCSSMatrix&&!l,u="MozPerspective"in r.style,v="OTransition"in r.style,w=!f.L_DISABLE_3D&&(s||t||u||v)&&!i,x=!f.L_NO_TOUCH&&!i&&function(){var a="ontouchstart";if(p||a in r)return!0;var b=g.createElement("div"),c=!1;return b.setAttribute?(b.setAttribute(a,"return;"),"function"==typeof b[a]&&(c=!0),b.removeAttribute(a),b=null,c):!1}();j.Browser={ie:a,ielt9:b,webkit:d,gecko:m&&!d&&!f.opera&&!a,android:k,android23:l,chrome:e,ie3d:s,webkit3d:t,gecko3d:u,opera3d:v,any3d:w,mobile:n,mobileWebkit:n&&d,mobileWebkit3d:n&&t,mobileOpera:n&&f.opera,touch:x,msPointer:o,pointer:p,retina:q}}(),j.Point=function(a,b,c){this.x=c?Math.round(a):a,this.y=c?Math.round(b):b},j.Point.prototype={clone:function(){return new j.Point(this.x,this.y)},add:function(a){return this.clone()._add(j.point(a))},_add:function(a){return this.x+=a.x,this.y+=a.y,this},subtract:function(a){return this.clone()._subtract(j.point(a))},_subtract:function(a){return this.x-=a.x,this.y-=a.y,this},divideBy:function(a){return this.clone()._divideBy(a)},_divideBy:function(a){return this.x/=a,this.y/=a,this},multiplyBy:function(a){return this.clone()._multiplyBy(a)},_multiplyBy:function(a){return this.x*=a,this.y*=a,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(a){a=j.point(a);var b=a.x-this.x,c=a.y-this.y;return Math.sqrt(b*b+c*c)},equals:function(a){return a=j.point(a),a.x===this.x&&a.y===this.y},contains:function(a){return a=j.point(a),Math.abs(a.x)<=Math.abs(this.x)&&Math.abs(a.y)<=Math.abs(this.y)},toString:function(){return"Point("+j.Util.formatNum(this.x)+", "+j.Util.formatNum(this.y)+")"}},j.point=function(a,b,c){return a instanceof j.Point?a:j.Util.isArray(a)?new j.Point(a[0],a[1]):a===h||null===a?a:new j.Point(a,b,c)},j.Bounds=function(a,b){if(a)for(var c=b?[a,b]:a,d=0,e=c.length;e>d;d++)this.extend(c[d])},j.Bounds.prototype={extend:function(a){return a=j.point(a),this.min||this.max?(this.min.x=Math.min(a.x,this.min.x),this.max.x=Math.max(a.x,this.max.x),this.min.y=Math.min(a.y,this.min.y),this.max.y=Math.max(a.y,this.max.y)):(this.min=a.clone(),this.max=a.clone()),this},getCenter:function(a){return new j.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,a)},getBottomLeft:function(){return new j.Point(this.min.x,this.max.y)},getTopRight:function(){return new j.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(a){var b,c;return a="number"==typeof a[0]||a instanceof j.Point?j.point(a):j.bounds(a),a instanceof j.Bounds?(b=a.min,c=a.max):b=c=a,b.x>=this.min.x&&c.x<=this.max.x&&b.y>=this.min.y&&c.y<=this.max.y},intersects:function(a){a=j.bounds(a);var b=this.min,c=this.max,d=a.min,e=a.max,f=e.x>=b.x&&d.x<=c.x,g=e.y>=b.y&&d.y<=c.y;return f&&g},isValid:function(){return!(!this.min||!this.max)}},j.bounds=function(a,b){return!a||a instanceof j.Bounds?a:new j.Bounds(a,b)},j.Transformation=function(a,b,c,d){this._a=a,this._b=b,this._c=c,this._d=d},j.Transformation.prototype={transform:function(a,b){return this._transform(a.clone(),b)},_transform:function(a,b){return b=b||1,a.x=b*(this._a*a.x+this._b),a.y=b*(this._c*a.y+this._d),a},untransform:function(a,b){return b=b||1,new j.Point((a.x/b-this._b)/this._a,(a.y/b-this._d)/this._c)}},j.DomUtil={get:function(a){return"string"==typeof a?g.getElementById(a):a},getStyle:function(a,b){var c=a.style[b];if(!c&&a.currentStyle&&(c=a.currentStyle[b]),(!c||"auto"===c)&&g.defaultView){var d=g.defaultView.getComputedStyle(a,null);c=d?d[b]:null}return"auto"===c?null:c},getViewportOffset:function(a){var b,c=0,d=0,e=a,f=g.body,h=g.documentElement;do{if(c+=e.offsetTop||0,d+=e.offsetLeft||0,c+=parseInt(j.DomUtil.getStyle(e,"borderTopWidth"),10)||0,d+=parseInt(j.DomUtil.getStyle(e,"borderLeftWidth"),10)||0,b=j.DomUtil.getStyle(e,"position"),e.offsetParent===f&&"absolute"===b)break;if("fixed"===b){c+=f.scrollTop||h.scrollTop||0,d+=f.scrollLeft||h.scrollLeft||0;break}if("relative"===b&&!e.offsetLeft){var i=j.DomUtil.getStyle(e,"width"),k=j.DomUtil.getStyle(e,"max-width"),l=e.getBoundingClientRect();("none"!==i||"none"!==k)&&(d+=l.left+e.clientLeft),c+=l.top+(f.scrollTop||h.scrollTop||0);break}e=e.offsetParent}while(e);e=a;do{if(e===f)break;c-=e.scrollTop||0,d-=e.scrollLeft||0,e=e.parentNode}while(e);return new j.Point(d,c)},documentIsLtr:function(){return j.DomUtil._docIsLtrCached||(j.DomUtil._docIsLtrCached=!0,j.DomUtil._docIsLtr="ltr"===j.DomUtil.getStyle(g.body,"direction")),j.DomUtil._docIsLtr},create:function(a,b,c){var d=g.createElement(a);return d.className=b,c&&c.appendChild(d),d},hasClass:function(a,b){if(a.classList!==h)return a.classList.contains(b);var c=j.DomUtil._getClass(a);return c.length>0&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)},addClass:function(a,b){if(a.classList!==h)for(var c=j.Util.splitWords(b),d=0,e=c.length;e>d;d++)a.classList.add(c[d]);else if(!j.DomUtil.hasClass(a,b)){var f=j.DomUtil._getClass(a);j.DomUtil._setClass(a,(f?f+" ":"")+b)}},removeClass:function(a,b){a.classList!==h?a.classList.remove(b):j.DomUtil._setClass(a,j.Util.trim((" "+j.DomUtil._getClass(a)+" ").replace(" "+b+" "," ")))},_setClass:function(a,b){a.className.baseVal===h?a.className=b:a.className.baseVal=b},_getClass:function(a){return a.className.baseVal===h?a.className:a.className.baseVal},setOpacity:function(a,b){if("opacity"in a.style)a.style.opacity=b;else if("filter"in a.style){var c=!1,d="DXImageTransform.Microsoft.Alpha";try{c=a.filters.item(d)}catch(e){if(1===b)return}b=Math.round(100*b),c?(c.Enabled=100!==b,c.Opacity=b):a.style.filter+=" progid:"+d+"(opacity="+b+")"}},testProp:function(a){for(var b=g.documentElement.style,c=0;c<a.length;c++)if(a[c]in b)return a[c];return!1},getTranslateString:function(a){var b=j.Browser.webkit3d,c="translate"+(b?"3d":"")+"(",d=(b?",0":"")+")";return c+a.x+"px,"+a.y+"px"+d},getScaleString:function(a,b){var c=j.DomUtil.getTranslateString(b.add(b.multiplyBy(-1*a))),d=" scale("+a+") ";return c+d},setPosition:function(a,b,c){a._leaflet_pos=b,!c&&j.Browser.any3d?a.style[j.DomUtil.TRANSFORM]=j.DomUtil.getTranslateString(b):(a.style.left=b.x+"px",a.style.top=b.y+"px")},getPosition:function(a){return a._leaflet_pos}},j.DomUtil.TRANSFORM=j.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),j.DomUtil.TRANSITION=j.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),j.DomUtil.TRANSITION_END="webkitTransition"===j.DomUtil.TRANSITION||"OTransition"===j.DomUtil.TRANSITION?j.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart"in g)j.extend(j.DomUtil,{disableTextSelection:function(){j.DomEvent.on(f,"selectstart",j.DomEvent.preventDefault)},enableTextSelection:function(){j.DomEvent.off(f,"selectstart",j.DomEvent.preventDefault)}});else{var a=j.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);j.extend(j.DomUtil,{disableTextSelection:function(){if(a){var b=g.documentElement.style;this._userSelect=b[a],b[a]="none"}},enableTextSelection:function(){a&&(g.documentElement.style[a]=this._userSelect,delete this._userSelect)}})}j.extend(j.DomUtil,{disableImageDrag:function(){j.DomEvent.on(f,"dragstart",j.DomEvent.preventDefault)},enableImageDrag:function(){j.DomEvent.off(f,"dragstart",j.DomEvent.preventDefault)}})}(),j.LatLng=function(a,b,c){if(a=parseFloat(a),b=parseFloat(b),isNaN(a)||isNaN(b))throw new Error("Invalid LatLng object: ("+a+", "+b+")");this.lat=a,this.lng=b,c!==h&&(this.alt=parseFloat(c))},j.extend(j.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),j.LatLng.prototype={equals:function(a){if(!a)return!1;a=j.latLng(a);var b=Math.max(Math.abs(this.lat-a.lat),Math.abs(this.lng-a.lng));return b<=j.LatLng.MAX_MARGIN},toString:function(a){return"LatLng("+j.Util.formatNum(this.lat,a)+", "+j.Util.formatNum(this.lng,a)+")"},distanceTo:function(a){a=j.latLng(a);var b=6378137,c=j.LatLng.DEG_TO_RAD,d=(a.lat-this.lat)*c,e=(a.lng-this.lng)*c,f=this.lat*c,g=a.lat*c,h=Math.sin(d/2),i=Math.sin(e/2),k=h*h+i*i*Math.cos(f)*Math.cos(g);return 2*b*Math.atan2(Math.sqrt(k),Math.sqrt(1-k))},wrap:function(a,b){var c=this.lng;return a=a||-180,b=b||180,c=(c+b)%(b-a)+(a>c||c===b?b:a),new j.LatLng(this.lat,c)}},j.latLng=function(a,b){return a instanceof j.LatLng?a:j.Util.isArray(a)?"number"==typeof a[0]||"string"==typeof a[0]?new j.LatLng(a[0],a[1],a[2]):null:a===h||null===a?a:"object"==typeof a&&"lat"in a?new j.LatLng(a.lat,"lng"in a?a.lng:a.lon):b===h?null:new j.LatLng(a,b)},j.LatLngBounds=function(a,b){if(a)for(var c=b?[a,b]:a,d=0,e=c.length;e>d;d++)this.extend(c[d])},j.LatLngBounds.prototype={extend:function(a){if(!a)return this;var b=j.latLng(a);return a=null!==b?b:j.latLngBounds(a),a instanceof j.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(a.lat,this._southWest.lat),this._southWest.lng=Math.min(a.lng,this._southWest.lng),this._northEast.lat=Math.max(a.lat,this._northEast.lat),this._northEast.lng=Math.max(a.lng,this._northEast.lng)):(this._southWest=new j.LatLng(a.lat,a.lng),this._northEast=new j.LatLng(a.lat,a.lng)):a instanceof j.LatLngBounds&&(this.extend(a._southWest),this.extend(a._northEast)),this},pad:function(a){var b=this._southWest,c=this._northEast,d=Math.abs(b.lat-c.lat)*a,e=Math.abs(b.lng-c.lng)*a;return new j.LatLngBounds(new j.LatLng(b.lat-d,b.lng-e),new j.LatLng(c.lat+d,c.lng+e))},getCenter:function(){return new j.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new j.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new j.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(a){a="number"==typeof a[0]||a instanceof j.LatLng?j.latLng(a):j.latLngBounds(a);var b,c,d=this._southWest,e=this._northEast;return a instanceof j.LatLngBounds?(b=a.getSouthWest(),c=a.getNorthEast()):b=c=a,b.lat>=d.lat&&c.lat<=e.lat&&b.lng>=d.lng&&c.lng<=e.lng},intersects:function(a){a=j.latLngBounds(a);var b=this._southWest,c=this._northEast,d=a.getSouthWest(),e=a.getNorthEast(),f=e.lat>=b.lat&&d.lat<=c.lat,g=e.lng>=b.lng&&d.lng<=c.lng;return f&&g},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(a){return a?(a=j.latLngBounds(a),this._southWest.equals(a.getSouthWest())&&this._northEast.equals(a.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},j.latLngBounds=function(a,b){return!a||a instanceof j.LatLngBounds?a:new j.LatLngBounds(a,b)},j.Projection={},j.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(a){var b=j.LatLng.DEG_TO_RAD,c=this.MAX_LATITUDE,d=Math.max(Math.min(c,a.lat),-c),e=a.lng*b,f=d*b;return f=Math.log(Math.tan(Math.PI/4+f/2)),new j.Point(e,f)},unproject:function(a){var b=j.LatLng.RAD_TO_DEG,c=a.x*b,d=(2*Math.atan(Math.exp(a.y))-Math.PI/2)*b;return new j.LatLng(d,c)
}},j.Projection.LonLat={project:function(a){return new j.Point(a.lng,a.lat)},unproject:function(a){return new j.LatLng(a.y,a.x)}},j.CRS={latLngToPoint:function(a,b){var c=this.projection.project(a),d=this.scale(b);return this.transformation._transform(c,d)},pointToLatLng:function(a,b){var c=this.scale(b),d=this.transformation.untransform(a,c);return this.projection.unproject(d)},project:function(a){return this.projection.project(a)},scale:function(a){return 256*Math.pow(2,a)},getSize:function(a){var b=this.scale(a);return j.point(b,b)}},j.CRS.Simple=j.extend({},j.CRS,{projection:j.Projection.LonLat,transformation:new j.Transformation(1,0,-1,0),scale:function(a){return Math.pow(2,a)}}),j.CRS.EPSG3857=j.extend({},j.CRS,{code:"EPSG:3857",projection:j.Projection.SphericalMercator,transformation:new j.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(a){var b=this.projection.project(a),c=6378137;return b.multiplyBy(c)}}),j.CRS.EPSG900913=j.extend({},j.CRS.EPSG3857,{code:"EPSG:900913"}),j.CRS.EPSG4326=j.extend({},j.CRS,{code:"EPSG:4326",projection:j.Projection.LonLat,transformation:new j.Transformation(1/360,.5,-1/360,.5)}),j.Map=j.Class.extend({includes:j.Mixin.Events,options:{crs:j.CRS.EPSG3857,fadeAnimation:j.DomUtil.TRANSITION&&!j.Browser.android23,trackResize:!0,markerZoomAnimation:j.DomUtil.TRANSITION&&j.Browser.any3d},initialize:function(a,b){b=j.setOptions(this,b),this._initContainer(a),this._initLayout(),this._onResize=j.bind(this._onResize,this),this._initEvents(),b.maxBounds&&this.setMaxBounds(b.maxBounds),b.center&&b.zoom!==h&&this.setView(j.latLng(b.center),b.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(b.layers)},setView:function(a,b){return b=b===h?this.getZoom():b,this._resetView(j.latLng(a),this._limitZoom(b)),this},setZoom:function(a,b){return this._loaded?this.setView(this.getCenter(),a,{zoom:b}):(this._zoom=this._limitZoom(a),this)},zoomIn:function(a,b){return this.setZoom(this._zoom+(a||1),b)},zoomOut:function(a,b){return this.setZoom(this._zoom-(a||1),b)},setZoomAround:function(a,b,c){var d=this.getZoomScale(b),e=this.getSize().divideBy(2),f=a instanceof j.Point?a:this.latLngToContainerPoint(a),g=f.subtract(e).multiplyBy(1-1/d),h=this.containerPointToLatLng(e.add(g));return this.setView(h,b,{zoom:c})},fitBounds:function(a,b){b=b||{},a=a.getBounds?a.getBounds():j.latLngBounds(a);var c=j.point(b.paddingTopLeft||b.padding||[0,0]),d=j.point(b.paddingBottomRight||b.padding||[0,0]),e=this.getBoundsZoom(a,!1,c.add(d)),f=d.subtract(c).divideBy(2),g=this.project(a.getSouthWest(),e),h=this.project(a.getNorthEast(),e),i=this.unproject(g.add(h).divideBy(2).add(f),e);return e=b&&b.maxZoom?Math.min(b.maxZoom,e):e,this.setView(i,e,b)},fitWorld:function(a){return this.fitBounds([[-90,-180],[90,180]],a)},panTo:function(a,b){return this.setView(a,this._zoom,{pan:b})},panBy:function(a){return this.fire("movestart"),this._rawPanBy(j.point(a)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(a){return a=j.latLngBounds(a),this.options.maxBounds=a,a?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(a,b){var c=this.getCenter(),d=this._limitCenter(c,this._zoom,a);return c.equals(d)?this:this.panTo(d,b)},addLayer:function(a){var b=j.stamp(a);return this._layers[b]?this:(this._layers[b]=a,!a.options||isNaN(a.options.maxZoom)&&isNaN(a.options.minZoom)||(this._zoomBoundLayers[b]=a,this._updateZoomLevels()),this.options.zoomAnimation&&j.TileLayer&&a instanceof j.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,a.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(a),this)},removeLayer:function(a){var b=j.stamp(a);return this._layers[b]?(this._loaded&&a.onRemove(this),delete this._layers[b],this._loaded&&this.fire("layerremove",{layer:a}),this._zoomBoundLayers[b]&&(delete this._zoomBoundLayers[b],this._updateZoomLevels()),this.options.zoomAnimation&&j.TileLayer&&a instanceof j.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,a.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(a){return a?j.stamp(a)in this._layers:!1},eachLayer:function(a,b){for(var c in this._layers)a.call(b,this._layers[c]);return this},invalidateSize:function(a){if(!this._loaded)return this;a=j.extend({animate:!1,pan:!0},a===!0?{animate:!0}:a);var b=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var c=this.getSize(),d=b.divideBy(2).round(),e=c.divideBy(2).round(),f=d.subtract(e);return f.x||f.y?(a.animate&&a.pan?this.panBy(f):(a.pan&&this._rawPanBy(f),this.fire("move"),a.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(j.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:b,newSize:c})):this},addHandler:function(a,b){if(!b)return this;var c=this[a]=new b(this);return this._handlers.push(c),this.options[a]&&c.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(a){this._container._leaflet=h}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var a=this.getPixelBounds(),b=this.unproject(a.getBottomLeft()),c=this.unproject(a.getTopRight());return new j.LatLngBounds(b,c)},getMinZoom:function(){return this.options.minZoom===h?this._layersMinZoom===h?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===h?this._layersMaxZoom===h?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(a,b,c){a=j.latLngBounds(a);var d,e=this.getMinZoom()-(b?1:0),f=this.getMaxZoom(),g=this.getSize(),h=a.getNorthWest(),i=a.getSouthEast(),k=!0;c=j.point(c||[0,0]);do e++,d=this.project(i,e).subtract(this.project(h,e)).add(c),k=b?d.x<g.x||d.y<g.y:g.contains(d);while(k&&f>=e);return k&&b?null:b?e:e-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new j.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var a=this._getTopLeftPoint();return new j.Bounds(a,a.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(a){var b=this.options.crs;return b.scale(a)/b.scale(this._zoom)},getScaleZoom:function(a){return this._zoom+Math.log(a)/Math.LN2},project:function(a,b){return b=b===h?this._zoom:b,this.options.crs.latLngToPoint(j.latLng(a),b)},unproject:function(a,b){return b=b===h?this._zoom:b,this.options.crs.pointToLatLng(j.point(a),b)},layerPointToLatLng:function(a){var b=j.point(a).add(this.getPixelOrigin());return this.unproject(b)},latLngToLayerPoint:function(a){var b=this.project(j.latLng(a))._round();return b._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(a){return j.point(a).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(a){return j.point(a).add(this._getMapPanePos())},containerPointToLatLng:function(a){var b=this.containerPointToLayerPoint(j.point(a));return this.layerPointToLatLng(b)},latLngToContainerPoint:function(a){return this.layerPointToContainerPoint(this.latLngToLayerPoint(j.latLng(a)))},mouseEventToContainerPoint:function(a){return j.DomEvent.getMousePosition(a,this._container)},mouseEventToLayerPoint:function(a){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(a))},mouseEventToLatLng:function(a){return this.layerPointToLatLng(this.mouseEventToLayerPoint(a))},_initContainer:function(a){var b=this._container=j.DomUtil.get(a);if(!b)throw new Error("Map container not found.");if(b._leaflet)throw new Error("Map container is already initialized.");b._leaflet=!0},_initLayout:function(){var a=this._container;j.DomUtil.addClass(a,"leaflet-container"+(j.Browser.touch?" leaflet-touch":"")+(j.Browser.retina?" leaflet-retina":"")+(j.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var b=j.DomUtil.getStyle(a,"position");"absolute"!==b&&"relative"!==b&&"fixed"!==b&&(a.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var a=this._panes={};this._mapPane=a.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=a.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),a.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),a.shadowPane=this._createPane("leaflet-shadow-pane"),a.overlayPane=this._createPane("leaflet-overlay-pane"),a.markerPane=this._createPane("leaflet-marker-pane"),a.popupPane=this._createPane("leaflet-popup-pane");var b=" leaflet-zoom-hide";this.options.markerZoomAnimation||(j.DomUtil.addClass(a.markerPane,b),j.DomUtil.addClass(a.shadowPane,b),j.DomUtil.addClass(a.popupPane,b))},_createPane:function(a,b){return j.DomUtil.create("div",a,b||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(a){a=a?j.Util.isArray(a)?a:[a]:[];for(var b=0,c=a.length;c>b;b++)this.addLayer(a[b])},_resetView:function(a,b,c,d){var e=this._zoom!==b;d||(this.fire("movestart"),e&&this.fire("zoomstart")),this._zoom=b,this._initialCenter=a,this._initialTopLeftPoint=this._getNewTopLeftPoint(a),c?this._initialTopLeftPoint._add(this._getMapPanePos()):j.DomUtil.setPosition(this._mapPane,new j.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var f=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!c}),f&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(e||d)&&this.fire("zoomend"),this.fire("moveend",{hard:!c})},_rawPanBy:function(a){j.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(a))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var a,b=1/0,c=-1/0,d=this._getZoomSpan();for(a in this._zoomBoundLayers){var e=this._zoomBoundLayers[a];isNaN(e.options.minZoom)||(b=Math.min(b,e.options.minZoom)),isNaN(e.options.maxZoom)||(c=Math.max(c,e.options.maxZoom))}a===h?this._layersMaxZoom=this._layersMinZoom=h:(this._layersMaxZoom=c,this._layersMinZoom=b),d!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(a){if(j.DomEvent){a=a||"on",j.DomEvent[a](this._container,"click",this._onMouseClick,this);var b,c,d=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(b=0,c=d.length;c>b;b++)j.DomEvent[a](this._container,d[b],this._fireMouseEvent,this);this.options.trackResize&&j.DomEvent[a](f,"resize",this._onResize,this)}},_onResize:function(){j.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=j.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(a){!this._loaded||!a._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||j.DomEvent._skipped(a)||(this.fire("preclick"),this._fireMouseEvent(a))},_fireMouseEvent:function(a){if(this._loaded&&!j.DomEvent._skipped(a)){var b=a.type;if(b="mouseenter"===b?"mouseover":"mouseleave"===b?"mouseout":b,this.hasEventListeners(b)){"contextmenu"===b&&j.DomEvent.preventDefault(a);var c=this.mouseEventToContainerPoint(a),d=this.containerPointToLayerPoint(c),e=this.layerPointToLatLng(d);this.fire(b,{latlng:e,layerPoint:d,containerPoint:c,originalEvent:a})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var a=0,b=this._handlers.length;b>a;a++)this._handlers[a].disable()},whenReady:function(a,b){return this._loaded?a.call(b||this,this):this.on("load",a,b),this},_layerAdd:function(a){a.onAdd(this),this.fire("layeradd",{layer:a})},_getMapPanePos:function(){return j.DomUtil.getPosition(this._mapPane)},_moved:function(){var a=this._getMapPanePos();return a&&!a.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(a,b){var c=this.getSize()._divideBy(2);return this.project(a,b)._subtract(c)._round()},_latLngToNewLayerPoint:function(a,b,c){var d=this._getNewTopLeftPoint(c,b).add(this._getMapPanePos());return this.project(a,b)._subtract(d)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(a){return this.latLngToLayerPoint(a).subtract(this._getCenterLayerPoint())},_limitCenter:function(a,b,c){if(!c)return a;var d=this.project(a,b),e=this.getSize().divideBy(2),f=new j.Bounds(d.subtract(e),d.add(e)),g=this._getBoundsOffset(f,c,b);return this.unproject(d.add(g),b)},_limitOffset:function(a,b){if(!b)return a;var c=this.getPixelBounds(),d=new j.Bounds(c.min.add(a),c.max.add(a));return a.add(this._getBoundsOffset(d,b))},_getBoundsOffset:function(a,b,c){var d=this.project(b.getNorthWest(),c).subtract(a.min),e=this.project(b.getSouthEast(),c).subtract(a.max),f=this._rebound(d.x,-e.x),g=this._rebound(d.y,-e.y);return new j.Point(f,g)},_rebound:function(a,b){return a+b>0?Math.round(a-b)/2:Math.max(0,Math.ceil(a))-Math.max(0,Math.floor(b))},_limitZoom:function(a){var b=this.getMinZoom(),c=this.getMaxZoom();return Math.max(b,Math.min(c,a))}}),j.map=function(a,b){return new j.Map(a,b)},j.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(a){var b=j.LatLng.DEG_TO_RAD,c=this.MAX_LATITUDE,d=Math.max(Math.min(c,a.lat),-c),e=this.R_MAJOR,f=this.R_MINOR,g=a.lng*b*e,h=d*b,i=f/e,k=Math.sqrt(1-i*i),l=k*Math.sin(h);l=Math.pow((1-l)/(1+l),.5*k);var m=Math.tan(.5*(.5*Math.PI-h))/l;return h=-e*Math.log(m),new j.Point(g,h)},unproject:function(a){for(var b,c=j.LatLng.RAD_TO_DEG,d=this.R_MAJOR,e=this.R_MINOR,f=a.x*c/d,g=e/d,h=Math.sqrt(1-g*g),i=Math.exp(-a.y/d),k=Math.PI/2-2*Math.atan(i),l=15,m=1e-7,n=l,o=.1;Math.abs(o)>m&&--n>0;)b=h*Math.sin(k),o=Math.PI/2-2*Math.atan(i*Math.pow((1-b)/(1+b),.5*h))-k,k+=o;return new j.LatLng(k*c,f)}},j.CRS.EPSG3395=j.extend({},j.CRS,{code:"EPSG:3395",projection:j.Projection.Mercator,transformation:function(){var a=j.Projection.Mercator,b=a.R_MAJOR,c=.5/(Math.PI*b);return new j.Transformation(c,.5,-c,.5)}()}),j.TileLayer=j.Class.extend({includes:j.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:j.Browser.mobile,updateWhenIdle:j.Browser.mobile},initialize:function(a,b){b=j.setOptions(this,b),b.detectRetina&&j.Browser.retina&&b.maxZoom>0&&(b.tileSize=Math.floor(b.tileSize/2),b.zoomOffset++,b.minZoom>0&&b.minZoom--,this.options.maxZoom--),b.bounds&&(b.bounds=j.latLngBounds(b.bounds)),this._url=a;var c=this.options.subdomains;"string"==typeof c&&(this.options.subdomains=c.split(""))},onAdd:function(a){this._map=a,this._animated=a._zoomAnimated,this._initContainer(),a.on({viewreset:this._reset,moveend:this._update},this),this._animated&&a.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=j.Util.limitExecByInterval(this._update,150,this),a.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){this._container.parentNode.removeChild(this._container),a.off({viewreset:this._reset,moveend:this._update},this),this._animated&&a.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||a.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var a=this._map._panes.tilePane;return this._container&&(a.appendChild(this._container),this._setAutoZIndex(a,Math.max)),this},bringToBack:function(){var a=this._map._panes.tilePane;return this._container&&(a.insertBefore(this._container,a.firstChild),this._setAutoZIndex(a,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(a){return this.options.opacity=a,this._map&&this._updateOpacity(),this},setZIndex:function(a){return this.options.zIndex=a,this._updateZIndex(),this},setUrl:function(a,b){return this._url=a,b||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==h&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(a,b){var c,d,e,f=a.children,g=-b(1/0,-1/0);for(d=0,e=f.length;e>d;d++)f[d]!==this._container&&(c=parseInt(f[d].style.zIndex,10),isNaN(c)||(g=b(g,c)));this.options.zIndex=this._container.style.zIndex=(isFinite(g)?g:0)+b(1,-1)},_updateOpacity:function(){var a,b=this._tiles;if(j.Browser.ielt9)for(a in b)j.DomUtil.setOpacity(b[a],this.options.opacity);else j.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var a=this._map._panes.tilePane;if(!this._container){if(this._container=j.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var b="leaflet-tile-container";this._bgBuffer=j.DomUtil.create("div",b,this._container),this._tileContainer=j.DomUtil.create("div",b,this._container)}else this._tileContainer=this._container;a.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(a){for(var b in this._tiles)this.fire("tileunload",{tile:this._tiles[b]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&a&&a.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var a=this._map,b=a.getZoom()+this.options.zoomOffset,c=this.options.maxNativeZoom,d=this.options.tileSize;return c&&b>c&&(d=Math.round(a.getZoomScale(b)/a.getZoomScale(c)*d)),d},_update:function(){if(this._map){var a=this._map,b=a.getPixelBounds(),c=a.getZoom(),d=this._getTileSize();if(!(c>this.options.maxZoom||c<this.options.minZoom)){var e=j.bounds(b.min.divideBy(d)._floor(),b.max.divideBy(d)._floor());this._addTilesFromCenterOut(e),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(e)}}},_addTilesFromCenterOut:function(a){var b,c,d,e=[],f=a.getCenter();for(b=a.min.y;b<=a.max.y;b++)for(c=a.min.x;c<=a.max.x;c++)d=new j.Point(c,b),this._tileShouldBeLoaded(d)&&e.push(d);var h=e.length;if(0!==h){e.sort(function(a,b){return a.distanceTo(f)-b.distanceTo(f)});var i=g.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=h,c=0;h>c;c++)this._addTile(e[c],i);this._tileContainer.appendChild(i)}},_tileShouldBeLoaded:function(a){if(a.x+":"+a.y in this._tiles)return!1;var b=this.options;if(!b.continuousWorld){var c=this._getWrapTileNum();if(b.noWrap&&(a.x<0||a.x>=c.x)||a.y<0||a.y>=c.y)return!1}if(b.bounds){var d=b.tileSize,e=a.multiplyBy(d),f=e.add([d,d]),g=this._map.unproject(e),h=this._map.unproject(f);if(b.continuousWorld||b.noWrap||(g=g.wrap(),h=h.wrap()),!b.bounds.intersects([g,h]))return!1}return!0},_removeOtherTiles:function(a){var b,c,d,e;for(e in this._tiles)b=e.split(":"),c=parseInt(b[0],10),d=parseInt(b[1],10),(c<a.min.x||c>a.max.x||d<a.min.y||d>a.max.y)&&this._removeTile(e)},_removeTile:function(a){var b=this._tiles[a];this.fire("tileunload",{tile:b,url:b.src}),this.options.reuseTiles?(j.DomUtil.removeClass(b,"leaflet-tile-loaded"),this._unusedTiles.push(b)):b.parentNode===this._tileContainer&&this._tileContainer.removeChild(b),j.Browser.android||(b.onload=null,b.src=j.Util.emptyImageUrl),delete this._tiles[a]},_addTile:function(a,b){var c=this._getTilePos(a),d=this._getTile();j.DomUtil.setPosition(d,c,j.Browser.chrome),this._tiles[a.x+":"+a.y]=d,this._loadTile(d,a),d.parentNode!==this._tileContainer&&b.appendChild(d)},_getZoomForUrl:function(){var a=this.options,b=this._map.getZoom();return a.zoomReverse&&(b=a.maxZoom-b),b+=a.zoomOffset,a.maxNativeZoom?Math.min(b,a.maxNativeZoom):b},_getTilePos:function(a){var b=this._map.getPixelOrigin(),c=this._getTileSize();return a.multiplyBy(c).subtract(b)},getTileUrl:function(a){return j.Util.template(this._url,j.extend({s:this._getSubdomain(a),z:a.z,x:a.x,y:a.y},this.options))},_getWrapTileNum:function(){var a=this._map.options.crs,b=a.getSize(this._map.getZoom());return b.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(a){var b=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(a.x=(a.x%b.x+b.x)%b.x),this.options.tms&&(a.y=b.y-a.y-1),a.z=this._getZoomForUrl()},_getSubdomain:function(a){var b=Math.abs(a.x+a.y)%this.options.subdomains.length;return this.options.subdomains[b]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var a=this._unusedTiles.pop();return this._resetTile(a),a}return this._createTile()},_resetTile:function(){},_createTile:function(){var a=j.DomUtil.create("img","leaflet-tile");return a.style.width=a.style.height=this._getTileSize()+"px",a.galleryimg="no",a.onselectstart=a.onmousemove=j.Util.falseFn,j.Browser.ielt9&&this.options.opacity!==h&&j.DomUtil.setOpacity(a,this.options.opacity),j.Browser.mobileWebkit3d&&(a.style.WebkitBackfaceVisibility="hidden"),a},_loadTile:function(a,b){a._layer=this,a.onload=this._tileOnLoad,a.onerror=this._tileOnError,this._adjustTilePoint(b),a.src=this.getTileUrl(b),this.fire("tileloadstart",{tile:a,url:a.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&j.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(j.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var a=this._layer;this.src!==j.Util.emptyImageUrl&&(j.DomUtil.addClass(this,"leaflet-tile-loaded"),a.fire("tileload",{tile:this,url:this.src})),a._tileLoaded()},_tileOnError:function(){var a=this._layer;a.fire("tileerror",{tile:this,url:this.src});var b=a.options.errorTileUrl;b&&(this.src=b),a._tileLoaded()}}),j.tileLayer=function(a,b){return new j.TileLayer(a,b)},j.TileLayer.WMS=j.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(a,b){this._url=a;var c=j.extend({},this.defaultWmsParams),d=b.tileSize||this.options.tileSize;c.width=c.height=b.detectRetina&&j.Browser.retina?2*d:d;for(var e in b)this.options.hasOwnProperty(e)||"crs"===e||(c[e]=b[e]);this.wmsParams=c,j.setOptions(this,b)},onAdd:function(a){this._crs=this.options.crs||a.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var b=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[b]=this._crs.code,j.TileLayer.prototype.onAdd.call(this,a)},getTileUrl:function(a){var b=this._map,c=this.options.tileSize,d=a.multiplyBy(c),e=d.add([c,c]),f=this._crs.project(b.unproject(d,a.z)),g=this._crs.project(b.unproject(e,a.z)),h=this._wmsVersion>=1.3&&this._crs===j.CRS.EPSG4326?[g.y,f.x,f.y,g.x].join(","):[f.x,g.y,g.x,f.y].join(","),i=j.Util.template(this._url,{s:this._getSubdomain(a)});return i+j.Util.getParamString(this.wmsParams,i,!0)+"&BBOX="+h},setParams:function(a,b){return j.extend(this.wmsParams,a),b||this.redraw(),this}}),j.tileLayer.wms=function(a,b){return new j.TileLayer.WMS(a,b)},j.TileLayer.Canvas=j.TileLayer.extend({options:{async:!1},initialize:function(a){j.setOptions(this,a)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var a in this._tiles)this._redrawTile(this._tiles[a]);return this},_redrawTile:function(a){this.drawTile(a,a._tilePoint,this._map._zoom)},_createTile:function(){var a=j.DomUtil.create("canvas","leaflet-tile");return a.width=a.height=this.options.tileSize,a.onselectstart=a.onmousemove=j.Util.falseFn,a},_loadTile:function(a,b){a._layer=this,a._tilePoint=b,this._redrawTile(a),this.options.async||this.tileDrawn(a)},drawTile:function(){},tileDrawn:function(a){this._tileOnLoad.call(a)}}),j.tileLayer.canvas=function(a){return new j.TileLayer.Canvas(a)},j.ImageOverlay=j.Class.extend({includes:j.Mixin.Events,options:{opacity:1},initialize:function(a,b,c){this._url=a,this._bounds=j.latLngBounds(b),j.setOptions(this,c)},onAdd:function(a){this._map=a,this._image||this._initImage(),a._panes.overlayPane.appendChild(this._image),a.on("viewreset",this._reset,this),a.options.zoomAnimation&&j.Browser.any3d&&a.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(a){a.getPanes().overlayPane.removeChild(this._image),a.off("viewreset",this._reset,this),a.options.zoomAnimation&&a.off("zoomanim",this._animateZoom,this)},addTo:function(a){return a.addLayer(this),this},setOpacity:function(a){return this.options.opacity=a,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var a=this._map._panes.overlayPane;return this._image&&a.insertBefore(this._image,a.firstChild),this},setUrl:function(a){this._url=a,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=j.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&j.Browser.any3d?j.DomUtil.addClass(this._image,"leaflet-zoom-animated"):j.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),j.extend(this._image,{galleryimg:"no",onselectstart:j.Util.falseFn,onmousemove:j.Util.falseFn,onload:j.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(a){var b=this._map,c=this._image,d=b.getZoomScale(a.zoom),e=this._bounds.getNorthWest(),f=this._bounds.getSouthEast(),g=b._latLngToNewLayerPoint(e,a.zoom,a.center),h=b._latLngToNewLayerPoint(f,a.zoom,a.center)._subtract(g),i=g._add(h._multiplyBy(.5*(1-1/d)));c.style[j.DomUtil.TRANSFORM]=j.DomUtil.getTranslateString(i)+" scale("+d+") "},_reset:function(){var a=this._image,b=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),c=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(b);j.DomUtil.setPosition(a,b),a.style.width=c.x+"px",a.style.height=c.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){j.DomUtil.setOpacity(this._image,this.options.opacity)}}),j.imageOverlay=function(a,b,c){return new j.ImageOverlay(a,b,c)},j.Icon=j.Class.extend({options:{className:""},initialize:function(a){j.setOptions(this,a)},createIcon:function(a){return this._createIcon("icon",a)},createShadow:function(a){return this._createIcon("shadow",a)},_createIcon:function(a,b){var c=this._getIconUrl(a);if(!c){if("icon"===a)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var d;return d=b&&"IMG"===b.tagName?this._createImg(c,b):this._createImg(c),this._setIconStyles(d,a),d},_setIconStyles:function(a,b){var c,d=this.options,e=j.point(d[b+"Size"]);c=j.point("shadow"===b?d.shadowAnchor||d.iconAnchor:d.iconAnchor),!c&&e&&(c=e.divideBy(2,!0)),a.className="leaflet-marker-"+b+" "+d.className,c&&(a.style.marginLeft=-c.x+"px",a.style.marginTop=-c.y+"px"),e&&(a.style.width=e.x+"px",a.style.height=e.y+"px")},_createImg:function(a,b){return b=b||g.createElement("img"),b.src=a,b},_getIconUrl:function(a){return j.Browser.retina&&this.options[a+"RetinaUrl"]?this.options[a+"RetinaUrl"]:this.options[a+"Url"]}}),j.icon=function(a){return new j.Icon(a)},j.Icon.Default=j.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(a){var b=a+"Url";if(this.options[b])return this.options[b];j.Browser.retina&&"icon"===a&&(a+="-2x");var c=j.Icon.Default.imagePath;if(!c)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return c+"/marker-"+a+".png"}}),j.Icon.Default.imagePath=function(){var a,b,c,d,e,f=g.getElementsByTagName("script"),h=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(a=0,b=f.length;b>a;a++)if(c=f[a].src,d=c.match(h))return e=c.split(h)[0],(e?e+"/":"")+"images"}(),j.Marker=j.Class.extend({includes:j.Mixin.Events,options:{icon:new j.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(a,b){j.setOptions(this,b),this._latlng=j.latLng(a)},onAdd:function(a){this._map=a,a.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),a.options.zoomAnimation&&a.options.markerZoomAnimation&&a.on("zoomanim",this._animateZoom,this)},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),a.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(a){return this._latlng=j.latLng(a),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(a){return this.options.zIndexOffset=a,this.update(),this},setIcon:function(a){return this.options.icon=a,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){if(this._icon){var a=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(a)}return this},_initIcon:function(){var a=this.options,b=this._map,c=b.options.zoomAnimation&&b.options.markerZoomAnimation,d=c?"leaflet-zoom-animated":"leaflet-zoom-hide",e=a.icon.createIcon(this._icon),f=!1;e!==this._icon&&(this._icon&&this._removeIcon(),f=!0,a.title&&(e.title=a.title),a.alt&&(e.alt=a.alt)),j.DomUtil.addClass(e,d),a.keyboard&&(e.tabIndex="0"),this._icon=e,this._initInteraction(),a.riseOnHover&&j.DomEvent.on(e,"mouseover",this._bringToFront,this).on(e,"mouseout",this._resetZIndex,this);var g=a.icon.createShadow(this._shadow),h=!1;g!==this._shadow&&(this._removeShadow(),h=!0),g&&j.DomUtil.addClass(g,d),this._shadow=g,a.opacity<1&&this._updateOpacity();var i=this._map._panes;f&&i.markerPane.appendChild(this._icon),g&&h&&i.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&j.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(a){j.DomUtil.setPosition(this._icon,a),this._shadow&&j.DomUtil.setPosition(this._shadow,a),this._zIndex=a.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(a){this._icon.style.zIndex=this._zIndex+a},_animateZoom:function(a){var b=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center).round();this._setPos(b)},_initInteraction:function(){if(this.options.clickable){var a=this._icon,b=["dblclick","mousedown","mouseover","mouseout","contextmenu"];j.DomUtil.addClass(a,"leaflet-clickable"),j.DomEvent.on(a,"click",this._onMouseClick,this),j.DomEvent.on(a,"keypress",this._onKeyPress,this);for(var c=0;c<b.length;c++)j.DomEvent.on(a,b[c],this._fireMouseEvent,this);j.Handler.MarkerDrag&&(this.dragging=new j.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(a){var b=this.dragging&&this.dragging.moved();(this.hasEventListeners(a.type)||b)&&j.DomEvent.stopPropagation(a),b||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(a.type,{originalEvent:a,latlng:this._latlng})},_onKeyPress:function(a){13===a.keyCode&&this.fire("click",{originalEvent:a,latlng:this._latlng})},_fireMouseEvent:function(a){this.fire(a.type,{originalEvent:a,latlng:this._latlng}),"contextmenu"===a.type&&this.hasEventListeners(a.type)&&j.DomEvent.preventDefault(a),"mousedown"!==a.type?j.DomEvent.stopPropagation(a):j.DomEvent.preventDefault(a)
},setOpacity:function(a){return this.options.opacity=a,this._map&&this._updateOpacity(),this},_updateOpacity:function(){j.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&j.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),j.marker=function(a,b){return new j.Marker(a,b)},j.DivIcon=j.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(a){var b=a&&"DIV"===a.tagName?a:g.createElement("div"),c=this.options;return b.innerHTML=c.html!==!1?c.html:"",c.bgPos&&(b.style.backgroundPosition=-c.bgPos.x+"px "+-c.bgPos.y+"px"),this._setIconStyles(b,"icon"),b},createShadow:function(){return null}}),j.divIcon=function(a){return new j.DivIcon(a)},j.Map.mergeOptions({closePopupOnClick:!0}),j.Popup=j.Class.extend({includes:j.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(a,b){j.setOptions(this,a),this._source=b,this._animated=j.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(a){this._map=a,this._container||this._initLayout();var b=a.options.fadeAnimation;b&&j.DomUtil.setOpacity(this._container,0),a._panes.popupPane.appendChild(this._container),a.on(this._getEvents(),this),this.update(),b&&j.DomUtil.setOpacity(this._container,1),this.fire("open"),a.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(a){return a.addLayer(this),this},openOn:function(a){return a.openPopup(this),this},onRemove:function(a){a._panes.popupPane.removeChild(this._container),j.Util.falseFn(this._container.offsetWidth),a.off(this._getEvents(),this),a.options.fadeAnimation&&j.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),a.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(a){return this._latlng=j.latLng(a),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(a){return this._content=a,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var a={viewreset:this._updatePosition};return this._animated&&(a.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(a.preclick=this._close),this.options.keepInView&&(a.moveend=this._adjustPan),a},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var a,b="leaflet-popup",c=b+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),d=this._container=j.DomUtil.create("div",c);this.options.closeButton&&(a=this._closeButton=j.DomUtil.create("a",b+"-close-button",d),a.href="#close",a.innerHTML="&#215;",j.DomEvent.disableClickPropagation(a),j.DomEvent.on(a,"click",this._onCloseButtonClick,this));var e=this._wrapper=j.DomUtil.create("div",b+"-content-wrapper",d);j.DomEvent.disableClickPropagation(e),this._contentNode=j.DomUtil.create("div",b+"-content",e),j.DomEvent.disableScrollPropagation(this._contentNode),j.DomEvent.on(e,"contextmenu",j.DomEvent.stopPropagation),this._tipContainer=j.DomUtil.create("div",b+"-tip-container",d),this._tip=j.DomUtil.create("div",b+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var a=this._contentNode,b=a.style;b.width="",b.whiteSpace="nowrap";var c=a.offsetWidth;c=Math.min(c,this.options.maxWidth),c=Math.max(c,this.options.minWidth),b.width=c+1+"px",b.whiteSpace="",b.height="";var d=a.offsetHeight,e=this.options.maxHeight,f="leaflet-popup-scrolled";e&&d>e?(b.height=e+"px",j.DomUtil.addClass(a,f)):j.DomUtil.removeClass(a,f),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var a=this._map.latLngToLayerPoint(this._latlng),b=this._animated,c=j.point(this.options.offset);b&&j.DomUtil.setPosition(this._container,a),this._containerBottom=-c.y-(b?0:a.y),this._containerLeft=-Math.round(this._containerWidth/2)+c.x+(b?0:a.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(a){var b=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center);j.DomUtil.setPosition(this._container,b)},_adjustPan:function(){if(this.options.autoPan){var a=this._map,b=this._container.offsetHeight,c=this._containerWidth,d=new j.Point(this._containerLeft,-b-this._containerBottom);this._animated&&d._add(j.DomUtil.getPosition(this._container));var e=a.layerPointToContainerPoint(d),f=j.point(this.options.autoPanPadding),g=j.point(this.options.autoPanPaddingTopLeft||f),h=j.point(this.options.autoPanPaddingBottomRight||f),i=a.getSize(),k=0,l=0;e.x+c+h.x>i.x&&(k=e.x+c-i.x+h.x),e.x-k-g.x<0&&(k=e.x-g.x),e.y+b+h.y>i.y&&(l=e.y+b-i.y+h.y),e.y-l-g.y<0&&(l=e.y-g.y),(k||l)&&a.fire("autopanstart").panBy([k,l])}},_onCloseButtonClick:function(a){this._close(),j.DomEvent.stop(a)}}),j.popup=function(a,b){return new j.Popup(a,b)},j.Map.include({openPopup:function(a,b,c){if(this.closePopup(),!(a instanceof j.Popup)){var d=a;a=new j.Popup(c).setLatLng(b).setContent(d)}return a._isOpen=!0,this._popup=a,this.addLayer(a)},closePopup:function(a){return a&&a!==this._popup||(a=this._popup,this._popup=null),a&&(this.removeLayer(a),a._isOpen=!1),this}}),j.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(a,b){var c=j.point(this.options.icon.options.popupAnchor||[0,0]);return c=c.add(j.Popup.prototype.options.offset),b&&b.offset&&(c=c.add(b.offset)),b=j.extend({offset:c},b),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),a instanceof j.Popup?(j.setOptions(a,b),this._popup=a):this._popup=new j.Popup(b,this).setContent(a),this},setPopupContent:function(a){return this._popup&&this._popup.setContent(a),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(a){this._popup.setLatLng(a.latlng)}}),j.LayerGroup=j.Class.extend({initialize:function(a){this._layers={};var b,c;if(a)for(b=0,c=a.length;c>b;b++)this.addLayer(a[b])},addLayer:function(a){var b=this.getLayerId(a);return this._layers[b]=a,this._map&&this._map.addLayer(a),this},removeLayer:function(a){var b=a in this._layers?a:this.getLayerId(a);return this._map&&this._layers[b]&&this._map.removeLayer(this._layers[b]),delete this._layers[b],this},hasLayer:function(a){return a?a in this._layers||this.getLayerId(a)in this._layers:!1},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(a){var b,c,d=Array.prototype.slice.call(arguments,1);for(b in this._layers)c=this._layers[b],c[a]&&c[a].apply(c,d);return this},onAdd:function(a){this._map=a,this.eachLayer(a.addLayer,a)},onRemove:function(a){this.eachLayer(a.removeLayer,a),this._map=null},addTo:function(a){return a.addLayer(this),this},eachLayer:function(a,b){for(var c in this._layers)a.call(b,this._layers[c]);return this},getLayer:function(a){return this._layers[a]},getLayers:function(){var a=[];for(var b in this._layers)a.push(this._layers[b]);return a},setZIndex:function(a){return this.invoke("setZIndex",a)},getLayerId:function(a){return j.stamp(a)}}),j.layerGroup=function(a){return new j.LayerGroup(a)},j.FeatureGroup=j.LayerGroup.extend({includes:j.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(a){return this.hasLayer(a)?this:("on"in a&&a.on(j.FeatureGroup.EVENTS,this._propagateEvent,this),j.LayerGroup.prototype.addLayer.call(this,a),this._popupContent&&a.bindPopup&&a.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:a}))},removeLayer:function(a){return this.hasLayer(a)?(a in this._layers&&(a=this._layers[a]),a.off(j.FeatureGroup.EVENTS,this._propagateEvent,this),j.LayerGroup.prototype.removeLayer.call(this,a),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:a})):this},bindPopup:function(a,b){return this._popupContent=a,this._popupOptions=b,this.invoke("bindPopup",a,b)},openPopup:function(a){for(var b in this._layers){this._layers[b].openPopup(a);break}return this},setStyle:function(a){return this.invoke("setStyle",a)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var a=new j.LatLngBounds;return this.eachLayer(function(b){a.extend(b instanceof j.Marker?b.getLatLng():b.getBounds())}),a},_propagateEvent:function(a){a=j.extend({layer:a.target,target:this},a),this.fire(a.type,a)}}),j.featureGroup=function(a){return new j.FeatureGroup(a)},j.Path=j.Class.extend({includes:[j.Mixin.Events],statics:{CLIP_PADDING:function(){var a=j.Browser.mobile?1280:2e3,b=(a/Math.max(f.outerWidth,f.outerHeight)-1)/2;return Math.max(0,Math.min(.5,b))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(a){j.setOptions(this,a)},onAdd:function(a){this._map=a,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),a.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){a._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,j.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),a.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(a){return j.setOptions(this,a),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),j.Map.include({_updatePathViewport:function(){var a=j.Path.CLIP_PADDING,b=this.getSize(),c=j.DomUtil.getPosition(this._mapPane),d=c.multiplyBy(-1)._subtract(b.multiplyBy(a)._round()),e=d.add(b.multiplyBy(1+2*a)._round());this._pathViewport=new j.Bounds(d,e)}}),j.Path.SVG_NS="http://www.w3.org/2000/svg",j.Browser.svg=!(!g.createElementNS||!g.createElementNS(j.Path.SVG_NS,"svg").createSVGRect),j.Path=j.Path.extend({statics:{SVG:j.Browser.svg},bringToFront:function(){var a=this._map._pathRoot,b=this._container;return b&&a.lastChild!==b&&a.appendChild(b),this},bringToBack:function(){var a=this._map._pathRoot,b=this._container,c=a.firstChild;return b&&c!==b&&a.insertBefore(b,c),this},getPathString:function(){},_createElement:function(a){return g.createElementNS(j.Path.SVG_NS,a)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&j.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var a=this.getPathString();a||(a="M0 0"),this._path.setAttribute("d",a)},_initEvents:function(){if(this.options.clickable){(j.Browser.svg||!j.Browser.vml)&&j.DomUtil.addClass(this._path,"leaflet-clickable"),j.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var a=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],b=0;b<a.length;b++)j.DomEvent.on(this._container,a[b],this._fireMouseEvent,this)}},_onMouseClick:function(a){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(a)},_fireMouseEvent:function(a){if(this.hasEventListeners(a.type)){var b=this._map,c=b.mouseEventToContainerPoint(a),d=b.containerPointToLayerPoint(c),e=b.layerPointToLatLng(d);this.fire(a.type,{latlng:e,layerPoint:d,containerPoint:c,originalEvent:a}),"contextmenu"===a.type&&j.DomEvent.preventDefault(a),"mousemove"!==a.type&&j.DomEvent.stopPropagation(a)}}}),j.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=j.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&j.Browser.any3d?(j.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):j.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(a){var b=this.getZoomScale(a.zoom),c=this._getCenterOffset(a.center)._multiplyBy(-b)._add(this._pathViewport.min);this._pathRoot.style[j.DomUtil.TRANSFORM]=j.DomUtil.getTranslateString(c)+" scale("+b+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var a=this._pathViewport,b=a.min,c=a.max,d=c.x-b.x,e=c.y-b.y,f=this._pathRoot,g=this._panes.overlayPane;j.Browser.mobileWebkit&&g.removeChild(f),j.DomUtil.setPosition(f,b),f.setAttribute("width",d),f.setAttribute("height",e),f.setAttribute("viewBox",[b.x,b.y,d,e].join(" ")),j.Browser.mobileWebkit&&g.appendChild(f)}}}),j.Path.include({bindPopup:function(a,b){return a instanceof j.Popup?this._popup=a:((!this._popup||b)&&(this._popup=new j.Popup(b,this)),this._popup.setContent(a)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(a){return this._popup&&(a=a||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:a})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(a){this._popup.setLatLng(a.latlng),this._map.openPopup(this._popup)}}),j.Browser.vml=!j.Browser.svg&&function(){try{var a=g.createElement("div");a.innerHTML='<v:shape adj="1"/>';var b=a.firstChild;return b.style.behavior="url(#default#VML)",b&&"object"==typeof b.adj}catch(c){return!1}}(),j.Path=j.Browser.svg||!j.Browser.vml?j.Path:j.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return g.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(a){return g.createElement("<lvml:"+a+' class="lvml">')}}catch(a){return function(a){return g.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var a=this._container=this._createElement("shape");j.DomUtil.addClass(a,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&j.DomUtil.addClass(a,"leaflet-clickable"),a.coordsize="1 1",this._path=this._createElement("path"),a.appendChild(this._path),this._map._pathRoot.appendChild(a)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var a=this._stroke,b=this._fill,c=this.options,d=this._container;d.stroked=c.stroke,d.filled=c.fill,c.stroke?(a||(a=this._stroke=this._createElement("stroke"),a.endcap="round",d.appendChild(a)),a.weight=c.weight+"px",a.color=c.color,a.opacity=c.opacity,a.dashStyle=c.dashArray?j.Util.isArray(c.dashArray)?c.dashArray.join(" "):c.dashArray.replace(/( *, *)/g," "):"",c.lineCap&&(a.endcap=c.lineCap.replace("butt","flat")),c.lineJoin&&(a.joinstyle=c.lineJoin)):a&&(d.removeChild(a),this._stroke=null),c.fill?(b||(b=this._fill=this._createElement("fill"),d.appendChild(b)),b.color=c.fillColor||c.color,b.opacity=c.fillOpacity):b&&(d.removeChild(b),this._fill=null)},_updatePath:function(){var a=this._container.style;a.display="none",this._path.v=this.getPathString()+" ",a.display=""}}),j.Map.include(j.Browser.svg||!j.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var a=this._pathRoot=g.createElement("div");a.className="leaflet-vml-container",this._panes.overlayPane.appendChild(a),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),j.Browser.canvas=function(){return!!g.createElement("canvas").getContext}(),j.Path=j.Path.SVG&&!f.L_PREFER_CANVAS||!j.Browser.canvas?j.Path:j.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(a){return j.setOptions(this,a),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(a){a.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null},_requestUpdate:function(){this._map&&!j.Path._updateRequest&&(j.Path._updateRequest=j.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){j.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var a=this.options;a.stroke&&(this._ctx.lineWidth=a.weight,this._ctx.strokeStyle=a.color),a.fill&&(this._ctx.fillStyle=a.fillColor||a.color)},_drawPath:function(){var a,b,c,d,e,f;for(this._ctx.beginPath(),a=0,c=this._parts.length;c>a;a++){for(b=0,d=this._parts[a].length;d>b;b++)e=this._parts[a][b],f=(0===b?"move":"line")+"To",this._ctx[f](e.x,e.y);this instanceof j.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var a=this._ctx,b=this.options;this._drawPath(),a.save(),this._updateStyle(),b.fill&&(a.globalAlpha=b.fillOpacity,a.fill()),b.stroke&&(a.globalAlpha=b.opacity,a.stroke()),a.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onClick,this))},_onClick:function(a){this._containsPoint(a.layerPoint)&&this.fire("click",a)},_onMouseMove:function(a){this._map&&!this._map._animatingZoom&&(this._containsPoint(a.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",a)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",a)))}}),j.Map.include(j.Path.SVG&&!f.L_PREFER_CANVAS||!j.Browser.canvas?{}:{_initPathRoot:function(){var a,b=this._pathRoot;b||(b=this._pathRoot=g.createElement("canvas"),b.style.position="absolute",a=this._canvasCtx=b.getContext("2d"),a.lineCap="round",a.lineJoin="round",this._panes.overlayPane.appendChild(b),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var a=this._pathViewport,b=a.min,c=a.max.subtract(b),d=this._pathRoot;j.DomUtil.setPosition(d,b),d.width=c.x,d.height=c.y,d.getContext("2d").translate(-b.x,-b.y)}}}),j.LineUtil={simplify:function(a,b){if(!b||!a.length)return a.slice();var c=b*b;return a=this._reducePoints(a,c),a=this._simplifyDP(a,c)},pointToSegmentDistance:function(a,b,c){return Math.sqrt(this._sqClosestPointOnSegment(a,b,c,!0))},closestPointOnSegment:function(a,b,c){return this._sqClosestPointOnSegment(a,b,c)},_simplifyDP:function(a,b){var c=a.length,d=typeof Uint8Array!=h+""?Uint8Array:Array,e=new d(c);e[0]=e[c-1]=1,this._simplifyDPStep(a,e,b,0,c-1);var f,g=[];for(f=0;c>f;f++)e[f]&&g.push(a[f]);return g},_simplifyDPStep:function(a,b,c,d,e){var f,g,h,i=0;for(g=d+1;e-1>=g;g++)h=this._sqClosestPointOnSegment(a[g],a[d],a[e],!0),h>i&&(f=g,i=h);i>c&&(b[f]=1,this._simplifyDPStep(a,b,c,d,f),this._simplifyDPStep(a,b,c,f,e))},_reducePoints:function(a,b){for(var c=[a[0]],d=1,e=0,f=a.length;f>d;d++)this._sqDist(a[d],a[e])>b&&(c.push(a[d]),e=d);return f-1>e&&c.push(a[f-1]),c},clipSegment:function(a,b,c,d){var e,f,g,h=d?this._lastCode:this._getBitCode(a,c),i=this._getBitCode(b,c);for(this._lastCode=i;;){if(!(h|i))return[a,b];if(h&i)return!1;e=h||i,f=this._getEdgeIntersection(a,b,e,c),g=this._getBitCode(f,c),e===h?(a=f,h=g):(b=f,i=g)}},_getEdgeIntersection:function(a,b,c,d){var e=b.x-a.x,f=b.y-a.y,g=d.min,h=d.max;return 8&c?new j.Point(a.x+e*(h.y-a.y)/f,h.y):4&c?new j.Point(a.x+e*(g.y-a.y)/f,g.y):2&c?new j.Point(h.x,a.y+f*(h.x-a.x)/e):1&c?new j.Point(g.x,a.y+f*(g.x-a.x)/e):void 0},_getBitCode:function(a,b){var c=0;return a.x<b.min.x?c|=1:a.x>b.max.x&&(c|=2),a.y<b.min.y?c|=4:a.y>b.max.y&&(c|=8),c},_sqDist:function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d},_sqClosestPointOnSegment:function(a,b,c,d){var e,f=b.x,g=b.y,h=c.x-f,i=c.y-g,k=h*h+i*i;return k>0&&(e=((a.x-f)*h+(a.y-g)*i)/k,e>1?(f=c.x,g=c.y):e>0&&(f+=h*e,g+=i*e)),h=a.x-f,i=a.y-g,d?h*h+i*i:new j.Point(f,g)}},j.Polyline=j.Path.extend({initialize:function(a,b){j.Path.prototype.initialize.call(this,b),this._latlngs=this._convertLatLngs(a)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var a=0,b=this._latlngs.length;b>a;a++)this._originalPoints[a]=this._map.latLngToLayerPoint(this._latlngs[a])},getPathString:function(){for(var a=0,b=this._parts.length,c="";b>a;a++)c+=this._getPathPartStr(this._parts[a]);return c},getLatLngs:function(){return this._latlngs},setLatLngs:function(a){return this._latlngs=this._convertLatLngs(a),this.redraw()},addLatLng:function(a){return this._latlngs.push(j.latLng(a)),this.redraw()},spliceLatLngs:function(){var a=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),a},closestLayerPoint:function(a){for(var b,c,d=1/0,e=this._parts,f=null,g=0,h=e.length;h>g;g++)for(var i=e[g],k=1,l=i.length;l>k;k++){b=i[k-1],c=i[k];var m=j.LineUtil._sqClosestPointOnSegment(a,b,c,!0);d>m&&(d=m,f=j.LineUtil._sqClosestPointOnSegment(a,b,c))}return f&&(f.distance=Math.sqrt(d)),f},getBounds:function(){return new j.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(a,b){var c,d,e=b?a:[];for(c=0,d=a.length;d>c;c++){if(j.Util.isArray(a[c])&&"number"!=typeof a[c][0])return;e[c]=j.latLng(a[c])}return e},_initEvents:function(){j.Path.prototype._initEvents.call(this)},_getPathPartStr:function(a){for(var b,c=j.Path.VML,d=0,e=a.length,f="";e>d;d++)b=a[d],c&&b._round(),f+=(d?"L":"M")+b.x+" "+b.y;return f},_clipPoints:function(){var a,b,c,d=this._originalPoints,e=d.length;if(this.options.noClip)return void(this._parts=[d]);this._parts=[];var f=this._parts,g=this._map._pathViewport,h=j.LineUtil;for(a=0,b=0;e-1>a;a++)c=h.clipSegment(d[a],d[a+1],g,a),c&&(f[b]=f[b]||[],f[b].push(c[0]),(c[1]!==d[a+1]||a===e-2)&&(f[b].push(c[1]),b++))},_simplifyPoints:function(){for(var a=this._parts,b=j.LineUtil,c=0,d=a.length;d>c;c++)a[c]=b.simplify(a[c],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),j.Path.prototype._updatePath.call(this))}}),j.polyline=function(a,b){return new j.Polyline(a,b)},j.PolyUtil={},j.PolyUtil.clipPolygon=function(a,b){var c,d,e,f,g,h,i,k,l,m=[1,4,2,8],n=j.LineUtil;for(d=0,i=a.length;i>d;d++)a[d]._code=n._getBitCode(a[d],b);for(f=0;4>f;f++){for(k=m[f],c=[],d=0,i=a.length,e=i-1;i>d;e=d++)g=a[d],h=a[e],g._code&k?h._code&k||(l=n._getEdgeIntersection(h,g,k,b),l._code=n._getBitCode(l,b),c.push(l)):(h._code&k&&(l=n._getEdgeIntersection(h,g,k,b),l._code=n._getBitCode(l,b),c.push(l)),c.push(g));a=c}return a},j.Polygon=j.Polyline.extend({options:{fill:!0},initialize:function(a,b){j.Polyline.prototype.initialize.call(this,a,b),this._initWithHoles(a)},_initWithHoles:function(a){var b,c,d;if(a&&j.Util.isArray(a[0])&&"number"!=typeof a[0][0])for(this._latlngs=this._convertLatLngs(a[0]),this._holes=a.slice(1),b=0,c=this._holes.length;c>b;b++)d=this._holes[b]=this._convertLatLngs(this._holes[b]),d[0].equals(d[d.length-1])&&d.pop();a=this._latlngs,a.length>=2&&a[0].equals(a[a.length-1])&&a.pop()},projectLatlngs:function(){if(j.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var a,b,c,d;for(a=0,c=this._holes.length;c>a;a++)for(this._holePoints[a]=[],b=0,d=this._holes[a].length;d>b;b++)this._holePoints[a][b]=this._map.latLngToLayerPoint(this._holes[a][b])}},setLatLngs:function(a){return a&&j.Util.isArray(a[0])&&"number"!=typeof a[0][0]?(this._initWithHoles(a),this.redraw()):j.Polyline.prototype.setLatLngs.call(this,a)},_clipPoints:function(){var a=this._originalPoints,b=[];if(this._parts=[a].concat(this._holePoints),!this.options.noClip){for(var c=0,d=this._parts.length;d>c;c++){var e=j.PolyUtil.clipPolygon(this._parts[c],this._map._pathViewport);e.length&&b.push(e)}this._parts=b}},_getPathPartStr:function(a){var b=j.Polyline.prototype._getPathPartStr.call(this,a);return b+(j.Browser.svg?"z":"x")}}),j.polygon=function(a,b){return new j.Polygon(a,b)},function(){function a(a){return j.FeatureGroup.extend({initialize:function(a,b){this._layers={},this._options=b,this.setLatLngs(a)},setLatLngs:function(b){var c=0,d=b.length;for(this.eachLayer(function(a){d>c?a.setLatLngs(b[c++]):this.removeLayer(a)},this);d>c;)this.addLayer(new a(b[c++],this._options));return this},getLatLngs:function(){var a=[];return this.eachLayer(function(b){a.push(b.getLatLngs())}),a}})}j.MultiPolyline=a(j.Polyline),j.MultiPolygon=a(j.Polygon),j.multiPolyline=function(a,b){return new j.MultiPolyline(a,b)},j.multiPolygon=function(a,b){return new j.MultiPolygon(a,b)}}(),j.Rectangle=j.Polygon.extend({initialize:function(a,b){j.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(a),b)},setBounds:function(a){this.setLatLngs(this._boundsToLatLngs(a))},_boundsToLatLngs:function(a){return a=j.latLngBounds(a),[a.getSouthWest(),a.getNorthWest(),a.getNorthEast(),a.getSouthEast()]}}),j.rectangle=function(a,b){return new j.Rectangle(a,b)},j.Circle=j.Path.extend({initialize:function(a,b,c){j.Path.prototype.initialize.call(this,c),this._latlng=j.latLng(a),this._mRadius=b},options:{fill:!0},setLatLng:function(a){return this._latlng=j.latLng(a),this.redraw()},setRadius:function(a){return this._mRadius=a,this.redraw()},projectLatlngs:function(){var a=this._getLngRadius(),b=this._latlng,c=this._map.latLngToLayerPoint([b.lat,b.lng-a]);this._point=this._map.latLngToLayerPoint(b),this._radius=Math.max(this._point.x-c.x,1)},getBounds:function(){var a=this._getLngRadius(),b=this._mRadius/40075017*360,c=this._latlng;return new j.LatLngBounds([c.lat-b,c.lng-a],[c.lat+b,c.lng+a])},getLatLng:function(){return this._latlng},getPathString:function(){var a=this._point,b=this._radius;return this._checkIfEmpty()?"":j.Browser.svg?"M"+a.x+","+(a.y-b)+"A"+b+","+b+",0,1,1,"+(a.x-.1)+","+(a.y-b)+" z":(a._round(),b=Math.round(b),"AL "+a.x+","+a.y+" "+b+","+b+" 0,23592600")},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(j.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var a=this._map._pathViewport,b=this._radius,c=this._point;return c.x-b>a.max.x||c.y-b>a.max.y||c.x+b<a.min.x||c.y+b<a.min.y}}),j.circle=function(a,b,c){return new j.Circle(a,b,c)},j.CircleMarker=j.Circle.extend({options:{radius:10,weight:2},initialize:function(a,b){j.Circle.prototype.initialize.call(this,a,null,b),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){j.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(a){return j.Circle.prototype.setLatLng.call(this,a),this._popup&&this._popup._isOpen&&this._popup.setLatLng(a),this},setRadius:function(a){return this.options.radius=this._radius=a,this.redraw()},getRadius:function(){return this._radius}}),j.circleMarker=function(a,b){return new j.CircleMarker(a,b)},j.Polyline.include(j.Path.CANVAS?{_containsPoint:function(a,b){var c,d,e,f,g,h,i,k=this.options.weight/2;for(j.Browser.touch&&(k+=10),c=0,f=this._parts.length;f>c;c++)for(i=this._parts[c],d=0,g=i.length,e=g-1;g>d;e=d++)if((b||0!==d)&&(h=j.LineUtil.pointToSegmentDistance(a,i[e],i[d]),k>=h))return!0;return!1}}:{}),j.Polygon.include(j.Path.CANVAS?{_containsPoint:function(a){var b,c,d,e,f,g,h,i,k=!1;if(j.Polyline.prototype._containsPoint.call(this,a,!0))return!0;for(e=0,h=this._parts.length;h>e;e++)for(b=this._parts[e],f=0,i=b.length,g=i-1;i>f;g=f++)c=b[f],d=b[g],c.y>a.y!=d.y>a.y&&a.x<(d.x-c.x)*(a.y-c.y)/(d.y-c.y)+c.x&&(k=!k);return k}}:{}),j.Circle.include(j.Path.CANVAS?{_drawPath:function(){var a=this._point;this._ctx.beginPath(),this._ctx.arc(a.x,a.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(a){var b=this._point,c=this.options.stroke?this.options.weight/2:0;return a.distanceTo(b)<=this._radius+c}}:{}),j.CircleMarker.include(j.Path.CANVAS?{_updateStyle:function(){j.Path.prototype._updateStyle.call(this)}}:{}),j.GeoJSON=j.FeatureGroup.extend({initialize:function(a,b){j.setOptions(this,b),this._layers={},a&&this.addData(a)},addData:function(a){var b,c,d,e=j.Util.isArray(a)?a:a.features;if(e){for(b=0,c=e.length;c>b;b++)d=e[b],(d.geometries||d.geometry||d.features||d.coordinates)&&this.addData(e[b]);return this}var f=this.options;if(!f.filter||f.filter(a)){var g=j.GeoJSON.geometryToLayer(a,f.pointToLayer,f.coordsToLatLng,f);return g.feature=j.GeoJSON.asFeature(a),g.defaultOptions=g.options,this.resetStyle(g),f.onEachFeature&&f.onEachFeature(a,g),this.addLayer(g)}},resetStyle:function(a){var b=this.options.style;b&&(j.Util.extend(a.options,a.defaultOptions),this._setLayerStyle(a,b))},setStyle:function(a){this.eachLayer(function(b){this._setLayerStyle(b,a)},this)},_setLayerStyle:function(a,b){"function"==typeof b&&(b=b(a.feature)),a.setStyle&&a.setStyle(b)}}),j.extend(j.GeoJSON,{geometryToLayer:function(a,b,c,d){var e,f,g,h,i="Feature"===a.type?a.geometry:a,k=i.coordinates,l=[];switch(c=c||this.coordsToLatLng,i.type){case"Point":return e=c(k),b?b(a,e):new j.Marker(e);
case"MultiPoint":for(g=0,h=k.length;h>g;g++)e=c(k[g]),l.push(b?b(a,e):new j.Marker(e));return new j.FeatureGroup(l);case"LineString":return f=this.coordsToLatLngs(k,0,c),new j.Polyline(f,d);case"Polygon":if(2===k.length&&!k[1].length)throw new Error("Invalid GeoJSON object.");return f=this.coordsToLatLngs(k,1,c),new j.Polygon(f,d);case"MultiLineString":return f=this.coordsToLatLngs(k,1,c),new j.MultiPolyline(f,d);case"MultiPolygon":return f=this.coordsToLatLngs(k,2,c),new j.MultiPolygon(f,d);case"GeometryCollection":for(g=0,h=i.geometries.length;h>g;g++)l.push(this.geometryToLayer({geometry:i.geometries[g],type:"Feature",properties:a.properties},b,c,d));return new j.FeatureGroup(l);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(a){return new j.LatLng(a[1],a[0],a[2])},coordsToLatLngs:function(a,b,c){var d,e,f,g=[];for(e=0,f=a.length;f>e;e++)d=b?this.coordsToLatLngs(a[e],b-1,c):(c||this.coordsToLatLng)(a[e]),g.push(d);return g},latLngToCoords:function(a){var b=[a.lng,a.lat];return a.alt!==h&&b.push(a.alt),b},latLngsToCoords:function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(j.GeoJSON.latLngToCoords(a[c]));return b},getFeature:function(a,b){return a.feature?j.extend({},a.feature,{geometry:b}):j.GeoJSON.asFeature(b)},asFeature:function(a){return"Feature"===a.type?a:{type:"Feature",properties:{},geometry:a}}});var l={toGeoJSON:function(){return j.GeoJSON.getFeature(this,{type:"Point",coordinates:j.GeoJSON.latLngToCoords(this.getLatLng())})}};j.Marker.include(l),j.Circle.include(l),j.CircleMarker.include(l),j.Polyline.include({toGeoJSON:function(){return j.GeoJSON.getFeature(this,{type:"LineString",coordinates:j.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),j.Polygon.include({toGeoJSON:function(){var a,b,c,d=[j.GeoJSON.latLngsToCoords(this.getLatLngs())];if(d[0].push(d[0][0]),this._holes)for(a=0,b=this._holes.length;b>a;a++)c=j.GeoJSON.latLngsToCoords(this._holes[a]),c.push(c[0]),d.push(c);return j.GeoJSON.getFeature(this,{type:"Polygon",coordinates:d})}}),function(){function a(a){return function(){var b=[];return this.eachLayer(function(a){b.push(a.toGeoJSON().geometry.coordinates)}),j.GeoJSON.getFeature(this,{type:a,coordinates:b})}}j.MultiPolyline.include({toGeoJSON:a("MultiLineString")}),j.MultiPolygon.include({toGeoJSON:a("MultiPolygon")}),j.LayerGroup.include({toGeoJSON:function(){var b,c=this.feature&&this.feature.geometry,d=[];if(c&&"MultiPoint"===c.type)return a("MultiPoint").call(this);var e=c&&"GeometryCollection"===c.type;return this.eachLayer(function(a){a.toGeoJSON&&(b=a.toGeoJSON(),d.push(e?b.geometry:j.GeoJSON.asFeature(b)))}),e?j.GeoJSON.getFeature(this,{geometries:d,type:"GeometryCollection"}):{type:"FeatureCollection",features:d}}})}(),j.geoJson=function(a,b){return new j.GeoJSON(a,b)},j.DomEvent={addListener:function(a,b,c,d){var e,f,g,h=j.stamp(c),i="_leaflet_"+b+h;return a[i]?this:(e=function(b){return c.call(d||a,b||j.DomEvent._getEvent())},j.Browser.pointer&&0===b.indexOf("touch")?this.addPointerListener(a,b,e,h):(j.Browser.touch&&"dblclick"===b&&this.addDoubleTapListener&&this.addDoubleTapListener(a,e,h),"addEventListener"in a?"mousewheel"===b?(a.addEventListener("DOMMouseScroll",e,!1),a.addEventListener(b,e,!1)):"mouseenter"===b||"mouseleave"===b?(f=e,g="mouseenter"===b?"mouseover":"mouseout",e=function(b){return j.DomEvent._checkMouse(a,b)?f(b):void 0},a.addEventListener(g,e,!1)):"click"===b&&j.Browser.android?(f=e,e=function(a){return j.DomEvent._filterClick(a,f)},a.addEventListener(b,e,!1)):a.addEventListener(b,e,!1):"attachEvent"in a&&a.attachEvent("on"+b,e),a[i]=e,this))},removeListener:function(a,b,c){var d=j.stamp(c),e="_leaflet_"+b+d,f=a[e];return f?(j.Browser.pointer&&0===b.indexOf("touch")?this.removePointerListener(a,b,d):j.Browser.touch&&"dblclick"===b&&this.removeDoubleTapListener?this.removeDoubleTapListener(a,d):"removeEventListener"in a?"mousewheel"===b?(a.removeEventListener("DOMMouseScroll",f,!1),a.removeEventListener(b,f,!1)):"mouseenter"===b||"mouseleave"===b?a.removeEventListener("mouseenter"===b?"mouseover":"mouseout",f,!1):a.removeEventListener(b,f,!1):"detachEvent"in a&&a.detachEvent("on"+b,f),a[e]=null,this):this},stopPropagation:function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,j.DomEvent._skipped(a),this},disableScrollPropagation:function(a){var b=j.DomEvent.stopPropagation;return j.DomEvent.on(a,"mousewheel",b).on(a,"MozMousePixelScroll",b)},disableClickPropagation:function(a){for(var b=j.DomEvent.stopPropagation,c=j.Draggable.START.length-1;c>=0;c--)j.DomEvent.on(a,j.Draggable.START[c],b);return j.DomEvent.on(a,"click",j.DomEvent._fakeStop).on(a,"dblclick",b)},preventDefault:function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,this},stop:function(a){return j.DomEvent.preventDefault(a).stopPropagation(a)},getMousePosition:function(a,b){if(!b)return new j.Point(a.clientX,a.clientY);var c=b.getBoundingClientRect();return new j.Point(a.clientX-c.left-b.clientLeft,a.clientY-c.top-b.clientTop)},getWheelDelta:function(a){var b=0;return a.wheelDelta&&(b=a.wheelDelta/120),a.detail&&(b=-a.detail/3),b},_skipEvents:{},_fakeStop:function(a){j.DomEvent._skipEvents[a.type]=!0},_skipped:function(a){var b=this._skipEvents[a.type];return this._skipEvents[a.type]=!1,b},_checkMouse:function(a,b){var c=b.relatedTarget;if(!c)return!0;try{for(;c&&c!==a;)c=c.parentNode}catch(d){return!1}return c!==a},_getEvent:function(){var a=f.event;if(!a)for(var b=arguments.callee.caller;b&&(a=b.arguments[0],!a||f.Event!==a.constructor);)b=b.caller;return a},_filterClick:function(a,b){var c=a.timeStamp||a.originalEvent.timeStamp,d=j.DomEvent._lastClick&&c-j.DomEvent._lastClick;return d&&d>100&&500>d||a.target._simulatedClick&&!a._simulated?void j.DomEvent.stop(a):(j.DomEvent._lastClick=c,b(a))}},j.DomEvent.on=j.DomEvent.addListener,j.DomEvent.off=j.DomEvent.removeListener,j.Draggable=j.Class.extend({includes:j.Mixin.Events,statics:{START:j.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(a,b){this._element=a,this._dragStartTarget=b||a},enable:function(){if(!this._enabled){for(var a=j.Draggable.START.length-1;a>=0;a--)j.DomEvent.on(this._dragStartTarget,j.Draggable.START[a],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var a=j.Draggable.START.length-1;a>=0;a--)j.DomEvent.off(this._dragStartTarget,j.Draggable.START[a],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(a){if(this._moved=!1,!(a.shiftKey||1!==a.which&&1!==a.button&&!a.touches||(j.DomEvent.stopPropagation(a),j.Draggable._disabled||(j.DomUtil.disableImageDrag(),j.DomUtil.disableTextSelection(),this._moving)))){var b=a.touches?a.touches[0]:a;this._startPoint=new j.Point(b.clientX,b.clientY),this._startPos=this._newPos=j.DomUtil.getPosition(this._element),j.DomEvent.on(g,j.Draggable.MOVE[a.type],this._onMove,this).on(g,j.Draggable.END[a.type],this._onUp,this)}},_onMove:function(a){if(a.touches&&a.touches.length>1)return void(this._moved=!0);var b=a.touches&&1===a.touches.length?a.touches[0]:a,c=new j.Point(b.clientX,b.clientY),d=c.subtract(this._startPoint);(d.x||d.y)&&(j.Browser.touch&&Math.abs(d.x)+Math.abs(d.y)<3||(j.DomEvent.preventDefault(a),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=j.DomUtil.getPosition(this._element).subtract(d),j.DomUtil.addClass(g.body,"leaflet-dragging"),this._lastTarget=a.target||a.srcElement,j.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(d),this._moving=!0,j.Util.cancelAnimFrame(this._animRequest),this._animRequest=j.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),j.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){j.DomUtil.removeClass(g.body,"leaflet-dragging"),this._lastTarget&&(j.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var a in j.Draggable.MOVE)j.DomEvent.off(g,j.Draggable.MOVE[a],this._onMove).off(g,j.Draggable.END[a],this._onUp);j.DomUtil.enableImageDrag(),j.DomUtil.enableTextSelection(),this._moved&&this._moving&&(j.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),j.Handler=j.Class.extend({initialize:function(a){this._map=a},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),j.Map.mergeOptions({dragging:!0,inertia:!j.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:j.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),j.Map.Drag=j.Handler.extend({addHooks:function(){if(!this._draggable){var a=this._map;this._draggable=new j.Draggable(a._mapPane,a._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),a.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),a.on("viewreset",this._onViewReset,this),a.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var a=this._map;a._panAnim&&a._panAnim.stop(),a.fire("movestart").fire("dragstart"),a.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var a=this._lastTime=+new Date,b=this._lastPos=this._draggable._newPos;this._positions.push(b),this._times.push(a),a-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var a=this._map.getSize()._divideBy(2),b=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=b.subtract(a).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var a=this._worldWidth,b=Math.round(a/2),c=this._initialWorldOffset,d=this._draggable._newPos.x,e=(d-b+c)%a+b-c,f=(d+b+c)%a-b-c,g=Math.abs(e+c)<Math.abs(f+c)?e:f;this._draggable._newPos.x=g},_onDragEnd:function(a){var b=this._map,c=b.options,d=+new Date-this._lastTime,e=!c.inertia||d>c.inertiaThreshold||!this._positions[0];if(b.fire("dragend",a),e)b.fire("moveend");else{var f=this._lastPos.subtract(this._positions[0]),g=(this._lastTime+d-this._times[0])/1e3,h=c.easeLinearity,i=f.multiplyBy(h/g),k=i.distanceTo([0,0]),l=Math.min(c.inertiaMaxSpeed,k),m=i.multiplyBy(l/k),n=l/(c.inertiaDeceleration*h),o=m.multiplyBy(-n/2).round();o.x&&o.y?(o=b._limitOffset(o,b.options.maxBounds),j.Util.requestAnimFrame(function(){b.panBy(o,{duration:n,easeLinearity:h,noMoveStart:!0})})):b.fire("moveend")}}}),j.Map.addInitHook("addHandler","dragging",j.Map.Drag),j.Map.mergeOptions({doubleClickZoom:!0}),j.Map.DoubleClickZoom=j.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(a){var b=this._map,c=b.getZoom()+(a.originalEvent.shiftKey?-1:1);"center"===b.options.doubleClickZoom?b.setZoom(c):b.setZoomAround(a.containerPoint,c)}}),j.Map.addInitHook("addHandler","doubleClickZoom",j.Map.DoubleClickZoom),j.Map.mergeOptions({scrollWheelZoom:!0}),j.Map.ScrollWheelZoom=j.Handler.extend({addHooks:function(){j.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),j.DomEvent.on(this._map._container,"MozMousePixelScroll",j.DomEvent.preventDefault),this._delta=0},removeHooks:function(){j.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),j.DomEvent.off(this._map._container,"MozMousePixelScroll",j.DomEvent.preventDefault)},_onWheelScroll:function(a){var b=j.DomEvent.getWheelDelta(a);this._delta+=b,this._lastMousePos=this._map.mouseEventToContainerPoint(a),this._startTime||(this._startTime=+new Date);var c=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(j.bind(this._performZoom,this),c),j.DomEvent.preventDefault(a),j.DomEvent.stopPropagation(a)},_performZoom:function(){var a=this._map,b=this._delta,c=a.getZoom();b=b>0?Math.ceil(b):Math.floor(b),b=Math.max(Math.min(b,4),-4),b=a._limitZoom(c+b)-c,this._delta=0,this._startTime=null,b&&("center"===a.options.scrollWheelZoom?a.setZoom(c+b):a.setZoomAround(this._lastMousePos,c+b))}}),j.Map.addInitHook("addHandler","scrollWheelZoom",j.Map.ScrollWheelZoom),j.extend(j.DomEvent,{_touchstart:j.Browser.msPointer?"MSPointerDown":j.Browser.pointer?"pointerdown":"touchstart",_touchend:j.Browser.msPointer?"MSPointerUp":j.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(a,b,c){function d(a){var b;if(j.Browser.pointer?(o.push(a.pointerId),b=o.length):b=a.touches.length,!(b>1)){var c=Date.now(),d=c-(f||c);h=a.touches?a.touches[0]:a,i=d>0&&k>=d,f=c}}function e(a){if(j.Browser.pointer){var c=o.indexOf(a.pointerId);if(-1===c)return;o.splice(c,1)}if(i){if(j.Browser.pointer){var d,e={};for(var g in h)d=h[g],e[g]="function"==typeof d?d.bind(h):d;h=e}h.type="dblclick",b(h),f=null}}var f,h,i=!1,k=250,l="_leaflet_",m=this._touchstart,n=this._touchend,o=[];a[l+m+c]=d,a[l+n+c]=e;var p=j.Browser.pointer?g.documentElement:a;return a.addEventListener(m,d,!1),p.addEventListener(n,e,!1),j.Browser.pointer&&p.addEventListener(j.DomEvent.POINTER_CANCEL,e,!1),this},removeDoubleTapListener:function(a,b){var c="_leaflet_";return a.removeEventListener(this._touchstart,a[c+this._touchstart+b],!1),(j.Browser.pointer?g.documentElement:a).removeEventListener(this._touchend,a[c+this._touchend+b],!1),j.Browser.pointer&&g.documentElement.removeEventListener(j.DomEvent.POINTER_CANCEL,a[c+this._touchend+b],!1),this}}),j.extend(j.DomEvent,{POINTER_DOWN:j.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:j.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:j.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:j.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(a,b,c,d){switch(b){case"touchstart":return this.addPointerListenerStart(a,b,c,d);case"touchend":return this.addPointerListenerEnd(a,b,c,d);case"touchmove":return this.addPointerListenerMove(a,b,c,d);default:throw"Unknown touch event type"}},addPointerListenerStart:function(a,b,c,d){var e="_leaflet_",f=this._pointers,h=function(a){j.DomEvent.preventDefault(a);for(var b=!1,d=0;d<f.length;d++)if(f[d].pointerId===a.pointerId){b=!0;break}b||f.push(a),a.touches=f.slice(),a.changedTouches=[a],c(a)};if(a[e+"touchstart"+d]=h,a.addEventListener(this.POINTER_DOWN,h,!1),!this._pointerDocumentListener){var i=function(a){for(var b=0;b<f.length;b++)if(f[b].pointerId===a.pointerId){f.splice(b,1);break}};g.documentElement.addEventListener(this.POINTER_UP,i,!1),g.documentElement.addEventListener(this.POINTER_CANCEL,i,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(a,b,c,d){function e(a){if(a.pointerType!==a.MSPOINTER_TYPE_MOUSE&&"mouse"!==a.pointerType||0!==a.buttons){for(var b=0;b<g.length;b++)if(g[b].pointerId===a.pointerId){g[b]=a;break}a.touches=g.slice(),a.changedTouches=[a],c(a)}}var f="_leaflet_",g=this._pointers;return a[f+"touchmove"+d]=e,a.addEventListener(this.POINTER_MOVE,e,!1),this},addPointerListenerEnd:function(a,b,c,d){var e="_leaflet_",f=this._pointers,g=function(a){for(var b=0;b<f.length;b++)if(f[b].pointerId===a.pointerId){f.splice(b,1);break}a.touches=f.slice(),a.changedTouches=[a],c(a)};return a[e+"touchend"+d]=g,a.addEventListener(this.POINTER_UP,g,!1),a.addEventListener(this.POINTER_CANCEL,g,!1),this},removePointerListener:function(a,b,c){var d="_leaflet_",e=a[d+b+c];switch(b){case"touchstart":a.removeEventListener(this.POINTER_DOWN,e,!1);break;case"touchmove":a.removeEventListener(this.POINTER_MOVE,e,!1);break;case"touchend":a.removeEventListener(this.POINTER_UP,e,!1),a.removeEventListener(this.POINTER_CANCEL,e,!1)}return this}}),j.Map.mergeOptions({touchZoom:j.Browser.touch&&!j.Browser.android23,bounceAtZoomLimits:!0}),j.Map.TouchZoom=j.Handler.extend({addHooks:function(){j.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){j.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(a){var b=this._map;if(a.touches&&2===a.touches.length&&!b._animatingZoom&&!this._zooming){var c=b.mouseEventToLayerPoint(a.touches[0]),d=b.mouseEventToLayerPoint(a.touches[1]),e=b._getCenterLayerPoint();this._startCenter=c.add(d)._divideBy(2),this._startDist=c.distanceTo(d),this._moved=!1,this._zooming=!0,this._centerOffset=e.subtract(this._startCenter),b._panAnim&&b._panAnim.stop(),j.DomEvent.on(g,"touchmove",this._onTouchMove,this).on(g,"touchend",this._onTouchEnd,this),j.DomEvent.preventDefault(a)}},_onTouchMove:function(a){var b=this._map;if(a.touches&&2===a.touches.length&&this._zooming){var c=b.mouseEventToLayerPoint(a.touches[0]),d=b.mouseEventToLayerPoint(a.touches[1]);this._scale=c.distanceTo(d)/this._startDist,this._delta=c._add(d)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(b.options.bounceAtZoomLimits||!(b.getZoom()===b.getMinZoom()&&this._scale<1||b.getZoom()===b.getMaxZoom()&&this._scale>1))&&(this._moved||(j.DomUtil.addClass(b._mapPane,"leaflet-touching"),b.fire("movestart").fire("zoomstart"),this._moved=!0),j.Util.cancelAnimFrame(this._animRequest),this._animRequest=j.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),j.DomEvent.preventDefault(a))}},_updateOnMove:function(){var a=this._map,b=this._getScaleOrigin(),c=a.layerPointToLatLng(b),d=a.getScaleZoom(this._scale);a._animateZoom(c,d,this._startCenter,this._scale,this._delta,!1,!0)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return void(this._zooming=!1);var a=this._map;this._zooming=!1,j.DomUtil.removeClass(a._mapPane,"leaflet-touching"),j.Util.cancelAnimFrame(this._animRequest),j.DomEvent.off(g,"touchmove",this._onTouchMove).off(g,"touchend",this._onTouchEnd);var b=this._getScaleOrigin(),c=a.layerPointToLatLng(b),d=a.getZoom(),e=a.getScaleZoom(this._scale)-d,f=e>0?Math.ceil(e):Math.floor(e),h=a._limitZoom(d+f),i=a.getZoomScale(h)/this._scale;a._animateZoom(c,h,b,i)},_getScaleOrigin:function(){var a=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(a)}}),j.Map.addInitHook("addHandler","touchZoom",j.Map.TouchZoom),j.Map.mergeOptions({tap:!0,tapTolerance:15}),j.Map.Tap=j.Handler.extend({addHooks:function(){j.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){j.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(a){if(a.touches){if(j.DomEvent.preventDefault(a),this._fireClick=!0,a.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var b=a.touches[0],c=b.target;this._startPos=this._newPos=new j.Point(b.clientX,b.clientY),c.tagName&&"a"===c.tagName.toLowerCase()&&j.DomUtil.addClass(c,"leaflet-active"),this._holdTimeout=setTimeout(j.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",b))},this),1e3),j.DomEvent.on(g,"touchmove",this._onMove,this).on(g,"touchend",this._onUp,this)}},_onUp:function(a){if(clearTimeout(this._holdTimeout),j.DomEvent.off(g,"touchmove",this._onMove,this).off(g,"touchend",this._onUp,this),this._fireClick&&a&&a.changedTouches){var b=a.changedTouches[0],c=b.target;c&&c.tagName&&"a"===c.tagName.toLowerCase()&&j.DomUtil.removeClass(c,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",b)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(a){var b=a.touches[0];this._newPos=new j.Point(b.clientX,b.clientY)},_simulateEvent:function(a,b){var c=g.createEvent("MouseEvents");c._simulated=!0,b.target._simulatedClick=!0,c.initMouseEvent(a,!0,!0,f,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null),b.target.dispatchEvent(c)}}),j.Browser.touch&&!j.Browser.pointer&&j.Map.addInitHook("addHandler","tap",j.Map.Tap),j.Map.mergeOptions({boxZoom:!0}),j.Map.BoxZoom=j.Handler.extend({initialize:function(a){this._map=a,this._container=a._container,this._pane=a._panes.overlayPane,this._moved=!1},addHooks:function(){j.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){j.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(a){return this._moved=!1,!a.shiftKey||1!==a.which&&1!==a.button?!1:(j.DomUtil.disableTextSelection(),j.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(a),void j.DomEvent.on(g,"mousemove",this._onMouseMove,this).on(g,"mouseup",this._onMouseUp,this).on(g,"keydown",this._onKeyDown,this))},_onMouseMove:function(a){this._moved||(this._box=j.DomUtil.create("div","leaflet-zoom-box",this._pane),j.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var b=this._startLayerPoint,c=this._box,d=this._map.mouseEventToLayerPoint(a),e=d.subtract(b),f=new j.Point(Math.min(d.x,b.x),Math.min(d.y,b.y));j.DomUtil.setPosition(c,f),this._moved=!0,c.style.width=Math.max(0,Math.abs(e.x)-4)+"px",c.style.height=Math.max(0,Math.abs(e.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),j.DomUtil.enableTextSelection(),j.DomUtil.enableImageDrag(),j.DomEvent.off(g,"mousemove",this._onMouseMove).off(g,"mouseup",this._onMouseUp).off(g,"keydown",this._onKeyDown)},_onMouseUp:function(a){this._finish();var b=this._map,c=b.mouseEventToLayerPoint(a);if(!this._startLayerPoint.equals(c)){var d=new j.LatLngBounds(b.layerPointToLatLng(this._startLayerPoint),b.layerPointToLatLng(c));b.fitBounds(d),b.fire("boxzoomend",{boxZoomBounds:d})}},_onKeyDown:function(a){27===a.keyCode&&this._finish()}}),j.Map.addInitHook("addHandler","boxZoom",j.Map.BoxZoom),j.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),j.Map.Keyboard=j.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(a){this._map=a,this._setPanOffset(a.options.keyboardPanOffset),this._setZoomOffset(a.options.keyboardZoomOffset)},addHooks:function(){var a=this._map._container;-1===a.tabIndex&&(a.tabIndex="0"),j.DomEvent.on(a,"focus",this._onFocus,this).on(a,"blur",this._onBlur,this).on(a,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var a=this._map._container;j.DomEvent.off(a,"focus",this._onFocus,this).off(a,"blur",this._onBlur,this).off(a,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var a=g.body,b=g.documentElement,c=a.scrollTop||b.scrollTop,d=a.scrollLeft||b.scrollLeft;this._map._container.focus(),f.scrollTo(d,c)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(a){var b,c,d=this._panKeys={},e=this.keyCodes;for(b=0,c=e.left.length;c>b;b++)d[e.left[b]]=[-1*a,0];for(b=0,c=e.right.length;c>b;b++)d[e.right[b]]=[a,0];for(b=0,c=e.down.length;c>b;b++)d[e.down[b]]=[0,a];for(b=0,c=e.up.length;c>b;b++)d[e.up[b]]=[0,-1*a]},_setZoomOffset:function(a){var b,c,d=this._zoomKeys={},e=this.keyCodes;for(b=0,c=e.zoomIn.length;c>b;b++)d[e.zoomIn[b]]=a;for(b=0,c=e.zoomOut.length;c>b;b++)d[e.zoomOut[b]]=-a},_addHooks:function(){j.DomEvent.on(g,"keydown",this._onKeyDown,this)},_removeHooks:function(){j.DomEvent.off(g,"keydown",this._onKeyDown,this)},_onKeyDown:function(a){var b=a.keyCode,c=this._map;if(b in this._panKeys){if(c._panAnim&&c._panAnim._inProgress)return;c.panBy(this._panKeys[b]),c.options.maxBounds&&c.panInsideBounds(c.options.maxBounds)}else{if(!(b in this._zoomKeys))return;c.setZoom(c.getZoom()+this._zoomKeys[b])}j.DomEvent.stop(a)}}),j.Map.addInitHook("addHandler","keyboard",j.Map.Keyboard),j.Handler.MarkerDrag=j.Handler.extend({initialize:function(a){this._marker=a},addHooks:function(){var a=this._marker._icon;this._draggable||(this._draggable=new j.Draggable(a,a)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),j.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),j.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var a=this._marker,b=a._shadow,c=j.DomUtil.getPosition(a._icon),d=a._map.layerPointToLatLng(c);b&&j.DomUtil.setPosition(b,c),a._latlng=d,a.fire("move",{latlng:d}).fire("drag")},_onDragEnd:function(a){this._marker.fire("moveend").fire("dragend",a)}}),j.Control=j.Class.extend({options:{position:"topright"},initialize:function(a){j.setOptions(this,a)},getPosition:function(){return this.options.position},setPosition:function(a){var b=this._map;return b&&b.removeControl(this),this.options.position=a,b&&b.addControl(this),this},getContainer:function(){return this._container},addTo:function(a){this._map=a;var b=this._container=this.onAdd(a),c=this.getPosition(),d=a._controlCorners[c];return j.DomUtil.addClass(b,"leaflet-control"),-1!==c.indexOf("bottom")?d.insertBefore(b,d.firstChild):d.appendChild(b),this},removeFrom:function(a){var b=this.getPosition(),c=a._controlCorners[b];return c.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(a),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),j.control=function(a){return new j.Control(a)},j.Map.include({addControl:function(a){return a.addTo(this),this},removeControl:function(a){return a.removeFrom(this),this},_initControlPos:function(){function a(a,e){var f=c+a+" "+c+e;b[a+e]=j.DomUtil.create("div",f,d)}var b=this._controlCorners={},c="leaflet-",d=this._controlContainer=j.DomUtil.create("div",c+"control-container",this._container);a("top","left"),a("top","right"),a("bottom","left"),a("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),j.Control.Zoom=j.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(a){var b="leaflet-control-zoom",c=j.DomUtil.create("div",b+" leaflet-bar");return this._map=a,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,b+"-in",c,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,b+"-out",c,this._zoomOut,this),this._updateDisabled(),a.on("zoomend zoomlevelschange",this._updateDisabled,this),c},onRemove:function(a){a.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(a){this._map.zoomIn(a.shiftKey?3:1)},_zoomOut:function(a){this._map.zoomOut(a.shiftKey?3:1)},_createButton:function(a,b,c,d,e,f){var g=j.DomUtil.create("a",c,d);g.innerHTML=a,g.href="#",g.title=b;var h=j.DomEvent.stopPropagation;return j.DomEvent.on(g,"click",h).on(g,"mousedown",h).on(g,"dblclick",h).on(g,"click",j.DomEvent.preventDefault).on(g,"click",e,f).on(g,"click",this._refocusOnMap,f),g},_updateDisabled:function(){var a=this._map,b="leaflet-disabled";j.DomUtil.removeClass(this._zoomInButton,b),j.DomUtil.removeClass(this._zoomOutButton,b),a._zoom===a.getMinZoom()&&j.DomUtil.addClass(this._zoomOutButton,b),a._zoom===a.getMaxZoom()&&j.DomUtil.addClass(this._zoomInButton,b)}}),j.Map.mergeOptions({zoomControl:!0}),j.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new j.Control.Zoom,this.addControl(this.zoomControl))}),j.control.zoom=function(a){return new j.Control.Zoom(a)},j.Control.Attribution=j.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(a){j.setOptions(this,a),this._attributions={}},onAdd:function(a){this._container=j.DomUtil.create("div","leaflet-control-attribution"),j.DomEvent.disableClickPropagation(this._container);for(var b in a._layers)a._layers[b].getAttribution&&this.addAttribution(a._layers[b].getAttribution());return a.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(a){a.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(a){return this.options.prefix=a,this._update(),this},addAttribution:function(a){return a?(this._attributions[a]||(this._attributions[a]=0),this._attributions[a]++,this._update(),this):void 0},removeAttribution:function(a){return a?(this._attributions[a]&&(this._attributions[a]--,this._update()),this):void 0},_update:function(){if(this._map){var a=[];for(var b in this._attributions)this._attributions[b]&&a.push(b);var c=[];this.options.prefix&&c.push(this.options.prefix),a.length&&c.push(a.join(", ")),this._container.innerHTML=c.join(" | ")}},_onLayerAdd:function(a){a.layer.getAttribution&&this.addAttribution(a.layer.getAttribution())},_onLayerRemove:function(a){a.layer.getAttribution&&this.removeAttribution(a.layer.getAttribution())}}),j.Map.mergeOptions({attributionControl:!0}),j.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new j.Control.Attribution).addTo(this))}),j.control.attribution=function(a){return new j.Control.Attribution(a)},j.Control.Scale=j.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(a){this._map=a;var b="leaflet-control-scale",c=j.DomUtil.create("div",b),d=this.options;return this._addScales(d,b,c),a.on(d.updateWhenIdle?"moveend":"move",this._update,this),a.whenReady(this._update,this),c},onRemove:function(a){a.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(a,b,c){a.metric&&(this._mScale=j.DomUtil.create("div",b+"-line",c)),a.imperial&&(this._iScale=j.DomUtil.create("div",b+"-line",c))},_update:function(){var a=this._map.getBounds(),b=a.getCenter().lat,c=6378137*Math.PI*Math.cos(b*Math.PI/180),d=c*(a.getNorthEast().lng-a.getSouthWest().lng)/180,e=this._map.getSize(),f=this.options,g=0;e.x>0&&(g=d*(f.maxWidth/e.x)),this._updateScales(f,g)},_updateScales:function(a,b){a.metric&&b&&this._updateMetric(b),a.imperial&&b&&this._updateImperial(b)},_updateMetric:function(a){var b=this._getRoundNum(a);this._mScale.style.width=this._getScaleWidth(b/a)+"px",this._mScale.innerHTML=1e3>b?b+" m":b/1e3+" km"},_updateImperial:function(a){var b,c,d,e=3.2808399*a,f=this._iScale;e>5280?(b=e/5280,c=this._getRoundNum(b),f.style.width=this._getScaleWidth(c/b)+"px",f.innerHTML=c+" mi"):(d=this._getRoundNum(e),f.style.width=this._getScaleWidth(d/e)+"px",f.innerHTML=d+" ft")},_getScaleWidth:function(a){return Math.round(this.options.maxWidth*a)-10},_getRoundNum:function(a){var b=Math.pow(10,(Math.floor(a)+"").length-1),c=a/b;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:1,b*c}}),j.control.scale=function(a){return new j.Control.Scale(a)},j.Control.Layers=j.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(a,b,c){j.setOptions(this,c),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var d in a)this._addLayer(a[d],d);for(d in b)this._addLayer(b[d],d,!0)},onAdd:function(a){return this._initLayout(),this._update(),a.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container
},onRemove:function(a){a.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(a,b){return this._addLayer(a,b),this._update(),this},addOverlay:function(a,b){return this._addLayer(a,b,!0),this._update(),this},removeLayer:function(a){var b=j.stamp(a);return delete this._layers[b],this._update(),this},_initLayout:function(){var a="leaflet-control-layers",b=this._container=j.DomUtil.create("div",a);b.setAttribute("aria-haspopup",!0),j.Browser.touch?j.DomEvent.on(b,"click",j.DomEvent.stopPropagation):j.DomEvent.disableClickPropagation(b).disableScrollPropagation(b);var c=this._form=j.DomUtil.create("form",a+"-list");if(this.options.collapsed){j.Browser.android||j.DomEvent.on(b,"mouseover",this._expand,this).on(b,"mouseout",this._collapse,this);var d=this._layersLink=j.DomUtil.create("a",a+"-toggle",b);d.href="#",d.title="Layers",j.Browser.touch?j.DomEvent.on(d,"click",j.DomEvent.stop).on(d,"click",this._expand,this):j.DomEvent.on(d,"focus",this._expand,this),j.DomEvent.on(c,"click",function(){setTimeout(j.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=j.DomUtil.create("div",a+"-base",c),this._separator=j.DomUtil.create("div",a+"-separator",c),this._overlaysList=j.DomUtil.create("div",a+"-overlays",c),b.appendChild(c)},_addLayer:function(a,b,c){var d=j.stamp(a);this._layers[d]={layer:a,name:b,overlay:c},this.options.autoZIndex&&a.setZIndex&&(this._lastZIndex++,a.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var a,b,c=!1,d=!1;for(a in this._layers)b=this._layers[a],this._addItem(b),d=d||b.overlay,c=c||!b.overlay;this._separator.style.display=d&&c?"":"none"}},_onLayerChange:function(a){var b=this._layers[j.stamp(a.layer)];if(b){this._handlingClick||this._update();var c=b.overlay?"layeradd"===a.type?"overlayadd":"overlayremove":"layeradd"===a.type?"baselayerchange":null;c&&this._map.fire(c,b)}},_createRadioElement:function(a,b){var c='<input type="radio" class="leaflet-control-layers-selector" name="'+a+'"';b&&(c+=' checked="checked"'),c+="/>";var d=g.createElement("div");return d.innerHTML=c,d.firstChild},_addItem:function(a){var b,c=g.createElement("label"),d=this._map.hasLayer(a.layer);a.overlay?(b=g.createElement("input"),b.type="checkbox",b.className="leaflet-control-layers-selector",b.defaultChecked=d):b=this._createRadioElement("leaflet-base-layers",d),b.layerId=j.stamp(a.layer),j.DomEvent.on(b,"click",this._onInputClick,this);var e=g.createElement("span");e.innerHTML=" "+a.name,c.appendChild(b),c.appendChild(e);var f=a.overlay?this._overlaysList:this._baseLayersList;return f.appendChild(c),c},_onInputClick:function(){var a,b,c,d=this._form.getElementsByTagName("input"),e=d.length;for(this._handlingClick=!0,a=0;e>a;a++)b=d[a],c=this._layers[b.layerId],b.checked&&!this._map.hasLayer(c.layer)?this._map.addLayer(c.layer):!b.checked&&this._map.hasLayer(c.layer)&&this._map.removeLayer(c.layer);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){j.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),j.control.layers=function(a,b,c){return new j.Control.Layers(a,b,c)},j.PosAnimation=j.Class.extend({includes:j.Mixin.Events,run:function(a,b,c,d){this.stop(),this._el=a,this._inProgress=!0,this._newPos=b,this.fire("start"),a.style[j.DomUtil.TRANSITION]="all "+(c||.25)+"s cubic-bezier(0,0,"+(d||.5)+",1)",j.DomEvent.on(a,j.DomUtil.TRANSITION_END,this._onTransitionEnd,this),j.DomUtil.setPosition(a,b),j.Util.falseFn(a.offsetWidth),this._stepTimer=setInterval(j.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(j.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),j.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var a=this._getPos();return a?(this._el._leaflet_pos=a,void this.fire("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var a,b,c,d=this._el,e=f.getComputedStyle(d);if(j.Browser.any3d){if(c=e[j.DomUtil.TRANSFORM].match(this._transformRe),!c)return;a=parseFloat(c[1]),b=parseFloat(c[2])}else a=parseFloat(e.left),b=parseFloat(e.top);return new j.Point(a,b,!0)},_onTransitionEnd:function(){j.DomEvent.off(this._el,j.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[j.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),j.Map.include({setView:function(a,b,c){if(b=b===h?this._zoom:this._limitZoom(b),a=this._limitCenter(j.latLng(a),b,this.options.maxBounds),c=c||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!c.reset&&c!==!0){c.animate!==h&&(c.zoom=j.extend({animate:c.animate},c.zoom),c.pan=j.extend({animate:c.animate},c.pan));var d=this._zoom!==b?this._tryAnimatedZoom&&this._tryAnimatedZoom(a,b,c.zoom):this._tryAnimatedPan(a,c.pan);if(d)return clearTimeout(this._sizeTimer),this}return this._resetView(a,b),this},panBy:function(a,b){if(a=j.point(a).round(),b=b||{},!a.x&&!a.y)return this;if(this._panAnim||(this._panAnim=new j.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),b.noMoveStart||this.fire("movestart"),b.animate!==!1){j.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var c=this._getMapPanePos().subtract(a);this._panAnim.run(this._mapPane,c,b.duration||.25,b.easeLinearity)}else this._rawPanBy(a),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){j.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(a,b){var c=this._getCenterOffset(a)._floor();return(b&&b.animate)===!0||this.getSize().contains(c)?(this.panBy(c,b),!0):!1}}),j.PosAnimation=j.DomUtil.TRANSITION?j.PosAnimation:j.PosAnimation.extend({run:function(a,b,c,d){this.stop(),this._el=a,this._inProgress=!0,this._duration=c||.25,this._easeOutPower=1/Math.max(d||.5,.2),this._startPos=j.DomUtil.getPosition(a),this._offset=b.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=j.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var a=+new Date-this._startTime,b=1e3*this._duration;b>a?this._runFrame(this._easeOut(a/b)):(this._runFrame(1),this._complete())},_runFrame:function(a){var b=this._startPos.add(this._offset.multiplyBy(a));j.DomUtil.setPosition(this._el,b),this.fire("step")},_complete:function(){j.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(a){return 1-Math.pow(1-a,this._easeOutPower)}}),j.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),j.DomUtil.TRANSITION&&j.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&j.DomUtil.TRANSITION&&j.Browser.any3d&&!j.Browser.android23&&!j.Browser.mobileOpera,this._zoomAnimated&&j.DomEvent.on(this._mapPane,j.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),j.Map.include(j.DomUtil.TRANSITION?{_catchTransitionEnd:function(a){this._animatingZoom&&a.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(a,b,c){if(this._animatingZoom)return!0;if(c=c||{},!this._zoomAnimated||c.animate===!1||this._nothingToAnimate()||Math.abs(b-this._zoom)>this.options.zoomAnimationThreshold)return!1;var d=this.getZoomScale(b),e=this._getCenterOffset(a)._divideBy(1-1/d),f=this._getCenterLayerPoint()._add(e);return c.animate===!0||this.getSize().contains(e)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(a,b,f,d,null,!0),!0):!1},_animateZoom:function(a,b,c,d,e,f,g){g||(this._animatingZoom=!0),j.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=a,this._animateToZoom=b,j.Draggable&&(j.Draggable._disabled=!0),j.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:a,zoom:b,origin:c,scale:d,delta:e,backwards:f})},this)},_onZoomTransitionEnd:function(){this._animatingZoom=!1,j.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),j.Draggable&&(j.Draggable._disabled=!1)}}:{}),j.TileLayer.include({_animateZoom:function(a){this._animating||(this._animating=!0,this._prepareBgBuffer());var b=this._bgBuffer,c=j.DomUtil.TRANSFORM,d=a.delta?j.DomUtil.getTranslateString(a.delta):b.style[c],e=j.DomUtil.getScaleString(a.scale,a.origin);b.style[c]=a.backwards?e+" "+d:d+" "+e},_endZoomAnim:function(){var a=this._tileContainer,b=this._bgBuffer;a.style.visibility="",a.parentNode.appendChild(a),j.Util.falseFn(b.offsetWidth),this._animating=!1},_clearBgBuffer:function(){var a=this._map;!a||a._animatingZoom||a.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[j.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var a=this._tileContainer,b=this._bgBuffer,c=this._getLoadedTilesPercentage(b),d=this._getLoadedTilesPercentage(a);return b&&c>.5&&.5>d?(a.style.visibility="hidden",void this._stopLoadingImages(a)):(b.style.visibility="hidden",b.style[j.DomUtil.TRANSFORM]="",this._tileContainer=b,b=this._bgBuffer=a,this._stopLoadingImages(b),void clearTimeout(this._clearBgBufferTimer))},_getLoadedTilesPercentage:function(a){var b,c,d=a.getElementsByTagName("img"),e=0;for(b=0,c=d.length;c>b;b++)d[b].complete&&e++;return e/c},_stopLoadingImages:function(a){var b,c,d,e=Array.prototype.slice.call(a.getElementsByTagName("img"));for(b=0,c=e.length;c>b;b++)d=e[b],d.complete||(d.onload=j.Util.falseFn,d.onerror=j.Util.falseFn,d.src=j.Util.emptyImageUrl,d.parentNode.removeChild(d))}}),j.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(a){if(a=this._locateOptions=j.extend(this._defaultLocateOptions,a),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var b=j.bind(this._handleGeolocationResponse,this),c=j.bind(this._handleGeolocationError,this);return a.watch?this._locationWatchId=navigator.geolocation.watchPosition(b,c,a):navigator.geolocation.getCurrentPosition(b,c,a),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(a){var b=a.code,c=a.message||(1===b?"permission denied":2===b?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:b,message:"Geolocation error: "+c+"."})},_handleGeolocationResponse:function(a){var b=a.coords.latitude,c=a.coords.longitude,d=new j.LatLng(b,c),e=180*a.coords.accuracy/40075017,f=e/Math.cos(j.LatLng.DEG_TO_RAD*b),g=j.latLngBounds([b-e,c-f],[b+e,c+f]),h=this._locateOptions;if(h.setView){var i=Math.min(this.getBoundsZoom(g),h.maxZoom);this.setView(d,i)}var k={latlng:d,bounds:g,timestamp:a.timestamp};for(var l in a.coords)"number"==typeof a.coords[l]&&(k[l]=a.coords[l]);this.fire("locationfound",k)}})}(window,document)},function(){!function(a,b){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,polygonOptions:{}},initialize:function(a){L.Util.setOptions(this,a),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[]},addLayer:function(a){if(a instanceof L.LayerGroup){var b=[];for(var c in a._layers)b.push(a._layers[c]);return this.addLayers(b)}if(!a.getLatLng)return this._nonPointGroup.addLayer(a),this;if(!this._map)return this._needsClustering.push(a),this;if(this.hasLayer(a))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(a,this._maxZoom);var d=a,e=this._map.getZoom();if(a.__parent)for(;d.__parent._zoom>=e;)d=d.__parent;return this._currentShownBounds.contains(d.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(a,d):this._animationAddLayerNonAnimated(a,d)),this},removeLayer:function(a){if(a instanceof L.LayerGroup){var b=[];for(var c in a._layers)b.push(a._layers[c]);return this.removeLayers(b)}return a.getLatLng?this._map?a.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(a)),this._removeLayer(a,!0),this._featureGroup.hasLayer(a)&&(this._featureGroup.removeLayer(a),a.setOpacity&&a.setOpacity(1)),this):this:(!this._arraySplice(this._needsClustering,a)&&this.hasLayer(a)&&this._needsRemoving.push(a),this):(this._nonPointGroup.removeLayer(a),this)},addLayers:function(a){var b,c,d,e=this._map,f=this._featureGroup,g=this._nonPointGroup;for(b=0,c=a.length;c>b;b++)if(d=a[b],d.getLatLng){if(!this.hasLayer(d))if(e){if(this._addLayer(d,this._maxZoom),d.__parent&&2===d.__parent.getChildCount()){var h=d.__parent.getAllChildMarkers(),i=h[0]===d?h[1]:h[0];f.removeLayer(i)}}else this._needsClustering.push(d)}else g.addLayer(d);return e&&(f.eachLayer(function(a){a instanceof L.MarkerCluster&&a._iconNeedsUpdate&&a._updateIcon()}),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)),this},removeLayers:function(a){var b,c,d,e=this._featureGroup,f=this._nonPointGroup;if(!this._map){for(b=0,c=a.length;c>b;b++)d=a[b],this._arraySplice(this._needsClustering,d),f.removeLayer(d);return this}for(b=0,c=a.length;c>b;b++)d=a[b],d.__parent?(this._removeLayer(d,!0,!0),e.hasLayer(d)&&(e.removeLayer(d),d.setOpacity&&d.setOpacity(1))):f.removeLayer(d);return this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),e.eachLayer(function(a){a instanceof L.MarkerCluster&&a._updateIcon()}),this},clearLayers:function(){return this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(a){delete a.__parent}),this._map&&this._generateInitialClusters(),this},getBounds:function(){var a=new L.LatLngBounds;if(this._topClusterLevel)a.extend(this._topClusterLevel._bounds);else for(var b=this._needsClustering.length-1;b>=0;b--)a.extend(this._needsClustering[b].getLatLng());return a.extend(this._nonPointGroup.getBounds()),a},eachLayer:function(a,b){var c,d=this._needsClustering.slice();for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(d),c=d.length-1;c>=0;c--)a.call(b,d[c]);this._nonPointGroup.eachLayer(a,b)},getLayers:function(){var a=[];return this.eachLayer(function(b){a.push(b)}),a},getLayer:function(a){var b=null;return this.eachLayer(function(c){L.stamp(c)===a&&(b=c)}),b},hasLayer:function(a){if(!a)return!1;var b,c=this._needsClustering;for(b=c.length-1;b>=0;b--)if(c[b]===a)return!0;for(c=this._needsRemoving,b=c.length-1;b>=0;b--)if(c[b]===a)return!1;return!(!a.__parent||a.__parent._group!==this)||this._nonPointGroup.hasLayer(a)},zoomToShowLayer:function(a,b){var c=function(){if((a._icon||a.__parent._icon)&&!this._inZoomAnimation)if(this._map.off("moveend",c,this),this.off("animationend",c,this),a._icon)b();else if(a.__parent._icon){var d=function(){this.off("spiderfied",d,this),b()};this.on("spiderfied",d,this),a.__parent.spiderfy()}};a._icon&&this._map.getBounds().contains(a.getLatLng())?b():a.__parent._zoom<this._map.getZoom()?(this._map.on("moveend",c,this),this._map.panTo(a.getLatLng())):(this._map.on("moveend",c,this),this.on("animationend",c,this),this._map.setView(a.getLatLng(),a.__parent._zoom+1),a.__parent.zoomToBounds())},onAdd:function(a){this._map=a;var b,c,d;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.onAdd(a),this._nonPointGroup.onAdd(a),this._gridClusters||this._generateInitialClusters(),b=0,c=this._needsRemoving.length;c>b;b++)d=this._needsRemoving[b],this._removeLayer(d,!0);for(this._needsRemoving=[],b=0,c=this._needsClustering.length;c>b;b++)d=this._needsClustering[b],d.getLatLng?d.__parent||this._addLayer(d,this._maxZoom):this._featureGroup.addLayer(d);this._needsClustering=[],this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),this._zoom=this._map.getZoom(),this._currentShownBounds=this._getExpandedVisibleBounds(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)},onRemove:function(a){a.off("zoomend",this._zoomEnd,this),a.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),this._hideCoverage(),this._featureGroup.onRemove(a),this._nonPointGroup.onRemove(a),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(a){for(var b=a;b&&!b._icon;)b=b.__parent;return b||null},_arraySplice:function(a,b){for(var c=a.length-1;c>=0;c--)if(a[c]===b)return a.splice(c,1),!0},_removeLayer:function(a,b,c){var d=this._gridClusters,e=this._gridUnclustered,f=this._featureGroup,g=this._map;if(b)for(var h=this._maxZoom;h>=0&&e[h].removeObject(a,g.project(a.getLatLng(),h));h--);var i,j=a.__parent,k=j._markers;for(this._arraySplice(k,a);j&&(j._childCount--,!(j._zoom<0));)b&&j._childCount<=1?(i=j._markers[0]===a?j._markers[1]:j._markers[0],d[j._zoom].removeObject(j,g.project(j._cLatLng,j._zoom)),e[j._zoom].addObject(i,g.project(i.getLatLng(),j._zoom)),this._arraySplice(j.__parent._childClusters,j),j.__parent._markers.push(i),i.__parent=j.__parent,j._icon&&(f.removeLayer(j),c||f.addLayer(i))):(j._recalculateBounds(),c&&j._icon||j._updateIcon()),j=j.__parent;delete a.__parent},_isOrIsParent:function(a,b){for(;b;){if(a===b)return!0;b=b.parentNode}return!1},_propagateEvent:function(a){if(a.layer instanceof L.MarkerCluster){if(a.originalEvent&&this._isOrIsParent(a.layer._icon,a.originalEvent.relatedTarget))return;a.type="cluster"+a.type}this.fire(a.type,a)},_defaultIconCreateFunction:function(a){var b=a.getChildCount(),c=" marker-cluster-";return c+=10>b?"small":100>b?"medium":"large",new L.DivIcon({html:"<div><span>"+b+"</span></div>",className:"marker-cluster"+c,iconSize:new L.Point(40,40)})},_bindEvents:function(){var a=this._map,b=this.options.spiderfyOnMaxZoom,c=this.options.showCoverageOnHover,d=this.options.zoomToBoundsOnClick;(b||d)&&this.on("clusterclick",this._zoomOrSpiderfy,this),c&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),a.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(a){var b=this._map;b.getMaxZoom()===b.getZoom()?this.options.spiderfyOnMaxZoom&&a.layer.spiderfy():this.options.zoomToBoundsOnClick&&a.layer.zoomToBounds(),a.originalEvent&&13===a.originalEvent.keyCode&&b._container.focus()},_showCoverage:function(a){var b=this._map;this._inZoomAnimation||(this._shownPolygon&&b.removeLayer(this._shownPolygon),a.layer.getChildCount()>2&&a.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(a.layer.getConvexHull(),this.options.polygonOptions),b.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var a=this.options.spiderfyOnMaxZoom,b=this.options.showCoverageOnHover,c=this.options.zoomToBoundsOnClick,d=this._map;(a||c)&&this.off("clusterclick",this._zoomOrSpiderfy,this),b&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),d.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=this._map._zoom,this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var a=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._map._zoom,a),this._currentShownBounds=a}},_generateInitialClusters:function(){var a=this._map.getMaxZoom(),b=this.options.maxClusterRadius;this.options.disableClusteringAtZoom&&(a=this.options.disableClusteringAtZoom-1),this._maxZoom=a,this._gridClusters={},this._gridUnclustered={};for(var c=a;c>=0;c--)this._gridClusters[c]=new L.DistanceGrid(b),this._gridUnclustered[c]=new L.DistanceGrid(b);this._topClusterLevel=new L.MarkerCluster(this,-1)},_addLayer:function(a,b){var c,d,e=this._gridClusters,f=this._gridUnclustered;for(this.options.singleMarkerMode&&(a.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[a]}}));b>=0;b--){c=this._map.project(a.getLatLng(),b);var g=e[b].getNearObject(c);if(g)return g._addChild(a),void(a.__parent=g);if(g=f[b].getNearObject(c)){var h=g.__parent;h&&this._removeLayer(g,!1);var i=new L.MarkerCluster(this,b,g,a);e[b].addObject(i,this._map.project(i._cLatLng,b)),g.__parent=i,a.__parent=i;var j=i;for(d=b-1;d>h._zoom;d--)j=new L.MarkerCluster(this,d,j),e[d].addObject(j,this._map.project(g.getLatLng(),d));for(h._addChild(j),d=b;d>=0&&f[d].removeObject(g,this._map.project(g.getLatLng(),d));d--);return}f[b].addObject(a,c)}this._topClusterLevel._addChild(a),a.__parent=this._topClusterLevel},_enqueue:function(a){this._queue.push(a),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var a=0;a<this._queue.length;a++)this._queue[a].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){this._processQueue(),this._zoom<this._map._zoom&&this._currentShownBounds.contains(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,this._map._zoom)):this._zoom>this._map._zoom?(this._animationStart(),this._animationZoomOut(this._zoom,this._map._zoom)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(!this.options.removeOutsideVisibleBounds)return this.getBounds();var a=this._map,b=a.getBounds(),c=b._southWest,d=b._northEast,e=L.Browser.mobile?0:Math.abs(c.lat-d.lat),f=L.Browser.mobile?0:Math.abs(c.lng-d.lng);return new L.LatLngBounds(new L.LatLng(c.lat-e,c.lng-f,!0),new L.LatLng(d.lat+e,d.lng+f,!0))},_animationAddLayerNonAnimated:function(a,b){if(b===a)this._featureGroup.addLayer(a);else if(2===b._childCount){b._addToMap();var c=b.getAllChildMarkers();this._featureGroup.removeLayer(c[0]),this._featureGroup.removeLayer(c[1])}else b._updateIcon()}}),L.MarkerClusterGroup.include(L.DomUtil.TRANSITION?{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_animationZoomIn:function(a,b){var c,d=this._getExpandedVisibleBounds(),e=this._featureGroup;this._topClusterLevel._recursively(d,a,0,function(f){var g,h=f._latlng,i=f._markers;for(d.contains(h)||(h=null),f._isSingleParent()&&a+1===b?(e.removeLayer(f),f._recursivelyAddChildrenToMap(null,b,d)):(f.setOpacity(0),f._recursivelyAddChildrenToMap(h,b,d)),c=i.length-1;c>=0;c--)g=i[c],d.contains(g._latlng)||e.removeLayer(g)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(d,b),e.eachLayer(function(a){a instanceof L.MarkerCluster||!a._icon||a.setOpacity(1)}),this._topClusterLevel._recursively(d,a,b,function(a){a._recursivelyRestoreChildPositions(b)}),this._enqueue(function(){this._topClusterLevel._recursively(d,a,0,function(a){e.removeLayer(a),a.setOpacity(1)}),this._animationEnd()})},_animationZoomOut:function(a,b){this._animationZoomOutSingle(this._topClusterLevel,a-1,b),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a,this._getExpandedVisibleBounds())},_animationZoomOutSingle:function(a,b,c){var d=this._getExpandedVisibleBounds();a._recursivelyAnimateChildrenInAndAddSelfToMap(d,b+1,c);var e=this;this._forceLayout(),a._recursivelyBecomeVisible(d,c),this._enqueue(function(){if(1===a._childCount){var f=a._markers[0];f.setLatLng(f.getLatLng()),f.setOpacity(1)}else a._recursively(d,c,0,function(a){a._recursivelyRemoveChildrenFromMap(d,b+1)});e._animationEnd()})},_animationAddLayer:function(a,b){var c=this,d=this._featureGroup;d.addLayer(a),b!==a&&(b._childCount>2?(b._updateIcon(),this._forceLayout(),this._animationStart(),a._setPos(this._map.latLngToLayerPoint(b.getLatLng())),a.setOpacity(0),this._enqueue(function(){d.removeLayer(a),a.setOpacity(1),c._animationEnd()})):(this._forceLayout(),c._animationStart(),c._animationZoomOutSingle(b,this._map.getMaxZoom(),this._map.getZoom())))},_forceLayout:function(){L.Util.falseFn(b.body.offsetWidth)}}:{_animationStart:function(){},_animationZoomIn:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds())},_animationZoomOut:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds())},_animationAddLayer:function(a,b){this._animationAddLayerNonAnimated(a,b)}}),L.markerClusterGroup=function(a){return new L.MarkerClusterGroup(a)},L.MarkerCluster=L.Marker.extend({initialize:function(a,b,c,d){L.Marker.prototype.initialize.call(this,c?c._cLatLng||c.getLatLng():new L.LatLng(0,0),{icon:this}),this._group=a,this._zoom=b,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._bounds=new L.LatLngBounds,c&&this._addChild(c),d&&this._addChild(d)},getAllChildMarkers:function(a){a=a||[];for(var b=this._childClusters.length-1;b>=0;b--)this._childClusters[b].getAllChildMarkers(a);for(var c=this._markers.length-1;c>=0;c--)a.push(this._markers[c]);return a},getChildCount:function(){return this._childCount},zoomToBounds:function(){for(var a,b=this._childClusters.slice(),c=this._group._map,d=c.getBoundsZoom(this._bounds),e=this._zoom+1,f=c.getZoom();b.length>0&&d>e;){e++;var g=[];for(a=0;a<b.length;a++)g=g.concat(b[a]._childClusters);b=g}d>e?this._group._map.setView(this._latlng,e):f>=d?this._group._map.setView(this._latlng,f+1):this._group._map.fitBounds(this._bounds)},getBounds:function(){var a=new L.LatLngBounds;return a.extend(this._bounds),a},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(a,b){this._iconNeedsUpdate=!0,this._expandBounds(a),a instanceof L.MarkerCluster?(b||(this._childClusters.push(a),a.__parent=this),this._childCount+=a._childCount):(b||this._markers.push(a),this._childCount++),this.__parent&&this.__parent._addChild(a,!0)},_expandBounds:function(a){var b,c=a._wLatLng||a._latlng;a instanceof L.MarkerCluster?(this._bounds.extend(a._bounds),b=a._childCount):(this._bounds.extend(c),b=1),this._cLatLng||(this._cLatLng=a._cLatLng||c);var d=this._childCount+b;this._wLatLng?(this._wLatLng.lat=(c.lat*b+this._wLatLng.lat*this._childCount)/d,this._wLatLng.lng=(c.lng*b+this._wLatLng.lng*this._childCount)/d):this._latlng=this._wLatLng=new L.LatLng(c.lat,c.lng)},_addToMap:function(a){a&&(this._backupLatlng=this._latlng,this.setLatLng(a)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(a,b,c){this._recursively(a,0,c-1,function(a){var c,d,e=a._markers;for(c=e.length-1;c>=0;c--)d=e[c],d._icon&&(d._setPos(b),d.setOpacity(0))},function(a){var c,d,e=a._childClusters;for(c=e.length-1;c>=0;c--)d=e[c],d._icon&&(d._setPos(b),d.setOpacity(0))})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(a,b,c){this._recursively(a,c,0,function(d){d._recursivelyAnimateChildrenIn(a,d._group._map.latLngToLayerPoint(d.getLatLng()).round(),b),d._isSingleParent()&&b-1===c?(d.setOpacity(1),d._recursivelyRemoveChildrenFromMap(a,b)):d.setOpacity(0),d._addToMap()})},_recursivelyBecomeVisible:function(a,b){this._recursively(a,0,b,null,function(a){a.setOpacity(1)})},_recursivelyAddChildrenToMap:function(a,b,c){this._recursively(c,-1,b,function(d){if(b!==d._zoom)for(var e=d._markers.length-1;e>=0;e--){var f=d._markers[e];c.contains(f._latlng)&&(a&&(f._backupLatlng=f.getLatLng(),f.setLatLng(a),f.setOpacity&&f.setOpacity(0)),d._group._featureGroup.addLayer(f))}},function(b){b._addToMap(a)})},_recursivelyRestoreChildPositions:function(a){for(var b=this._markers.length-1;b>=0;b--){var c=this._markers[b];c._backupLatlng&&(c.setLatLng(c._backupLatlng),delete c._backupLatlng)}if(a-1===this._zoom)for(var d=this._childClusters.length-1;d>=0;d--)this._childClusters[d]._restorePosition();else for(var e=this._childClusters.length-1;e>=0;e--)this._childClusters[e]._recursivelyRestoreChildPositions(a)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(a,b,c){var d,e;this._recursively(a,-1,b-1,function(a){for(e=a._markers.length-1;e>=0;e--)d=a._markers[e],c&&c.contains(d._latlng)||(a._group._featureGroup.removeLayer(d),d.setOpacity&&d.setOpacity(1))},function(a){for(e=a._childClusters.length-1;e>=0;e--)d=a._childClusters[e],c&&c.contains(d._latlng)||(a._group._featureGroup.removeLayer(d),d.setOpacity&&d.setOpacity(1))})},_recursively:function(a,b,c,d,e){var f,g,h=this._childClusters,i=this._zoom;if(b>i)for(f=h.length-1;f>=0;f--)g=h[f],a.intersects(g._bounds)&&g._recursively(a,b,c,d,e);else if(d&&d(this),e&&this._zoom===c&&e(this),c>i)for(f=h.length-1;f>=0;f--)g=h[f],a.intersects(g._bounds)&&g._recursively(a,b,c,d,e)},_recalculateBounds:function(){var a,b=this._markers,c=this._childClusters;for(this._bounds=new L.LatLngBounds,delete this._wLatLng,a=b.length-1;a>=0;a--)this._expandBounds(b[a]);for(a=c.length-1;a>=0;a--)this._expandBounds(c[a])},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.DistanceGrid=function(a){this._cellSize=a,this._sqCellSize=a*a,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(a,b){var c=this._getCoord(b.x),d=this._getCoord(b.y),e=this._grid,f=e[d]=e[d]||{},g=f[c]=f[c]||[],h=L.Util.stamp(a);this._objectPoint[h]=b,g.push(a)},updateObject:function(a,b){this.removeObject(a),this.addObject(a,b)},removeObject:function(a,b){var c,d,e=this._getCoord(b.x),f=this._getCoord(b.y),g=this._grid,h=g[f]=g[f]||{},i=h[e]=h[e]||[];for(delete this._objectPoint[L.Util.stamp(a)],c=0,d=i.length;d>c;c++)if(i[c]===a)return i.splice(c,1),1===d&&delete h[e],!0},eachObject:function(a,b){var c,d,e,f,g,h,i,j=this._grid;for(c in j){g=j[c];for(d in g)for(h=g[d],e=0,f=h.length;f>e;e++)i=a.call(b,h[e]),i&&(e--,f--)}},getNearObject:function(a){var b,c,d,e,f,g,h,i,j=this._getCoord(a.x),k=this._getCoord(a.y),l=this._objectPoint,m=this._sqCellSize,n=null;
for(b=k-1;k+1>=b;b++)if(e=this._grid[b])for(c=j-1;j+1>=c;c++)if(f=e[c])for(d=0,g=f.length;g>d;d++)h=f[d],i=this._sqDist(l[L.Util.stamp(h)],a),m>i&&(m=i,n=h);return n},_getCoord:function(a){return Math.floor(a/this._cellSize)},_sqDist:function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d}},function(){L.QuickHull={getDistant:function(a,b){var c=b[1].lat-b[0].lat,d=b[0].lng-b[1].lng;return d*(a.lat-b[0].lat)+c*(a.lng-b[0].lng)},findMostDistantPointFromBaseLine:function(a,b){var c,d,e,f=0,g=null,h=[];for(c=b.length-1;c>=0;c--)d=b[c],e=this.getDistant(d,a),e>0&&(h.push(d),e>f&&(f=e,g=d));return{maxPoint:g,newPoints:h}},buildConvexHull:function(a,b){var c=[],d=this.findMostDistantPointFromBaseLine(a,b);return d.maxPoint?(c=c.concat(this.buildConvexHull([a[0],d.maxPoint],d.newPoints)),c=c.concat(this.buildConvexHull([d.maxPoint,a[1]],d.newPoints))):[a[0]]},getConvexHull:function(a){var b,c=!1,d=!1,e=null,f=null;for(b=a.length-1;b>=0;b--){var g=a[b];(c===!1||g.lat>c)&&(e=g,c=g.lat),(d===!1||g.lat<d)&&(f=g,d=g.lat)}var h=[].concat(this.buildConvexHull([f,e],a),this.buildConvexHull([e,f],a));return h}}}(),L.MarkerCluster.include({getConvexHull:function(){var a,b,c=this.getAllChildMarkers(),d=[];for(b=c.length-1;b>=0;b--)a=c[b].getLatLng(),d.push(a);return L.QuickHull.getConvexHull(d)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var a,b=this.getAllChildMarkers(),c=this._group,d=c._map,e=d.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,b.length>=this._circleSpiralSwitchover?a=this._generatePointsSpiral(b.length,e):(e.y+=10,a=this._generatePointsCircle(b.length,e)),this._animationSpiderfy(b,a)}},unspiderfy:function(a){this._group._inZoomAnimation||(this._animationUnspiderfy(a),this._group._spiderfied=null)},_generatePointsCircle:function(a,b){var c,d,e=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+a),f=e/this._2PI,g=this._2PI/a,h=[];for(h.length=a,c=a-1;c>=0;c--)d=this._circleStartAngle+c*g,h[c]=new L.Point(b.x+f*Math.cos(d),b.y+f*Math.sin(d))._round();return h},_generatePointsSpiral:function(a,b){var c,d=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthStart,e=this._group.options.spiderfyDistanceMultiplier*this._spiralFootSeparation,f=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthFactor,g=0,h=[];for(h.length=a,c=a-1;c>=0;c--)g+=e/d+5e-4*c,h[c]=new L.Point(b.x+d*Math.cos(g),b.y+d*Math.sin(g))._round(),d+=this._2PI*f/g;return h},_noanimationUnspiderfy:function(){var a,b,c=this._group,d=c._map,e=c._featureGroup,f=this.getAllChildMarkers();for(this.setOpacity(1),b=f.length-1;b>=0;b--)a=f[b],e.removeLayer(a),a._preSpiderfyLatlng&&(a.setLatLng(a._preSpiderfyLatlng),delete a._preSpiderfyLatlng),a.setZIndexOffset&&a.setZIndexOffset(0),a._spiderLeg&&(d.removeLayer(a._spiderLeg),delete a._spiderLeg);c._spiderfied=null}}),L.MarkerCluster.include(L.DomUtil.TRANSITION?{SVG_ANIMATION:function(){return b.createElementNS("http://www.w3.org/2000/svg","animate").toString().indexOf("SVGAnimate")>-1}(),_animationSpiderfy:function(a,c){var d,e,f,g,h=this,i=this._group,j=i._map,k=i._featureGroup,l=j.latLngToLayerPoint(this._latlng);for(d=a.length-1;d>=0;d--)e=a[d],e.setOpacity?(e.setZIndexOffset(1e6),e.setOpacity(0),k.addLayer(e),e._setPos(l)):k.addLayer(e);i._forceLayout(),i._animationStart();var m=L.Path.SVG?0:.3,n=L.Path.SVG_NS;for(d=a.length-1;d>=0;d--)if(g=j.layerPointToLatLng(c[d]),e=a[d],e._preSpiderfyLatlng=e._latlng,e.setLatLng(g),e.setOpacity&&e.setOpacity(1),f=new L.Polyline([h._latlng,g],{weight:1.5,color:"#222",opacity:m}),j.addLayer(f),e._spiderLeg=f,L.Path.SVG&&this.SVG_ANIMATION){var o=f._path.getTotalLength();f._path.setAttribute("stroke-dasharray",o+","+o);var p=b.createElementNS(n,"animate");p.setAttribute("attributeName","stroke-dashoffset"),p.setAttribute("begin","indefinite"),p.setAttribute("from",o),p.setAttribute("to",0),p.setAttribute("dur",.25),f._path.appendChild(p),p.beginElement(),p=b.createElementNS(n,"animate"),p.setAttribute("attributeName","stroke-opacity"),p.setAttribute("attributeName","stroke-opacity"),p.setAttribute("begin","indefinite"),p.setAttribute("from",0),p.setAttribute("to",.5),p.setAttribute("dur",.25),f._path.appendChild(p),p.beginElement()}if(h.setOpacity(.3),L.Path.SVG)for(this._group._forceLayout(),d=a.length-1;d>=0;d--)e=a[d]._spiderLeg,e.options.opacity=.5,e._path.setAttribute("stroke-opacity",.5);setTimeout(function(){i._animationEnd(),i.fire("spiderfied")},200)},_animationUnspiderfy:function(a){var b,c,d,e=this._group,f=e._map,g=e._featureGroup,h=a?f._latLngToNewLayerPoint(this._latlng,a.zoom,a.center):f.latLngToLayerPoint(this._latlng),i=this.getAllChildMarkers(),j=L.Path.SVG&&this.SVG_ANIMATION;for(e._animationStart(),this.setOpacity(1),c=i.length-1;c>=0;c--)b=i[c],b._preSpiderfyLatlng&&(b.setLatLng(b._preSpiderfyLatlng),delete b._preSpiderfyLatlng,b.setOpacity?(b._setPos(h),b.setOpacity(0)):g.removeLayer(b),j&&(d=b._spiderLeg._path.childNodes[0],d.setAttribute("to",d.getAttribute("from")),d.setAttribute("from",0),d.beginElement(),d=b._spiderLeg._path.childNodes[1],d.setAttribute("from",.5),d.setAttribute("to",0),d.setAttribute("stroke-opacity",0),d.beginElement(),b._spiderLeg._path.setAttribute("stroke-opacity",0)));setTimeout(function(){var a=0;for(c=i.length-1;c>=0;c--)b=i[c],b._spiderLeg&&a++;for(c=i.length-1;c>=0;c--)b=i[c],b._spiderLeg&&(b.setOpacity&&(b.setOpacity(1),b.setZIndexOffset(0)),a>1&&g.removeLayer(b),f.removeLayer(b._spiderLeg),delete b._spiderLeg);e._animationEnd()},200)}}:{_animationSpiderfy:function(a,b){var c,d,e,f,g=this._group,h=g._map,i=g._featureGroup;for(c=a.length-1;c>=0;c--)f=h.layerPointToLatLng(b[c]),d=a[c],d._preSpiderfyLatlng=d._latlng,d.setLatLng(f),d.setZIndexOffset&&d.setZIndexOffset(1e6),i.addLayer(d),e=new L.Polyline([this._latlng,f],{weight:1.5,color:"#222"}),h.addLayer(e),d._spiderLeg=e;this.setOpacity(.3),g.fire("spiderfied")},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Path.SVG&&!L.Browser.touch&&this._map._initPathRoot()},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(a){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(a))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(a){this._spiderfied&&this._spiderfied.unspiderfy(a)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(a){a._spiderLeg&&(this._featureGroup.removeLayer(a),a.setOpacity(1),a.setZIndexOffset(0),this._map.removeLayer(a._spiderLeg),delete a._spiderLeg)}})}(window,document)},function(a){a.exports={}},function(a,b,c){function d(a,b){for(var c in b)l.has(b,c)&&"prototype"!==c&&(a[c]=b[c])}function e(){var a=this;return j.apply(a,arguments)}function f(a){return a&&a._typeId?this._typeId==a._typeId:!1}function g(a,b){if(!a||!a._typeId)return!1;for(var c=!1,d=b?this:this.parent;!c&&d&&void 0!==d._typeId;d=d.parent)c=d._typeId==a._typeId;return c}function h(a){var b=this["class"];return g.call(b,a,!0)}function i(a){return a?h.call(a,this):!1}function j(){function a(){this.initialize&&this.initialize.apply(this,arguments)}return a.extend=e,a.isSameType=f,a.isSubtype=g,a.hasInstance=i,this&&(d(a,this),d(a.prototype,this.prototype),a.parent=this),l.each(arguments,function(b){d(a.prototype,b)}),a.prototype.instanceOf=h,a.prototype["class"]=a,a.prototype.getClass=function(){return a},a.prototype.setOptions=function(a){this.options=l.extend({},this.options,a)},a._typeId=m++,a.toString=function(){return"class-"+a._typeId},a}var k=a.exports=c(7),l=c(2),m=0,n=j().extend({});n.parent=null,k.Class=n},function(a,b,c){function d(){var a=d.newError;return a.apply(a,arguments)}function e(a){var b;return a instanceof Error?b=a:(j.isString(a)&&0===a.indexOf("Error: ")&&(a=a.substring("Error: ".length)),b=new Error(a)),j.extend(b,k),b}function f(a){var b=e(a.message);return j.isArray(a.trace)&&(b.stack=a.trace.join("\n")),a.code&&b.code(a.code),a.messageKey&&b.messageKey(a.messageKey),b}function g(a){var b={message:"ERROR"};return a&&(b.message=a+"",b.messageKey=a._messageKey,b.status=a.status||500,j.isArray(a.stack)?b.trace=h(a.stack):j.isString(a.stack)?b.trace=a.stack.split(/[\r\n]+/gim):j.isObject(a)?j.each(j.keys(a),function(c){b[c]=a[c]}):b.trace=[JSON.stringify(a)]),b}function h(a){return a?JSON.parse(JSON.stringify(a)):null}var i=a.exports=c(7),j=c(2);i.Errors=d,j.extend(d,{newError:e,toJSON:g,fromJSON:f});var k={code:function(a){return void 0===a?this.status:(this.status=a,this)},messageKey:function(a){return void 0===a?this._messageKey:(this._messageKey=a,this)}}},function(a,b,c){var d=a.exports=c(7),e=c(12),f=c(2);d.Events=function(){e.EventEmitter.apply(this,arguments)},f.extend(d.Events.prototype,e.EventEmitter.prototype,{fire:e.EventEmitter.prototype.emit}),f.extend(d.Events,{listenTo:function(a,b,c,d){var e=this._listeners=this._listeners||[];d=d||this,a.on(b,c,d),e.push({obj:a,event:b,handler:c,context:d})},stopListening:function(a,b){a?this._listeners=f.filter(this._listeners,function(c){var d=!0,e=c.context||this;return c.obj==a&&(b&&b!=c.event||(c.obj.off(c.event,c.handler,e),d=!1)),d},this):(f.each(this._listeners,function(a){var b=a.context||this;a.obj.off(a.event,a.handler,b)},this),delete this._listeners)},triggerMethod:function(){function a(a,b,c){return c.toUpperCase()}var b=/(^|:)(\w)/gi,c=function(c){var d="on"+c.replace(b,a),e=this[d];return f.isFunction(this.fire)&&this.fire.apply(this,arguments),f.isFunction(e)?e.apply(this,f.tail(arguments)):void 0};return c}()})},function(a,b,c){function d(a,b){return Array.prototype.slice.call(a,b)}function e(){return g.apply(this,arguments)}var f=a.exports=c(7),g=c(13);f.P=e;for(var h=["promise","resolve","reject","defer","join","all","spread"],i=0;i<h.length;i++)e[h[i]]=g[h[i]];e.promise=g.promise||function(){return new e},e.then=g.then||function(){var a=new e;return a.then.apply(a,arguments)},e.fin=function(a,b){return a.then(function(a){return e.then(function(){return b(null,a)}).then(function(){return a})},function(a){return e.then(function(){return b(a)}).then(function(){throw a})})},e.timeout=g.timeout?g.timeout:function(a,b){var c=e.defer(),d=setTimeout(function(){b=b||"Timed out after "+a+" ms",c.reject(new Error(b))},a);return c.promise.then(function(a){return clearTimeout(d),a},function(a){throw clearTimeout(d),a})},e.delay=g.delay||function(a){return a=a||0,e.then(function(b){var c=e.defer(),d=setTimeout(function(){c.resolve(b)},a);return c.promise.cancel=function(){clearTimeout(d),c.resolve(b)},c.promise})},e.nresolver=function(a){return function(b,c){b?a.reject(b):a.resolve(arguments.length>2?d(arguments,1):c)}},e.nwrapper=function(a,b){function c(b){f[b]=function(){var c=e.defer();try{var f=d(arguments);f.push(e.nresolver(c)),a[b].apply(a,f)}catch(g){c.reject(g)}return c.promise}}for(var f={instance:a},g=0;g<b.length;g++)c(b[g]);return f},e.ninvoke=e.ninvoke||function(a,b){var c=d(arguments,2),f=e.defer();c.push(e.nresolver(f));try{a[b].apply(a,c)}catch(g){f.reject(g)}return f.promise},e.nfapply=g.nfapply||function(a,b){var c=e.defer(),f=d(b);f.push(e.nresolver(c));try{a.apply(a,f)}catch(g){c.reject(g)}return c.promise},e.nfcall=g.nfcall||function(a){var b=d(arguments,1);return e.nfapply(a,b)}},function(a){function b(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function c(a){return"function"==typeof a}function d(a){return"number"==typeof a}function e(a){return"object"==typeof a&&null!==a}function f(a){return void 0===a}a.exports=b,b.EventEmitter=b,b.prototype._events=void 0,b.prototype._maxListeners=void 0,b.defaultMaxListeners=10,b.prototype.setMaxListeners=function(a){if(!d(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},b.prototype.emit=function(a){var b,d,g,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||e(this._events.error)&&!this._events.error.length))throw b=arguments[1],b instanceof Error?b:TypeError('Uncaught, unspecified "error" event.');if(d=this._events[a],f(d))return!1;if(c(d))switch(arguments.length){case 1:d.call(this);break;case 2:d.call(this,arguments[1]);break;case 3:d.call(this,arguments[1],arguments[2]);break;default:for(g=arguments.length,h=new Array(g-1),i=1;g>i;i++)h[i-1]=arguments[i];d.apply(this,h)}else if(e(d)){for(g=arguments.length,h=new Array(g-1),i=1;g>i;i++)h[i-1]=arguments[i];for(j=d.slice(),g=j.length,i=0;g>i;i++)j[i].apply(this,h)}return!0},b.prototype.addListener=function(a,d){var g;if(!c(d))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,c(d.listener)?d.listener:d),this._events[a]?e(this._events[a])?this._events[a].push(d):this._events[a]=[this._events[a],d]:this._events[a]=d,e(this._events[a])&&!this._events[a].warned){var g;g=f(this._maxListeners)?b.defaultMaxListeners:this._maxListeners,g&&g>0&&this._events[a].length>g&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},b.prototype.on=b.prototype.addListener,b.prototype.once=function(a,b){function d(){this.removeListener(a,d),e||(e=!0,b.apply(this,arguments))}if(!c(b))throw TypeError("listener must be a function");var e=!1;return d.listener=b,this.on(a,d),this},b.prototype.removeListener=function(a,b){var d,f,g,h;if(!c(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(d=this._events[a],g=d.length,f=-1,d===b||c(d.listener)&&d.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(e(d)){for(h=g;h-->0;)if(d[h]===b||d[h].listener&&d[h].listener===b){f=h;break}if(0>f)return this;1===d.length?(d.length=0,delete this._events[a]):d.splice(f,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},b.prototype.removeAllListeners=function(a){var b,d;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(d=this._events[a],c(d))this.removeListener(a,d);else for(;d.length;)this.removeListener(a,d[d.length-1]);return delete this._events[a],this},b.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?c(this._events[a])?[this._events[a]]:this._events[a].slice():[]},b.listenerCount=function(a,b){var d;return d=a._events&&a._events[b]?c(a._events[b])?1:a._events[b].length:0}},function(a,b,c){var d;!function(){"use strict";d=function(){function a(a,b,c){var d=A.resolve(a);return arguments.length<2?d:arguments.length>3?d.then(b,c,arguments[3]):d.then(b,c)}function b(a){return new A(a)}function d(a){return function(){return f(a,this,B.call(arguments))}}function e(a){return f(a,this,B.call(arguments,1))}function f(a,b,c){return A.all(c).then(function(c){return a.apply(b,c)})}function g(){return new h}function h(){function a(a){d._handler.resolve(a)}function b(a){d._handler.reject(a)}function c(a){d._handler.notify(a)}var d=A._defer();this.promise=d,this.resolve=a,this.reject=b,this.notify=c,this.resolver={resolve:a,reject:b,notify:c}}function i(a){return a&&"function"==typeof a.then}function j(){return A.all(arguments)}function k(b){return a(b,A.all)}function l(b){return a(b,A.settle)}function m(b,c){return a(b,function(a){return A.map(a,c)})}function n(b,c){return a(b,function(a){return A.filter(a,c)})}function o(b){var c=B.call(arguments,1);return a(b,function(a){return c.unshift(a),A.reduce.apply(A,c)})}function p(b){var c=B.call(arguments,1);return a(b,function(a){return c.unshift(a),A.reduceRight.apply(A,c)})}var q=c(16),r=c(17),s=c(18),t=c(19),u=c(20),v=c(21),w=c(22),x=c(23),y=c(24),z=c(14),A=[r,s,t,v,w,u,x,q,y].reduce(function(a,b){return b(a)},c(15)),B=Array.prototype.slice;return a.promise=b,a.resolve=A.resolve,a.reject=A.reject,a.lift=d,a["try"]=e,a.attempt=e,a.iterate=A.iterate,a.unfold=A.unfold,a.join=j,a.all=k,a.settle=l,a.any=d(A.any),a.some=d(A.some),a.race=d(A.race),a.map=m,a.filter=n,a.reduce=o,a.reduceRight=p,a.isPromiseLike=i,a.Promise=A,a.defer=g,a.TimeoutError=z,a}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a,b,c){var d;!function(){"use strict";d=function(){function a(b){Error.call(this),this.message=b,this.name=a.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a,b,c){var d;!function(){"use strict";d=function(){var a=c(26),b=c(27),d=c(28);return a({scheduler:new b(d)})}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a,b,c){var d;!function(){"use strict";d=function(){function a(a,c,d,e){return b.set(function(){a(d,e,c)},c)}var b=c(29),d=c(14);return function(c){function e(b,c,d){a(f,b,c,d)}function f(a,b){b.resolve(a)}function g(a,b,c){var e="undefined"==typeof a?new d("timed out after "+c+"ms"):a;b.reject(e)}return c.prototype.delay=function(a){var b=this._beget();return this._handler.fold(e,a,void 0,b._handler),b},c.prototype.timeout=function(c,d){var e=this._beget(),f=e._handler,h=a(g,c,d,e._handler);return this._handler.visit(f,function(a){b.clear(h),this.resolve(a)},function(a){b.clear(h),this.reject(a)},f.notify),e},c}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a,b,c){var d;!function(){"use strict";d=function(){return function(a){function b(b){return new a(function(a,c){function e(a){f.push(a),0===--g&&c(f)}var f=[],g=d(b,a,e);0===g&&c(new RangeError("any() input must not be empty"))})}function c(b,c){return new a(function(a,e,f){function g(b){l>0&&(--l,j.push(b),0===l&&a(j))}function h(a){i>0&&(--i,k.push(a),0===i&&e(k))}var i,j=[],k=[],l=d(b,g,h,f);c=Math.max(c,0),i=l-c+1,l=Math.min(c,l),c>l?e(new RangeError("some() input must contain at least "+c+" element(s), but had "+l)):0===l&&a(j)})}function d(a,b,c,d){return l.call(a,function(a,e){return n(e).then(b,c,d),a+1},0)}function e(a,b){function c(a,c){return b(c,a)}return"object"!=typeof a?n([]):o(k(function(a,b){return n(a).fold(c,b)},a))}function f(a,b){return o(a).then(function(a){return o(k(b,a)).then(function(b){for(var c,d=b.length,e=new Array(d),f=0,g=0;d>f;++f)c=b[f],(void 0!==c||f in b)&&b[f]&&(e[g++]=a[f]);return e.length=g,e})})}function g(a){return o(k(function(a){function b(){return a.inspect()}return a=n(a),a.then(b,b)},a))}function h(a,b){var c=j(b);return arguments.length>2?l.call(a,c,arguments[2]):l.call(a,c)}function i(a,b){var c=j(b);return arguments.length>2?m.call(a,c,arguments[2]):m.call(a,c)}function j(a){return function(b,c,d){return n(b).then(function(b){return n(c).then(function(c){return a(b,c,d)})})}}function k(a,b){for(var c,d=b.length,e=new Array(d),f=0;d>f;++f)c=b[f],(void 0!==c||f in b)&&(e[f]=a(b[f],f));return e}var l=Array.prototype.reduce,m=Array.prototype.reduceRight,n=a.resolve,o=a.all;return a.any=b,a.some=c,a.settle=g,a.map=e,a.filter=f,a.reduce=h,a.reduceRight=i,a.prototype.spread=function(a){return this.then(o).then(function(b){return a.apply(void 0,b)})},a}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a,b,c){var d;!function(){"use strict";d=function(){function a(){throw new TypeError("catch predicate must be a function")}function b(a,b){return c(b)?a instanceof b:b(a)}function c(a){return a===Error||null!=a&&a.prototype instanceof Error}function d(a){return function(){return a.call(this)}}return function(c){function e(a,c){return function(d){return b(d,c)?a.call(this,d):f(d)}}var f=c.reject,g=c.prototype["catch"];return c.prototype.done=function(a,b){this._handler.visit(this._handler.receiver,a,b)},c.prototype["catch"]=c.prototype.otherwise=function(b){return 1===arguments.length?g.call(this,b):"function"!=typeof b?this.ensure(a):g.call(this,e(arguments[1],b))},c.prototype["finally"]=c.prototype.ensure=function(a){if("function"!=typeof a)return this;var b=d(a);return this.then(b,b)["yield"](this)},c.prototype["else"]=c.prototype.orElse=function(a){return this.then(void 0,function(){return a})},c.prototype["yield"]=function(a){return this.then(function(){return a})},c.prototype.tap=function(a){return this.then(a)["yield"](this)},c}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a,b,c){var d;!function(){"use strict";d=function(){return function(a){return a.prototype.fold=function(b,c){var d=this._beget();return this._handler.fold(function(c,d,e){a._handler(c).fold(function(a,c,d){d.resolve(b.call(this,c,a))},d,this,e)},c,d._handler.receiver,d._handler),d},a}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a,b,c){var d;!function(){"use strict";d=function(){return function(a){function b(a){var b=a.state();return 0===b?{state:"pending"}:b>0?{state:"fulfilled",value:a.value}:{state:"rejected",reason:a.value}}return a.prototype.inspect=function(){return b(a._handler(this))},a}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a,b,c){var d;!function(){"use strict";d=function(){return function(a){function b(a,b,d,e){return c(function(b){return[b,a(b)]},b,d,e)}function c(a,b,e,f){function g(f,g){return d(e(f)).then(function(){return c(a,b,e,g)})}return d(f).then(function(c){return d(b(c)).then(function(b){return b?c:d(a(c)).spread(g)})})}var d=a.resolve;return a.iterate=b,a.unfold=c,a}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a,b,c){var d;!function(){"use strict";d=function(){return function(a){return a.prototype.progress=function(a){return this.then(void 0,void 0,a)},a}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a,b,c){var d;!function(){"use strict";d=function(){return function(a){return a.prototype["with"]=a.prototype.withThis=function(a){var b=this._beget(),c=b._handler;return c.receiver=a,this._handler.chain(c,a),b},a}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a,b,c){var d;!function(){"use strict";d=function(){function a(a){var c="object"==typeof a&&a.stack?a.stack:b(a);return a instanceof Error?c:c+" (WARNING: non-Error used)"}function b(a){var b=String(a);return"[object Object]"===b&&"undefined"!=typeof JSON&&(b=d(a,b)),b}function d(a,b){try{return JSON.stringify(a)}catch(a){return b}}function e(a){throw a}function f(){}var g=c(29);return function(c){function d(b){b.handled||(n.push(b),k("Potentially unhandled rejection ["+b.id+"] "+a(b.value)))}function h(a){var c=n.indexOf(a);c>=0&&(n.splice(c,1),l("Handled previous rejection ["+a.id+"] "+b(a.value)))}function i(a,b){m.push(a,b),o||(o=!0,o=g.set(j,0))}function j(){for(o=!1;m.length>0;)m.shift()(m.shift())}var k=f,l=f;"undefined"!=typeof console&&(k="undefined"!=typeof console.error?function(a){console.error(a)}:function(a){console.log(a)},l="undefined"!=typeof console.info?function(a){console.info(a)}:function(a){console.log(a)}),c.onPotentiallyUnhandledRejection=function(a){i(d,a)},c.onPotentiallyUnhandledRejectionHandled=function(a){i(h,a)},c.onFatalRejection=function(a){i(e,a.value)};var m=[],n=[],o=!1;return c}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a){a.exports=function(){throw new Error("define cannot be used indirect")}},function(a,b,c){var d;!function(){"use strict";d=function(){return function(a){function b(a,b){this._handler=a===l?b:c(a)}function c(a){function b(a){e.resolve(a)}function c(a){e.reject(a)}function d(a){e.notify(a)}var e=new n;try{a(b,c,d)}catch(f){c(f)}return e}function d(a){return A(a)?a:new b(l,new p(j(a)))}function e(a){return new b(l,new p(new s(a)))}function f(){return P}function g(){return new b(l,new n)}function h(a){function c(a,b,c){this[a]=b,0===--i&&c.become(new r(this))}var d,e,f,g,h=new n,i=a.length>>>0,j=new Array(i);for(d=0;d<a.length;++d)if(f=a[d],void 0!==f||d in a)if(B(f))if(e=A(f)?f._handler.join():k(f),g=e.state(),0===g)e.fold(c,d,j,h);else{if(!(g>0)){h.become(e);break}j[d]=e.value,--i}else j[d]=f,--i;else--i;return 0===i&&h.become(new r(j)),new b(l,h)}function i(a){if(Object(a)===a&&0===a.length)return f();var c,d,e=new n;for(c=0;c<a.length;++c)d=a[c],void 0!==d&&c in a&&j(d).visit(e,e.resolve,e.reject);return new b(l,e)}function j(a){return A(a)?a._handler.join():B(a)?k(a):new r(a)}function k(a){try{var b=a.then;return"function"==typeof b?new q(b,a):new r(a)}catch(c){return new s(c)}}function l(){}function m(){}function n(a,c){b.createContext(this,c),this.consumers=void 0,this.receiver=a,this.handler=void 0,this.resolved=!1}function o(a){this.handler=a}function p(a){o.call(this,a)}function q(a,b){n.call(this),K.enqueue(new y(a,b,this))}function r(a){b.createContext(this),this.value=a}function s(a){b.createContext(this),this.id=++N,this.value=a,this.handled=!1,this.reported=!1,this._report()}function t(a,b){this.rejection=a,this.context=b}function u(a){this.rejection=a}function v(){return new s(new TypeError("Promise cycle"))}function w(a,b){this.continuation=a,this.handler=b}function x(a,b){this.handler=b,this.value=a}function y(a,b,c){this._then=a,this.thenable=b,this.resolver=c}function z(a,b,c,d,e){try{a.call(b,c,d,e)}catch(f){d(f)}}function A(a){return a instanceof b}function B(a){return("object"==typeof a||"function"==typeof a)&&null!==a}function C(a,c,d,e){return"function"!=typeof a?e.become(c):(b.enterContext(c),F(a,c.value,d,e),void b.exitContext())}function D(a,c,d,e,f){return"function"!=typeof a?f.become(d):(b.enterContext(d),G(a,c,d.value,e,f),void b.exitContext())}function E(a,c,d,e,f){return"function"!=typeof a?f.notify(c):(b.enterContext(d),H(a,c,e,f),void b.exitContext())}function F(a,b,c,d){try{d.become(j(a.call(c,b)))}catch(e){d.become(new s(e))}}function G(a,b,c,d,e){try{a.call(d,b,c,e)}catch(f){e.become(new s(f))}}function H(a,b,c,d){try{d.notify(a.call(c,b))}catch(e){d.notify(e)}}function I(a,b){b.prototype=L(a.prototype),b.prototype.constructor=b}function J(){}var K=a.scheduler,L=Object.create||function(a){function b(){}return b.prototype=a,new b};b.resolve=d,b.reject=e,b.never=f,b._defer=g,b._handler=j,b.prototype.then=function(a,c){var d=this._handler;if("function"!=typeof a&&d.join().state()>0)return new b(l,d);var e=this._beget(),f=e._handler;return d.chain(f,d.receiver,a,c,arguments.length>2?arguments[2]:void 0),e},b.prototype["catch"]=function(a){return this.then(void 0,a)},b.prototype._beget=function(){var a=this._handler,b=new n(a.receiver,a.join().context);return new this.constructor(l,b)},b.all=h,b.race=i,l.prototype.when=l.prototype.become=l.prototype.notify=l.prototype.fail=l.prototype._unreport=l.prototype._report=J,l.prototype._state=0,l.prototype.state=function(){return this._state},l.prototype.join=function(){for(var a=this;void 0!==a.handler;)a=a.handler;return a},l.prototype.chain=function(a,b,c,d,e){this.when({resolver:a,receiver:b,fulfilled:c,rejected:d,progress:e})},l.prototype.visit=function(a,b,c,d){this.chain(M,a,b,c,d)},l.prototype.fold=function(a,b,c,d){this.visit(d,function(d){a.call(c,b,d,this)},d.reject,d.notify)},I(l,m),m.prototype.become=function(a){a.fail()};var M=new m;I(l,n),n.prototype._state=0,n.prototype.resolve=function(a){this.become(j(a))},n.prototype.reject=function(a){this.resolved||this.become(new s(a))},n.prototype.join=function(){if(!this.resolved)return this;for(var a=this;void 0!==a.handler;)if(a=a.handler,a===this)return this.handler=v();return a},n.prototype.run=function(){var a=this.consumers,b=this.join();this.consumers=void 0;for(var c=0;c<a.length;++c)b.when(a[c])},n.prototype.become=function(a){this.resolved||(this.resolved=!0,this.handler=a,void 0!==this.consumers&&K.enqueue(this),void 0!==this.context&&a._report(this.context))},n.prototype.when=function(a){this.resolved?K.enqueue(new w(a,this.handler)):void 0===this.consumers?this.consumers=[a]:this.consumers.push(a)},n.prototype.notify=function(a){this.resolved||K.enqueue(new x(a,this))},n.prototype.fail=function(a){var b="undefined"==typeof a?this.context:a;this.resolved&&this.handler.join().fail(b)},n.prototype._report=function(a){this.resolved&&this.handler.join()._report(a)},n.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},I(l,o),o.prototype._report=function(a){this.join()._report(a)},o.prototype._unreport=function(){this.join()._unreport()},I(o,p),p.prototype.when=function(a){K.enqueue(new w(a,this))},I(n,q),I(l,r),r.prototype._state=1,r.prototype.fold=function(a,b,c,d){D(a,b,this,c,d)},r.prototype.when=function(a){C(a.fulfilled,this,a.receiver,a.resolver)};var N=0;I(l,s),s.prototype._state=-1,s.prototype.fold=function(a,b,c,d){d.become(this)},s.prototype.when=function(a){"function"==typeof a.rejected&&this._unreport(),C(a.rejected,this,a.receiver,a.resolver)},s.prototype._report=function(a){K.afterQueue(new t(this,a))},s.prototype._unreport=function(){this.handled=!0,K.afterQueue(new u(this))},s.prototype.fail=function(a){b.onFatalRejection(this,void 0===a?this.context:a)},t.prototype.run=function(){this.rejection.handled||(this.rejection.reported=!0,b.onPotentiallyUnhandledRejection(this.rejection,this.context))},u.prototype.run=function(){this.rejection.reported&&b.onPotentiallyUnhandledRejectionHandled(this.rejection)},b.createContext=b.enterContext=b.exitContext=b.onPotentiallyUnhandledRejection=b.onPotentiallyUnhandledRejectionHandled=b.onFatalRejection=J;var O=new l,P=new b(l,O);return w.prototype.run=function(){this.handler.join().when(this.continuation)},x.prototype.run=function(){var a=this.handler.consumers;if(void 0!==a)for(var b,c=0;c<a.length;++c)b=a[c],E(b.progress,this.value,this.handler,b.receiver,b.resolver)},y.prototype.run=function(){function a(a){d.resolve(a)}function b(a){d.reject(a)}function c(a){d.notify(a)}var d=this.resolver;z(this._then,this.thenable,a,b,c)},b}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a,b,c){var d;!function(){"use strict";d=function(){function a(a){this._async=a,this._queue=new d(15),this._afterQueue=new d(5),this._running=!1;var b=this;this.drain=function(){b._drain()}}function b(a){for(;a.length>0;)a.shift().run()}var d=c(31);return a.prototype.enqueue=function(a){this._add(this._queue,a)},a.prototype.afterQueue=function(a){this._add(this._afterQueue,a)},a.prototype._drain=function(){b(this._queue),this._running=!1,b(this._afterQueue)},a.prototype._add=function(a,b){a.push(b),this._running||(this._running=!0,this._async(this.drain))},a}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a,b,c){var d;(function(e){!function(){"use strict";d=function(a){var b,d;return b="undefined"!=typeof e&&null!==e&&"function"==typeof e.nextTick?function(a){e.nextTick(a)}:(d="function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver)?function(a,b){function c(){var a=d;d=void 0,a()}var d,e=a.createElement("div"),f=new b(c);return f.observe(e,{attributes:!0}),function(a){d=a,e.setAttribute("class","x")}}(document,d):function(){try{return c(30).runOnLoop||c(30).runOnContext}catch(a){}var b=setTimeout;
return function(a){b(a,0)}}(a)}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))}).call(b,c(32))},function(a,b,c){var d;!function(){"use strict";d=function(a){var b,d,e,f;b=a;try{d=c(30),e=function(a,b){return d.setTimer(b,a)},f=d.cancelTimer}catch(g){e=function(a,b){return setTimeout(a,b)},f=function(a){return clearTimeout(a)}}return{set:e,clear:f}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a){if("undefined"==typeof c){var b=new Error('Cannot find module "vertx"');throw b.code="MODULE_NOT_FOUND",b}a.exports=c},function(a,b,c){var d;!function(){"use strict";d=function(){function a(a){this.head=this.tail=this.length=0,this.buffer=new Array(1<<a)}return a.prototype.push=function(a){return this.length===this.buffer.length&&this._ensureCapacity(2*this.length),this.buffer[this.tail]=a,this.tail=this.tail+1&this.buffer.length-1,++this.length,this.length},a.prototype.shift=function(){var a=this.buffer[this.head];return this.buffer[this.head]=void 0,this.head=this.head+1&this.buffer.length-1,--this.length,a},a.prototype._ensureCapacity=function(a){var b,c=this.head,d=this.buffer,e=new Array(a),f=0;if(0===c)for(b=this.length;b>f;++f)e[f]=d[f];else{for(a=d.length,b=this.tail;a>c;++f,++c)e[f]=d[c];for(c=0;b>c;++f,++c)e[f]=d[c]}this.buffer=e,this.head=0,this.tail=this.length},a}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}(c(25))},function(a){function b(){}var c=a.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.on=b,c.addListener=b,c.once=b,c.off=b,c.removeListener=b,c.removeAllListeners=b,c.emit=b,c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}}])});